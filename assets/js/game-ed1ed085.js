this.createjs=this.createjs||{},function(){"use strict";var e=createjs.PreloadJS=createjs.PreloadJS||{};e.version="0.4.1",e.buildDate="Thu, 12 Dec 2013 23:33:38 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype;t.type=null,t.target=null,t.currentTarget=null,t.eventPhase=0,t.bubbles=!1,t.cancelable=!1,t.timeStamp=0,t.defaultPrevented=!1,t.propagationStopped=!1,t.immediatePropagationStopped=!1,t.removed=!1,t.initialize=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=(new Date).getTime()},t.preventDefault=function(){this.defaultPrevented=!0},t.stopPropagation=function(){this.propagationStopped=!0},t.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.remove=function(){this.removed=!0},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},t.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=e}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(){},t=e.prototype;e.initialize=function(e){e.addEventListener=t.addEventListener,e.on=t.on,e.removeEventListener=e.off=t.removeEventListener,e.removeAllEventListeners=t.removeAllEventListeners,e.hasEventListener=t.hasEventListener,e.dispatchEvent=t.dispatchEvent,e._dispatchEvent=t._dispatchEvent,e.willTrigger=t.willTrigger},t._listeners=null,t._captureListeners=null,t.initialize=function(){},t.addEventListener=function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t},t.on=function(e,t,n,r,i,o){return t.handleEvent&&(n=n||t,t=t.handleEvent),n=n||this,this.addEventListener(e,function(e){t.call(n,e,i),r&&e.remove()},o)},t.removeEventListener=function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var o=0,a=i.length;a>o;o++)if(i[o]==t){1==a?delete r[e]:i.splice(o,1);break}}},t.off=t.removeEventListener,t.removeAllEventListeners=function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},t.dispatchEvent=function(e,t){if("string"==typeof e){var n=this._listeners;if(!n||!n[e])return!1;e=new createjs.Event(e)}if(e.target=t||this,e.bubbles&&this.parent){for(var r=this,i=[r];r.parent;)i.push(r=r.parent);var o,a=i.length;for(o=a-1;o>=0&&!e.propagationStopped;o--)i[o]._dispatchEvent(e,1+(0==o));for(o=1;a>o&&!e.propagationStopped;o++)i[o]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented},t.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},t.willTrigger=function(e){for(var t=this;t;){if(t.hasEventListener(e))return!0;t=t.parent}return!1},t.toString=function(){return"[EventDispatcher]"},t._dispatchEvent=function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;e.currentTarget=this,e.eventPhase=t,e.removed=!1,i=i.slice();for(var o=0;n>o&&!e.immediatePropagationStopped;o++){var a=i[o];a.handleEvent?a.handleEvent(e):a(e),e.removed&&(this.off(e.type,a,1==t),e.removed=!1)}}},createjs.EventDispatcher=e}(),this.createjs=this.createjs||{},function(){"use strict";createjs.indexOf=function(e,t){for(var n=0,r=e.length;r>n;n++)if(t===e[n])return n;return-1}}(),this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,Array.prototype.slice.call(arguments,0).concat(n))}}}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(){this.init()};e.prototype=new createjs.EventDispatcher;var t=e.prototype,n=e;n.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?)|(.{0,2}\/{1}))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,n.PATH_PATTERN=/^(?:(\w+:)\/{2})|(.{0,2}\/{1})?([/.]*?(?:[^?]+)?\/?)?$/,t.loaded=!1,t.canceled=!1,t.progress=0,t._item=null,t.getItem=function(){return this._item},t.init=function(){},t.load=function(){},t.close=function(){},t._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},t._sendProgress=function(e){if(!this._isCanceled()){var t=null;"number"==typeof e?(this.progress=e,t=new createjs.Event("progress"),t.loaded=this.progress,t.total=1):(t=e,this.progress=e.loaded/e.total,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),t.progress=this.progress,this.hasEventListener("progress")&&this.dispatchEvent(t)}},t._sendComplete=function(){this._isCanceled()||this.dispatchEvent("complete")},t._sendError=function(e){!this._isCanceled()&&this.hasEventListener("error")&&(null==e&&(e=new createjs.Event("error")),this.dispatchEvent(e))},t._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1},t._parseURI=function(e){return e?e.match(n.FILE_PATTERN):null},t._parsePath=function(e){return e?e.match(n.PATH_PATTERN):null},t._formatQueryString=function(e,t){if(null==e)throw new Error("You must specify data.");var n=[];for(var r in e)n.push(r+"="+escape(e[r]));return t&&(n=n.concat(t)),n.join("&")},t.buildPath=function(e,t){if(null==t)return e;var n=[],r=e.indexOf("?");if(-1!=r){var i=e.slice(r+1);n=n.concat(i.split("&"))}return-1!=r?e.slice(0,r)+"?"+this._formatQueryString(t,n):e+"?"+this._formatQueryString(t,n)},t._isCrossDomain=function(e){var t=document.createElement("a");t.href=e.src;var n=document.createElement("a");n.href=location.href;var r=""!=t.hostname&&(t.port!=n.port||t.protocol!=n.protocol||t.hostname!=n.hostname);return r},t._isLocal=function(e){var t=document.createElement("a");return t.href=e.src,""==t.hostname&&"file:"==t.protocol},t.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=e}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(e,t,n){this.init(e,t,n)},t=e.prototype=new createjs.AbstractLoader,n=e;n.loadTimeout=8e3,n.LOAD_TIMEOUT=0,n.BINARY="binary",n.CSS="css",n.IMAGE="image",n.JAVASCRIPT="javascript",n.JSON="json",n.JSONP="jsonp",n.MANIFEST="manifest",n.SOUND="sound",n.SVG="svg",n.TEXT="text",n.XML="xml",n.POST="POST",n.GET="GET",t._basePath=null,t._crossOrigin="",t.useXHR=!0,t.stopOnError=!1,t.maintainScriptOrder=!0,t.next=null,t._typeCallbacks=null,t._extensionCallbacks=null,t._loadStartWasDispatched=!1,t._maxConnections=1,t._currentlyLoadingScript=null,t._currentLoads=null,t._loadQueue=null,t._loadQueueBackup=null,t._loadItemsById=null,t._loadItemsBySrc=null,t._loadedResults=null,t._loadedRawResults=null,t._numItems=0,t._numItemsLoaded=0,t._scriptOrder=null,t._loadedScripts=null,t.init=function(e,t,n){this._numItems=this._numItemsLoaded=0,this._paused=!1,this._loadStartWasDispatched=!1,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._scriptOrder=[],this._loadedScripts=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._typeCallbacks={},this._extensionCallbacks={},this._basePath=t,this.setUseXHR(e),this._crossOrigin=n===!0?"Anonymous":n===!1||null==n?"":n},t.setUseXHR=function(e){return this.useXHR=0!=e&&null!=window.XMLHttpRequest,this.useXHR},t.removeAll=function(){this.remove()},t.remove=function(e){var t=null;if(!e||e instanceof Array){if(e)t=e;else if(arguments.length>0)return}else t=[e];var n=!1;if(t){for(;t.length;){var r=t.pop(),i=this.getResult(r);for(o=this._loadQueue.length-1;o>=0;o--)if(a=this._loadQueue[o].getItem(),a.id==r||a.src==r){this._loadQueue.splice(o,1)[0].cancel();break}for(o=this._loadQueueBackup.length-1;o>=0;o--)if(a=this._loadQueueBackup[o].getItem(),a.id==r||a.src==r){this._loadQueueBackup.splice(o,1)[0].cancel();break}if(i)delete this._loadItemsById[i.id],delete this._loadItemsBySrc[i.src],this._disposeItem(i);else for(var o=this._currentLoads.length-1;o>=0;o--){var a=this._currentLoads[o].getItem();if(a.id==r||a.src==r){this._currentLoads.splice(o,1)[0].cancel(),n=!0;break}}}n&&this._loadNext()}else{this.close();for(var s in this._loadItemsById)this._disposeItem(this._loadItemsById[s]);this.init(this.useXHR)}},t.reset=function(){this.close();for(var e in this._loadItemsById)this._disposeItem(this._loadItemsById[e]);for(var t=[],n=0,r=this._loadQueueBackup.length;r>n;n++)t.push(this._loadQueueBackup[n].getItem());this.loadManifest(t,!1)},n.isBinary=function(e){switch(e){case createjs.LoadQueue.IMAGE:case createjs.LoadQueue.BINARY:return!0;default:return!1}},n.isText=function(e){switch(e){case createjs.LoadQueue.TEXT:case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:case createjs.LoadQueue.XML:case createjs.LoadQueue.HTML:case createjs.LoadQueue.CSS:case createjs.LoadQueue.SVG:case createjs.LoadQueue.JAVASCRIPT:return!0;default:return!1}},t.installPlugin=function(e){if(null!=e&&null!=e.getPreloadHandlers){var t=e.getPreloadHandlers();if(t.scope=e,null!=t.types)for(var n=0,r=t.types.length;r>n;n++)this._typeCallbacks[t.types[n]]=t;if(null!=t.extensions)for(n=0,r=t.extensions.length;r>n;n++)this._extensionCallbacks[t.extensions[n]]=t}},t.setMaxConnections=function(e){this._maxConnections=e,!this._paused&&this._loadQueue.length>0&&this._loadNext()},t.loadFile=function(e,t,n){if(null==e){var r=new createjs.Event("error");return r.text="PRELOAD_NO_FILE",this._sendError(r),void 0}this._addItem(e,null,n),t!==!1?this.setPaused(!1):this.setPaused(!0)},t.loadManifest=function(e,t,r){var i=null,o=null;if(e instanceof Array){if(0==e.length){var a=new createjs.Event("error");return a.text="PRELOAD_MANIFEST_EMPTY",this._sendError(a),void 0}i=e}else if("string"==typeof e)i=[{src:e,type:n.MANIFEST}];else{if("object"!=typeof e){var a=new createjs.Event("error");return a.text="PRELOAD_MANIFEST_NULL",this._sendError(a),void 0}if(void 0!==e.src){if(null==e.type)e.type=n.MANIFEST;else if(e.type!=n.MANIFEST){var a=new createjs.Event("error");a.text="PRELOAD_MANIFEST_ERROR",this._sendError(a)}i=[e]}else void 0!==e.manifest&&(i=e.manifest,o=e.path)}for(var s=0,u=i.length;u>s;s++)this._addItem(i[s],o,r);t!==!1?this.setPaused(!1):this.setPaused(!0)},t.load=function(){this.setPaused(!1)},t.getItem=function(e){return this._loadItemsById[e]||this._loadItemsBySrc[e]},t.getResult=function(e,t){var n=this._loadItemsById[e]||this._loadItemsBySrc[e];if(null==n)return null;var r=n.id;return t&&this._loadedRawResults[r]?this._loadedRawResults[r]:this._loadedResults[r]},t.setPaused=function(e){this._paused=e,this._paused||this._loadNext()},t.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1},t._addItem=function(e,t,n){var r=this._createLoadItem(e,t,n);if(null!=r){var i=this._createLoader(r);null!=i&&(this._loadQueue.push(i),this._loadQueueBackup.push(i),this._numItems++,this._updateProgress(),this.maintainScriptOrder&&r.type==createjs.LoadQueue.JAVASCRIPT&&i instanceof createjs.XHRLoader&&(this._scriptOrder.push(r),this._loadedScripts.push(null)))}},t._createLoadItem=function(e,t,n){var r=null;switch(typeof e){case"string":r={src:e};break;case"object":r=window.HTMLAudioElement&&e instanceof window.HTMLAudioElement?{tag:e,src:r.tag.src,type:createjs.LoadQueue.SOUND}:e;break;default:return null}var i=this._parseURI(r.src);null!=i&&(r.ext=i[6]),null==r.type&&(r.type=this._getTypeByExtension(r.ext));var o="",a=n||this._basePath,s=r.src;if(i&&null==i[1]&&null==i[3])if(t){o=t;var u=this._parsePath(t);s=t+s,null!=a&&u&&null==u[1]&&null==u[2]&&(o=a+o)}else null!=a&&(o=a);if(r.src=o+r.src,r.path=o,(r.type==createjs.LoadQueue.JSON||r.type==createjs.LoadQueue.MANIFEST)&&(r._loadAsJSONP=null!=r.callback),r.type==createjs.LoadQueue.JSONP&&null==r.callback)throw new Error("callback is required for loading JSONP requests.");(void 0===r.tag||null===r.tag)&&(r.tag=this._createTag(r)),(void 0===r.id||null===r.id||""===r.id)&&(r.id=s);var l=this._typeCallbacks[r.type]||this._extensionCallbacks[r.ext];if(l){var c=l.callback.call(l.scope,r.src,r.type,r.id,r.data,o,this);if(c===!1)return null;c===!0||(null!=c.src&&(r.src=c.src),null!=c.id&&(r.id=c.id),null!=c.tag&&(r.tag=c.tag),null!=c.completeHandler&&(r.completeHandler=c.completeHandler),c.type&&(r.type=c.type),i=this._parseURI(r.src),null!=i&&null!=i[6]&&(r.ext=i[6].toLowerCase()))}return this._loadItemsById[r.id]=r,this._loadItemsBySrc[r.src]=r,r},t._createLoader=function(e){var t=this.useXHR;switch(e.type){case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:t=!e._loadAsJSONP;break;case createjs.LoadQueue.XML:case createjs.LoadQueue.TEXT:t=!0;break;case createjs.LoadQueue.SOUND:case createjs.LoadQueue.JSONP:t=!1;break;case null:return null}return t?new createjs.XHRLoader(e,this._crossOrigin):new createjs.TagLoader(e)},t._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded?(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load()):this.loaded=!1;for(var e=0;e<this._loadQueue.length&&!(this._currentLoads.length>=this._maxConnections);e++){var t=this._loadQueue[e];if(this.maintainScriptOrder&&t instanceof createjs.TagLoader&&t.getItem().type==createjs.LoadQueue.JAVASCRIPT){if(this._currentlyLoadingScript)continue;this._currentlyLoadingScript=!0}this._loadQueue.splice(e,1),e--,this._loadItem(t)}}},t._loadItem=function(e){e.on("progress",this._handleProgress,this),e.on("complete",this._handleFileComplete,this),e.on("error",this._handleFileError,this),this._currentLoads.push(e),this._sendFileStart(e.getItem()),e.load()},t._handleFileError=function(e){var t=e.target;this._numItemsLoaded++,this._updateProgress();var n=new createjs.Event("error");n.text="FILE_LOAD_ERROR",n.item=t.getItem(),this._sendError(n),this.stopOnError||(this._removeLoadItem(t),this._loadNext())},t._handleFileComplete=function(e){var t=e.target,n=t.getItem();if(this._loadedResults[n.id]=t.getResult(),t instanceof createjs.XHRLoader&&(this._loadedRawResults[n.id]=t.getResult(!0)),this._removeLoadItem(t),this.maintainScriptOrder&&n.type==createjs.LoadQueue.JAVASCRIPT){if(!(t instanceof createjs.TagLoader))return this._loadedScripts[createjs.indexOf(this._scriptOrder,n)]=n,this._checkScriptLoadOrder(t),void 0;this._currentlyLoadingScript=!1}if(delete n._loadAsJSONP,n.type==createjs.LoadQueue.MANIFEST){var r=t.getResult();null!=r&&void 0!==r.manifest&&this.loadManifest(r,!0)}this._processFinishedLoad(n,t)},t._processFinishedLoad=function(e,t){this._numItemsLoaded++,this._updateProgress(),this._sendFileComplete(e,t),this._loadNext()},t._checkScriptLoadOrder=function(){for(var e=this._loadedScripts.length,t=0;e>t;t++){var n=this._loadedScripts[t];if(null===n)break;if(n!==!0){var r=this._loadedResults[n.id];(document.body||document.getElementsByTagName("body")[0]).appendChild(r),this._processFinishedLoad(n),this._loadedScripts[t]=!0}}},t._removeLoadItem=function(e){for(var t=this._currentLoads.length,n=0;t>n;n++)if(this._currentLoads[n]==e){this._currentLoads.splice(n,1);break}},t._handleProgress=function(e){var t=e.target;this._sendFileProgress(t.getItem(),t.progress),this._updateProgress()},t._updateProgress=function(){var e=this._numItemsLoaded/this._numItems,t=this._numItems-this._numItemsLoaded;if(t>0){for(var n=0,r=0,i=this._currentLoads.length;i>r;r++)n+=this._currentLoads[r].progress;e+=n/t*(t/this._numItems)}this._sendProgress(e)},t._disposeItem=function(e){delete this._loadedResults[e.id],delete this._loadedRawResults[e.id],delete this._loadItemsById[e.id],delete this._loadItemsBySrc[e.src]},t._createTag=function(e){var t=null;switch(e.type){case createjs.LoadQueue.IMAGE:return t=document.createElement("img"),""==this._crossOrigin||this._isLocal(e)||(t.crossOrigin=this._crossOrigin),t;case createjs.LoadQueue.SOUND:return t=document.createElement("audio"),t.autoplay=!1,t;case createjs.LoadQueue.JSON:case createjs.LoadQueue.JSONP:case createjs.LoadQueue.JAVASCRIPT:case createjs.LoadQueue.MANIFEST:return t=document.createElement("script"),t.type="text/javascript",t;case createjs.LoadQueue.CSS:return t=this.useXHR?document.createElement("style"):document.createElement("link"),t.rel="stylesheet",t.type="text/css",t;case createjs.LoadQueue.SVG:return this.useXHR?t=document.createElement("svg"):(t=document.createElement("object"),t.type="image/svg+xml"),t}return null},t._getTypeByExtension=function(e){if(null==e)return createjs.LoadQueue.TEXT;switch(e.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.LoadQueue.IMAGE;case"ogg":case"mp3":case"wav":return createjs.LoadQueue.SOUND;case"json":return createjs.LoadQueue.JSON;case"xml":return createjs.LoadQueue.XML;case"css":return createjs.LoadQueue.CSS;case"js":return createjs.LoadQueue.JAVASCRIPT;case"svg":return createjs.LoadQueue.SVG;default:return createjs.LoadQueue.TEXT}},t._sendFileProgress=function(e,t){if(this._isCanceled())return this._cleanUp(),void 0;if(this.hasEventListener("fileprogress")){var n=new createjs.Event("fileprogress");n.progress=t,n.loaded=t,n.total=1,n.item=e,this.dispatchEvent(n)}},t._sendFileComplete=function(e,t){if(!this._isCanceled()){var n=new createjs.Event("fileload");n.loader=t,n.item=e,n.result=this._loadedResults[e.id],n.rawResult=this._loadedRawResults[e.id],e.completeHandler&&e.completeHandler(n),this.hasEventListener("fileload")&&this.dispatchEvent(n)}},t._sendFileStart=function(e){var t=new createjs.Event("filestart");t.item=e,this.hasEventListener("filestart")&&this.dispatchEvent(t)},t.toString=function(){return"[PreloadJS LoadQueue]"},createjs.LoadQueue=e;var r=function(){};r.init=function(){var e=navigator.userAgent;r.isFirefox=e.indexOf("Firefox")>-1,r.isOpera=null!=window.opera,r.isChrome=e.indexOf("Chrome")>-1,r.isIOS=e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1},r.init(),createjs.LoadQueue.BrowserDetect=r}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(e){this.init(e)},t=e.prototype=new createjs.AbstractLoader;t._loadTimeout=null,t._tagCompleteProxy=null,t._isAudio=!1,t._tag=null,t._jsonResult=null,t.init=function(e){this._item=e,this._tag=e.tag,this._isAudio=window.HTMLAudioElement&&e.tag instanceof window.HTMLAudioElement,this._tagCompleteProxy=createjs.proxy(this._handleLoad,this)},t.getResult=function(){return this._item.type==createjs.LoadQueue.JSONP||this._item.type==createjs.LoadQueue.MANIFEST?this._jsonResult:this._tag},t.cancel=function(){this.canceled=!0,this._clean()},t.load=function(){var e=this._item,t=this._tag;clearTimeout(this._loadTimeout);var n=createjs.LoadQueue.LOAD_TIMEOUT;0==n&&(n=createjs.LoadQueue.loadTimeout),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),n),this._isAudio&&(t.src=null,t.preload="auto"),t.onerror=createjs.proxy(this._handleError,this),this._isAudio?(t.onstalled=createjs.proxy(this._handleStalled,this),t.addEventListener("canplaythrough",this._tagCompleteProxy,!1)):(t.onload=createjs.proxy(this._handleLoad,this),t.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this));var r=this.buildPath(e.src,e.values);switch(e.type){case createjs.LoadQueue.CSS:t.href=r;break;case createjs.LoadQueue.SVG:t.data=r;break;default:t.src=r}if(e.type==createjs.LoadQueue.JSONP||e.type==createjs.LoadQueue.JSON||e.type==createjs.LoadQueue.MANIFEST){if(null==e.callback)throw new Error("callback is required for loading JSONP requests.");if(null!=window[e.callback])throw new Error('JSONP callback "'+e.callback+'" already exists on window. You need to specify a different callback. Or re-name the current one.');window[e.callback]=createjs.proxy(this._handleJSONPLoad,this)}(e.type==createjs.LoadQueue.SVG||e.type==createjs.LoadQueue.JSONP||e.type==createjs.LoadQueue.JSON||e.type==createjs.LoadQueue.MANIFEST||e.type==createjs.LoadQueue.JAVASCRIPT||e.type==createjs.LoadQueue.CSS)&&(this._startTagVisibility=t.style.visibility,t.style.visibility="hidden",(document.body||document.getElementsByTagName("body")[0]).appendChild(t)),null!=t.load&&t.load()},t._handleJSONPLoad=function(e){this._jsonResult=e},t._handleTimeout=function(){this._clean();var e=new createjs.Event("error");e.text="PRELOAD_TIMEOUT",this._sendError(e)},t._handleStalled=function(){},t._handleError=function(){this._clean();var e=new createjs.Event("error");this._sendError(e)},t._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var e=this.getItem().tag;("loaded"==e.readyState||"complete"==e.readyState)&&this._handleLoad()},t._handleLoad=function(){if(!this._isCanceled()){var e=this.getItem(),t=e.tag;if(!(this.loaded||this._isAudio&&4!==t.readyState)){switch(this.loaded=!0,e.type){case createjs.LoadQueue.SVG:case createjs.LoadQueue.JSON:case createjs.LoadQueue.JSONP:case createjs.LoadQueue.MANIFEST:case createjs.LoadQueue.CSS:t.style.visibility=this._startTagVisibility,(document.body||document.getElementsByTagName("body")[0]).removeChild(t)}this._clean(),this._sendComplete()}}},t._clean=function(){clearTimeout(this._loadTimeout);var e=this.getItem(),t=e.tag;null!=t&&(t.onload=null,t.removeEventListener&&t.removeEventListener("canplaythrough",this._tagCompleteProxy,!1),t.onstalled=null,t.onprogress=null,t.onerror=null,null!=t.parentNode&&e.type==createjs.LoadQueue.SVG&&e.type==createjs.LoadQueue.JSON&&e.type==createjs.LoadQueue.MANIFEST&&e.type==createjs.LoadQueue.CSS&&e.type==createjs.LoadQueue.JSONP&&t.parentNode.removeChild(t));var e=this.getItem();(e.type==createjs.LoadQueue.JSONP||e.type==createjs.LoadQueue.MANIFEST)&&(window[e.callback]=null)},t.toString=function(){return"[PreloadJS TagLoader]"},createjs.TagLoader=e}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(e,t){this.init(e,t)},t=e.prototype=new createjs.AbstractLoader;t._request=null,t._loadTimeout=null,t._xhrLevel=1,t._response=null,t._rawResponse=null,t._crossOrigin="",t.init=function(e,t){this._item=e,this._crossOrigin=t,!this._createXHR(e)},t.getResult=function(e){return e&&this._rawResponse?this._rawResponse:this._response},t.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},t.load=function(){if(null==this._request)return this._handleError(),void 0;if(this._request.onloadstart=createjs.proxy(this._handleLoadStart,this),this._request.onprogress=createjs.proxy(this._handleProgress,this),this._request.onabort=createjs.proxy(this._handleAbort,this),this._request.onerror=createjs.proxy(this._handleError,this),this._request.ontimeout=createjs.proxy(this._handleTimeout,this),1==this._xhrLevel){var e=createjs.LoadQueue.LOAD_TIMEOUT;if(0==e)e=createjs.LoadQueue.loadTimeout;else try{console.warn("LoadQueue.LOAD_TIMEOUT has been deprecated in favor of LoadQueue.loadTimeout")}catch(t){}this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),e)}this._request.onload=createjs.proxy(this._handleLoad,this),this._request.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);try{this._item.values&&this._item.method!=createjs.LoadQueue.GET?this._item.method==createjs.LoadQueue.POST&&this._request.send(this._formatQueryString(this._item.values)):this._request.send()}catch(n){var r=new createjs.Event("error");r.error=n,this._sendError(r)}},t.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},t.getResponseHeader=function(e){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(e):null},t._handleProgress=function(e){if(e&&!(e.loaded>0&&0==e.total)){var t=new createjs.Event("progress");t.loaded=e.loaded,t.total=e.total,this._sendProgress(t)}},t._handleLoadStart=function(){clearTimeout(this._loadTimeout),this._sendLoadStart()},t._handleAbort=function(){this._clean();var e=new createjs.Event("error");e.text="XHR_ABORTED",this._sendError(e)},t._handleError=function(){this._clean();var e=new createjs.Event("error");this._sendError(e)},t._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},t._handleLoad=function(){if(!this.loaded){if(this.loaded=!0,!this._checkError())return this._handleError(),void 0;this._response=this._getResponse(),this._clean();var e=this._generateTag();e&&this._sendComplete()}},t._handleTimeout=function(e){this._clean();var t=new createjs.Event("error");t.text="PRELOAD_TIMEOUT",this._sendError(e)},t._checkError=function(){var e=parseInt(this._request.status);switch(e){case 404:case 0:return!1}return!0},t._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(e){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(e){}return null},t._createXHR=function(e){var t=this._isCrossDomain(e),n=null;if(t&&window.XDomainRequest)n=new XDomainRequest;else if(window.XMLHttpRequest)n=new XMLHttpRequest;else try{n=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(r){try{n=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(r){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(r){return!1}}}createjs.LoadQueue.isText(e.type)&&n.overrideMimeType&&n.overrideMimeType("text/plain; charset=utf-8"),this._xhrLevel="string"==typeof n.responseType?2:1;var i=null;return i=e.method==createjs.LoadQueue.GET?this.buildPath(e.src,e.values):e.src,n.open(e.method||createjs.LoadQueue.GET,i,!0),t&&n instanceof XMLHttpRequest&&1==this._xhrLevel&&n.setRequestHeader("Origin",location.origin),e.values&&e.method==createjs.LoadQueue.POST&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),createjs.LoadQueue.isBinary(e.type)&&(n.responseType="arraybuffer"),this._request=n,!0},t._clean=function(){clearTimeout(this._loadTimeout);var e=this._request;e.onloadstart=null,e.onprogress=null,e.onabort=null,e.onerror=null,e.onload=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null},t._generateTag=function(){var e=this._item.type,t=this._item.tag;switch(e){case createjs.LoadQueue.IMAGE:return t.onload=createjs.proxy(this._handleTagReady,this),""!=this._crossOrigin&&(t.crossOrigin="Anonymous"),t.src=this.buildPath(this._item.src,this._item.values),this._rawResponse=this._response,this._response=t,!1;case createjs.LoadQueue.JAVASCRIPT:return t=document.createElement("script"),t.text=this._response,this._rawResponse=this._response,this._response=t,!0;case createjs.LoadQueue.CSS:var n=document.getElementsByTagName("head")[0];if(n.appendChild(t),t.styleSheet)t.styleSheet.cssText=this._response;else{var r=document.createTextNode(this._response);t.appendChild(r)}return this._rawResponse=this._response,this._response=t,!0;case createjs.LoadQueue.XML:var i=this._parseXML(this._response,"text/xml");return this._rawResponse=this._response,this._response=i,!0;case createjs.LoadQueue.SVG:var i=this._parseXML(this._response,"image/svg+xml");return this._rawResponse=this._response,null!=i.documentElement?(t.appendChild(i.documentElement),this._response=t):this._response=i,!0;case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:var o={};try{o=JSON.parse(this._response)}catch(a){o=a}return this._rawResponse=this._response,this._response=o,!0}return!0},t._parseXML=function(e,t){var n=null;try{if(window.DOMParser){var r=new DOMParser;n=r.parseFromString(e,t)}else n=new ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(e)}catch(i){}return n},t._handleTagReady=function(){this._sendComplete()},t.toString=function(){return"[PreloadJS XHRLoader]"},createjs.XHRLoader=e}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,o,a,s=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(u)){for(o=u.length,n=0;o>n;n+=1)a[n]=str(n,u)||"null";return i=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,u),i&&a.push(quote(r)+(gap?": ":":")+i));else for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(i=str(r,u),i&&a.push(quote(r)+(gap?": ":":")+i));return i=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),this.createjs=this.createjs||{},function(){var e=createjs.SoundJS=createjs.SoundJS||{};e.version="0.5.2",e.buildDate="Thu, 12 Dec 2013 23:33:37 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(){},t=e.prototype;e.initialize=function(e){e.addEventListener=t.addEventListener,e.on=t.on,e.removeEventListener=e.off=t.removeEventListener,e.removeAllEventListeners=t.removeAllEventListeners,e.hasEventListener=t.hasEventListener,e.dispatchEvent=t.dispatchEvent,e._dispatchEvent=t._dispatchEvent,e.willTrigger=t.willTrigger},t._listeners=null,t._captureListeners=null,t.initialize=function(){},t.addEventListener=function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t},t.on=function(e,t,n,r,i,o){return t.handleEvent&&(n=n||t,t=t.handleEvent),n=n||this,this.addEventListener(e,function(e){t.call(n,e,i),r&&e.remove()},o)},t.removeEventListener=function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var o=0,a=i.length;a>o;o++)if(i[o]==t){1==a?delete r[e]:i.splice(o,1);break}}},t.off=t.removeEventListener,t.removeAllEventListeners=function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},t.dispatchEvent=function(e,t){if("string"==typeof e){var n=this._listeners;if(!n||!n[e])return!1;e=new createjs.Event(e)
}if(e.target=t||this,e.bubbles&&this.parent){for(var r=this,i=[r];r.parent;)i.push(r=r.parent);var o,a=i.length;for(o=a-1;o>=0&&!e.propagationStopped;o--)i[o]._dispatchEvent(e,1+(0==o));for(o=1;a>o&&!e.propagationStopped;o++)i[o]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented},t.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},t.willTrigger=function(e){for(var t=this;t;){if(t.hasEventListener(e))return!0;t=t.parent}return!1},t.toString=function(){return"[EventDispatcher]"},t._dispatchEvent=function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;e.currentTarget=this,e.eventPhase=t,e.removed=!1,i=i.slice();for(var o=0;n>o&&!e.immediatePropagationStopped;o++){var a=i[o];a.handleEvent?a.handleEvent(e):a(e),e.removed&&(this.off(e.type,a,1==t),e.removed=!1)}}},createjs.EventDispatcher=e}(),this.createjs=this.createjs||{},function(){"use strict";var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype;t.type=null,t.target=null,t.currentTarget=null,t.eventPhase=0,t.bubbles=!1,t.cancelable=!1,t.timeStamp=0,t.defaultPrevented=!1,t.propagationStopped=!1,t.immediatePropagationStopped=!1,t.removed=!1,t.initialize=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=(new Date).getTime()},t.preventDefault=function(){this.defaultPrevented=!0},t.stopPropagation=function(){this.propagationStopped=!0},t.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.remove=function(){this.removed=!0},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},t.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=e}(),this.createjs=this.createjs||{},function(){"use strict";createjs.indexOf=function(e,t){for(var n=0,r=e.length;r>n;n++)if(t===e[n])return n;return-1}}(),this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,Array.prototype.slice.call(arguments,0).concat(n))}}}(),this.createjs=this.createjs||{},function(){"use strict";function e(){throw"Sound cannot be instantiated"}function t(e,t){this.init(e,t)}function n(){this.isDefault=!0,this.addEventListener=this.removeEventListener=this.removeAllEventListeners=this.dispatchEvent=this.hasEventListener=this._listeners=this._interrupt=this._playFailed=this.pause=this.resume=this.play=this._beginPlaying=this._cleanUp=this.stop=this.setMasterVolume=this.setVolume=this.mute=this.setMute=this.getMute=this.setPan=this.getPosition=this.setPosition=this.playFailed=function(){return!1},this.getVolume=this.getPan=this.getDuration=function(){return 0},this.playState=e.PLAY_FAILED,this.toString=function(){return"[Sound Default Sound Instance]"}}function r(){}var i=e;i.DELIMITER="|",i.INTERRUPT_ANY="any",i.INTERRUPT_EARLY="early",i.INTERRUPT_LATE="late",i.INTERRUPT_NONE="none",i.PLAY_INITED="playInited",i.PLAY_SUCCEEDED="playSucceeded",i.PLAY_INTERRUPTED="playInterrupted",i.PLAY_FINISHED="playFinished",i.PLAY_FAILED="playFailed",i.SUPPORTED_EXTENSIONS=["mp3","ogg","mpeg","wav","m4a","mp4","aiff","wma","mid"],i.EXTENSION_MAP={m4a:"mp4"},i.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,i.defaultInterruptBehavior=i.INTERRUPT_NONE,i.alternateExtensions=[],i._lastID=0,i.activePlugin=null,i._pluginsRegistered=!1,i._masterVolume=1,i._masterMute=!1,i._instances=[],i._idHash={},i._preloadHash={},i._defaultSoundInstance=null,i.addEventListener=null,i.removeEventListener=null,i.removeAllEventListeners=null,i.dispatchEvent=null,i.hasEventListener=null,i._listeners=null,createjs.EventDispatcher.initialize(i),i._sendFileLoadEvent=function(e){if(i._preloadHash[e])for(var t=0,n=i._preloadHash[e].length;n>t;t++){var r=i._preloadHash[e][t];if(i._preloadHash[e][t]=!0,i.hasEventListener("fileload")){var o=new createjs.Event("fileload");o.src=r.src,o.id=r.id,o.data=r.data,i.dispatchEvent(o)}}},i.getPreloadHandlers=function(){return{callback:createjs.proxy(i.initLoad,i),types:["sound"],extensions:i.SUPPORTED_EXTENSIONS}},i.registerPlugin=function(e){try{console.log("createjs.Sound.registerPlugin has been deprecated. Please use registerPlugins.")}catch(t){}return i._registerPlugin(e)},i._registerPlugin=function(e){return i._pluginsRegistered=!0,null==e?!1:e.isSupported()?(i.activePlugin=new e,!0):!1},i.registerPlugins=function(e){for(var t=0,n=e.length;n>t;t++){var r=e[t];if(i._registerPlugin(r))return!0}return!1},i.initializeDefaultPlugins=function(){return null!=i.activePlugin?!0:i._pluginsRegistered?!1:i.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])?!0:!1},i.isReady=function(){return null!=i.activePlugin},i.getCapabilities=function(){return null==i.activePlugin?null:i.activePlugin._capabilities},i.getCapability=function(e){return null==i.activePlugin?null:i.activePlugin._capabilities[e]},i.initLoad=function(e,t,n,r,o){e=e.replace(o,"");var a=i.registerSound(e,n,r,!1,o);return null==a?!1:a},i.registerSound=function(e,n,r,o,a){if(!i.initializeDefaultPlugins())return!1;if(e instanceof Object&&(a=n,n=e.id,r=e.data,e=e.src),i.alternateExtensions.length)var s=i._parsePath2(e,"sound",n,r);else var s=i._parsePath(e,"sound",n,r);if(null==s)return!1;null!=a&&(e=a+e,s.src=a+s.src),null!=n&&(i._idHash[n]=s.src);var u=null;null!=r&&(isNaN(r.channels)?isNaN(r)||(u=parseInt(r)):u=parseInt(r.channels));var l=i.activePlugin.register(s.src,u);if(null!=l&&(null!=l.numChannels&&(u=l.numChannels),t.create(s.src,u),null!=r&&isNaN(r)?r.channels=s.data.channels=u||t.maxPerChannel():r=s.data=u||t.maxPerChannel(),null!=l.tag?s.tag=l.tag:l.src&&(s.src=l.src),null!=l.completeHandler&&(s.completeHandler=l.completeHandler),l.type&&(s.type=l.type)),0!=o)if(i._preloadHash[s.src]||(i._preloadHash[s.src]=[]),i._preloadHash[s.src].push({src:e,id:n,data:r}),1==i._preloadHash[s.src].length)i.activePlugin.preload(s.src,l);else if(1==i._preloadHash[s.src][0])return!0;return s},i.registerManifest=function(e,t){for(var n=[],r=0,i=e.length;i>r;r++)n[r]=createjs.Sound.registerSound(e[r].src,e[r].id,e[r].data,e[r].preload,t);return n},i.removeSound=function(e,n){if(null==i.activePlugin)return!1;if(e instanceof Object&&(e=e.src),e=i._getSrcById(e),i.alternateExtensions.length)var r=i._parsePath2(e);else var r=i._parsePath(e);if(null==r)return!1;null!=n&&(r.src=n+r.src),e=r.src;for(var o in i._idHash)i._idHash[o]==e&&delete i._idHash[o];return t.removeSrc(e),delete i._preloadHash[e],i.activePlugin.removeSound(e),!0},i.removeManifest=function(e,t){for(var n=[],r=0,i=e.length;i>r;r++)n[r]=createjs.Sound.removeSound(e[r].src,t);return n},i.removeAllSounds=function(){i._idHash={},i._preloadHash={},t.removeAll(),i.activePlugin.removeAllSounds()},i.loadComplete=function(e){if(i.alternateExtensions.length)var t=i._parsePath2(e,"sound");else var t=i._parsePath(e,"sound");return e=t?i._getSrcById(t.src):i._getSrcById(e),1==i._preloadHash[e][0]},i._parsePath=function(e,t,n,r){"string"!=typeof e&&(e=e.toString());var o=e.split(i.DELIMITER);if(o.length>1)try{console.log('createjs.Sound.DELIMITER "|" loading approach has been deprecated. Please use the new alternateExtensions property.')}catch(a){}for(var s={type:t||"sound",id:n,data:r},u=i.getCapabilities(),l=0,c=o.length;c>l;l++){var h=o[l],f=h.match(i.FILE_PATTERN);if(null==f)return!1;var d=f[4],p=f[5];if(u[p]&&createjs.indexOf(i.SUPPORTED_EXTENSIONS,p)>-1)return s.name=d,s.src=h,s.extension=p,s}return null},i._parsePath2=function(e,t,n,r){"string"!=typeof e&&(e=e.toString());var o=e.match(i.FILE_PATTERN);if(null==o)return!1;for(var a=o[4],s=o[5],u=i.getCapabilities(),l=0;!u[s];)if(s=i.alternateExtensions[l++],l>i.alternateExtensions.length)return null;e=e.replace("."+o[5],"."+s);var c={type:t||"sound",id:n,data:r};return c.name=a,c.src=e,c.extension=s,c},i.play=function(e,t,n,r,o,a,s){var u=i.createInstance(e),l=i._playInstance(u,t,n,r,o,a,s);return l||u.playFailed(),u},i.createInstance=function(n){if(!i.initializeDefaultPlugins())return i._defaultSoundInstance;if(n=i._getSrcById(n),i.alternateExtensions.length)var r=i._parsePath2(n,"sound");else var r=i._parsePath(n,"sound");var o=null;return null!=r&&null!=r.src?(t.create(r.src),o=i.activePlugin.create(r.src)):o=e._defaultSoundInstance,o.uniqueId=i._lastID++,o},i.setVolume=function(e){if(null==Number(e))return!1;if(e=Math.max(0,Math.min(1,e)),i._masterVolume=e,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(e))for(var t=this._instances,n=0,r=t.length;r>n;n++)t[n].setMasterVolume(e)},i.getVolume=function(){return i._masterVolume},i.setMute=function(e){if(null==e||void 0==e)return!1;if(this._masterMute=e,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(e))for(var t=this._instances,n=0,r=t.length;r>n;n++)t[n].setMasterMute(e);return!0},i.getMute=function(){return this._masterMute},i.stop=function(){for(var e=this._instances,t=e.length;t--;)e[t].stop()},i._playInstance=function(e,t,n,r,o,a,s){if(t instanceof Object&&(n=t.delay,r=t.offset,o=t.loop,a=t.volume,s=t.pan,t=t.interrupt),t=t||i.defaultInterruptBehavior,null==n&&(n=0),null==r&&(r=e.getPosition()),null==o&&(o=0),null==a&&(a=e.volume),null==s&&(s=e.pan),0==n){var u=i._beginPlaying(e,t,r,o,a,s);if(!u)return!1}else{var l=setTimeout(function(){i._beginPlaying(e,t,r,o,a,s)},n);e._delayTimeoutId=l}return this._instances.push(e),!0},i._beginPlaying=function(e,n,r,i,o,a){if(!t.add(e,n))return!1;var s=e._beginPlaying(r,i,o,a);if(!s){var u=createjs.indexOf(this._instances,e);return u>-1&&this._instances.splice(u,1),!1}return!0},i._getSrcById=function(e){return null==i._idHash||null==i._idHash[e]?e:i._idHash[e]},i._playFinished=function(e){t.remove(e);var n=createjs.indexOf(this._instances,e);n>-1&&this._instances.splice(n,1)},createjs.Sound=e,t.channels={},t.create=function(e,n){var r=t.get(e);return null==r?(t.channels[e]=new t(e,n),!0):!1},t.removeSrc=function(e){var n=t.get(e);return null==n?!1:(n.removeAll(),delete t.channels[e],!0)},t.removeAll=function(){for(var e in t.channels)t.channels[e].removeAll();t.channels={}},t.add=function(e,n){var r=t.get(e.src);return null==r?!1:r.add(e,n)},t.remove=function(e){var n=t.get(e.src);return null==n?!1:(n.remove(e),!0)},t.maxPerChannel=function(){return o.maxDefault},t.get=function(e){return t.channels[e]};var o=t.prototype;o.src=null,o.max=null,o.maxDefault=100,o.length=0,o.init=function(e,t){this.src=e,this.max=t||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},o.get=function(e){return this._instances[e]},o.add=function(e,t){return this.getSlot(t,e)?(this._instances.push(e),this.length++,!0):!1},o.remove=function(e){var t=createjs.indexOf(this._instances,e);return-1==t?!1:(this._instances.splice(t,1),this.length--,!0)},o.removeAll=function(){for(var e=this.length-1;e>=0;e--)this._instances[e].stop()},o.getSlot=function(t){for(var n,r,i=0,o=this.max;o>i;i++){if(n=this.get(i),null==n)return!0;(t!=e.INTERRUPT_NONE||n.playState==e.PLAY_FINISHED)&&(0!=i?n.playState==e.PLAY_FINISHED||n.playState==e.PLAY_INTERRUPTED||n.playState==e.PLAY_FAILED?r=n:(t==e.INTERRUPT_EARLY&&n.getPosition()<r.getPosition()||t==e.INTERRUPT_LATE&&n.getPosition()>r.getPosition())&&(r=n):r=n)}return null!=r?(r._interrupt(),this.remove(r),!0):!1},o.toString=function(){return"[Sound SoundChannel]"},e._defaultSoundInstance=new n,r.init=function(){var e=window.navigator.userAgent;r.isFirefox=e.indexOf("Firefox")>-1,r.isOpera=null!=window.opera,r.isChrome=e.indexOf("Chrome")>-1,r.isIOS=e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1,r.isAndroid=e.indexOf("Android")>-1,r.isBlackberry=e.indexOf("Blackberry")>-1},r.init(),createjs.Sound.BrowserDetect=r}(),this.createjs=this.createjs||{},function(){"use strict";function e(){this._init()}var t=e;t._capabilities=null,t.isSupported=function(){var e=createjs.Sound.BrowserDetect.isIOS||createjs.Sound.BrowserDetect.isAndroid||createjs.Sound.BrowserDetect.isBlackberry;return"file:"!=location.protocol||e||this._isFileXHRSupported()?(t._generateCapabilities(),null==t.context?!1:!0):!1},t._isFileXHRSupported=function(){var e=!0,t=new XMLHttpRequest;try{t.open("GET","fail.fail",!1)}catch(n){return e=!1}t.onerror=function(){e=!1},t.onload=function(){e=404==this.status||200==this.status||0==this.status&&""!=this.response};try{t.send()}catch(n){e=!1}return e},t._generateCapabilities=function(){if(null==t._capabilities){var e=document.createElement("audio");if(null==e.canPlayType)return null;if(window.webkitAudioContext)t.context=new webkitAudioContext;else{if(!window.AudioContext)return null;t.context=new AudioContext}t._compatibilitySetUp(),t.playEmptySound(),t._capabilities={panning:!0,volume:!0,tracks:-1};for(var n=createjs.Sound.SUPPORTED_EXTENSIONS,r=createjs.Sound.EXTENSION_MAP,i=0,o=n.length;o>i;i++){var a=n[i],s=r[a]||a;t._capabilities[a]="no"!=e.canPlayType("audio/"+a)&&""!=e.canPlayType("audio/"+a)||"no"!=e.canPlayType("audio/"+s)&&""!=e.canPlayType("audio/"+s)}t.context.destination.numberOfChannels<2&&(t._capabilities.panning=!1),t.dynamicsCompressorNode=t.context.createDynamicsCompressor(),t.dynamicsCompressorNode.connect(t.context.destination),t.gainNode=t.context.createGain(),t.gainNode.connect(t.dynamicsCompressorNode)}},t._compatibilitySetUp=function(){if(!t.context.createGain){t.context.createGain=t.context.createGainNode;var e=t.context.createBufferSource();e.__proto__.start=e.__proto__.noteGrainOn,e.__proto__.stop=e.__proto__.noteOff,this._panningModel=0}},t.playEmptySound=function(){var e=this.context.createBuffer(1,1,22050),t=this.context.createBufferSource();t.buffer=e,t.connect(this.context.destination),t.start(0,0,0)};var n=e.prototype;n._capabilities=null,n._volume=1,n.context=null,n._panningModel="equalpower",n.dynamicsCompressorNode=null,n.gainNode=null,n._arrayBuffers=null,n._init=function(){this._capabilities=t._capabilities,this._arrayBuffers={},this.context=t.context,this.gainNode=t.gainNode,this.dynamicsCompressorNode=t.dynamicsCompressorNode},n.register=function(e){this._arrayBuffers[e]=!0;var t=new createjs.WebAudioPlugin.Loader(e,this);return{tag:t}},n.isPreloadStarted=function(e){return null!=this._arrayBuffers[e]},n.isPreloadComplete=function(e){return!(null==this._arrayBuffers[e]||1==this._arrayBuffers[e])},n.removeSound=function(e){delete this._arrayBuffers[e]},n.removeAllSounds=function(){this._arrayBuffers={}},n.addPreloadResults=function(e,t){this._arrayBuffers[e]=t},n._handlePreloadComplete=function(){createjs.Sound._sendFileLoadEvent(this.src)},n.preload=function(e){this._arrayBuffers[e]=!0;var t=new createjs.WebAudioPlugin.Loader(e,this);t.onload=this._handlePreloadComplete,t.load()},n.create=function(e){return this.isPreloadStarted(e)||this.preload(e),new createjs.WebAudioPlugin.SoundInstance(e,this)},n.setVolume=function(e){return this._volume=e,this._updateVolume(),!0},n._updateVolume=function(){var e=createjs.Sound._masterMute?0:this._volume;e!=this.gainNode.gain.value&&(this.gainNode.gain.value=e)},n.getVolume=function(){return this._volume},n.setMute=function(){return this._updateVolume(),!0},n.toString=function(){return"[WebAudioPlugin]"},createjs.WebAudioPlugin=e}(),function(){"use strict";function e(e,t){this._init(e,t)}var t=e.prototype=new createjs.EventDispatcher;t.src=null,t.uniqueId=-1,t.playState=null,t._owner=null,t._offset=0,t._delay=0,t._volume=1;try{Object.defineProperty(t,"volume",{get:function(){return this._volume},set:function(e){return null==Number(e)?!1:(e=Math.max(0,Math.min(1,e)),this._volume=e,this._updateVolume(),void 0)}})}catch(n){}t._pan=0;try{Object.defineProperty(t,"pan",{get:function(){return this._pan},set:function(e){return this._owner._capabilities.panning&&null!=Number(e)?(e=Math.max(-1,Math.min(1,e)),this._pan=e,this.panNode.setPosition(e,0,-.5),void 0):!1}})}catch(n){}t._duration=0,t._remainingLoops=0,t._delayTimeoutId=null,t._soundCompleteTimeout=null,t.gainNode=null,t.panNode=null,t.sourceNode=null,t._sourceNodeNext=null,t._muted=!1,t._paused=!1,t._startTime=0,t._endedHandler=null,t._sendEvent=function(e){var t=new createjs.Event(e);this.dispatchEvent(t)},t._init=function(e,t){this._owner=t,this.src=e,this.gainNode=this._owner.context.createGain(),this.panNode=this._owner.context.createPanner(),this.panNode.panningModel=this._owner._panningModel,this.panNode.connect(this.gainNode),this._owner.isPreloadComplete(this.src)&&(this._duration=1e3*this._owner._arrayBuffers[this.src].duration),this._endedHandler=createjs.proxy(this._handleSoundComplete,this)},t._cleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._delayTimeoutId),clearTimeout(this._soundCompleteTimeout),this._startTime=0,null!=window.createjs&&createjs.Sound._playFinished(this)},t._cleanUpAudioNode=function(e){return e&&(e.stop(0),e.disconnect(this.panNode),e=null),e},t._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._paused=!1,this._sendEvent("interrupted")},t._handleSoundReady=function(){if(null!=window.createjs){if(1e3*this._offset>this.getDuration())return this.playFailed(),void 0;this._offset<0&&(this._offset=0),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._paused=!1,this.gainNode.connect(this._owner.gainNode);var e=this._owner._arrayBuffers[this.src].duration;this.sourceNode=this._createAndPlayAudioNode(this._owner.context.currentTime-e,this._offset),this._duration=1e3*e,this._startTime=this.sourceNode.startTime-this._offset,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(e-this._offset)),0!=this._remainingLoops&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._startTime,0))}},t._createAndPlayAudioNode=function(e,t){var n=this._owner.context.createBufferSource();return n.buffer=this._owner._arrayBuffers[this.src],n.connect(this.panNode),this._owner.context.currentTime,n.startTime=e+n.buffer.duration,n.start(n.startTime,t,n.buffer.duration-t),n},t.play=function(e,t,n,r,i,o){this._cleanUp(),createjs.Sound._playInstance(this,e,t,n,r,i,o)},t._beginPlaying=function(e,t,n,r){return null!=window.createjs&&this.src?(this._offset=e/1e3,this._remainingLoops=t,this.volume=n,this.pan=r,this._owner.isPreloadComplete(this.src)?(this._handleSoundReady(null),this._sendEvent("succeeded"),1):(this.playFailed(),void 0)):void 0},t.pause=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED?!1:(this._paused=!0,this._offset=this._owner.context.currentTime-this._startTime,this._cleanUpAudioNode(this.sourceNode),this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(),clearTimeout(this._delayTimeoutId),clearTimeout(this._soundCompleteTimeout),!0)},t.resume=function(){return this._paused?(this._handleSoundReady(null),!0):!1},t.stop=function(){return this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._offset=0,!0},t.setVolume=function(e){return this.volume=e,!0},t._updateVolume=function(){var e=this._muted?0:this._volume;return e!=this.gainNode.gain.value?(this.gainNode.gain.value=e,!0):!1},t.getVolume=function(){return this.volume},t.setMute=function(e){return null==e||void 0==e?!1:(this._muted=e,this._updateVolume(),!0)},t.getMute=function(){return this._muted},t.setPan=function(e){return this.pan=e,this.pan!=e?!1:void 0},t.getPan=function(){return this.pan},t.getPosition=function(){if(this._paused||null==this.sourceNode)var e=this._offset;else var e=this._owner.context.currentTime-this._startTime;return 1e3*e},t.setPosition=function(e){return this._offset=e/1e3,this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._cleanUpAudioNode(this.sourceNode),this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout)),this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||this._handleSoundReady(null),!0},t.getDuration=function(){return this._duration},t._handleSoundComplete=function(){return this._offset=0,0!=this._remainingLoops?(this._remainingLoops--,this._sourceNodeNext?(this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._startTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._startTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)):this._handleSoundReady(null),this._sendEvent("loop"),void 0):(null!=window.createjs&&(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._sendEvent("complete")),void 0)},t.playFailed=function(){null!=window.createjs&&(this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed"))},t.toString=function(){return"[WebAudioPlugin SoundInstance]"},createjs.WebAudioPlugin.SoundInstance=e}(),function(){"use strict";function e(e,t){this._init(e,t)}var t=e.prototype;t.request=null,t.owner=null,t.progress=-1,t.src=null,t.originalSrc=null,t.result=null,t.onload=null,t.onprogress=null,t.onError=null,t._init=function(e,t){this.src=e,this.originalSrc=e,this.owner=t},t.load=function(e){null!=e&&(this.src=e),this.request=new XMLHttpRequest,this.request.open("GET",this.src,!0),this.request.responseType="arraybuffer",this.request.onload=createjs.proxy(this.handleLoad,this),this.request.onError=createjs.proxy(this.handleError,this),this.request.onprogress=createjs.proxy(this.handleProgress,this),this.request.send()},t.handleProgress=function(e,t){this.progress=e/t,null!=this.onprogress&&this.onprogress({loaded:e,total:t,progress:this.progress})},t.handleLoad=function(){this.owner.context.decodeAudioData(this.request.response,createjs.proxy(this.handleAudioDecoded,this),createjs.proxy(this.handleError,this))},t.handleAudioDecoded=function(e){this.progress=1,this.result=e,this.src=this.originalSrc,this.owner.addPreloadResults(this.src,this.result),this.onload&&this.onload()},t.handleError=function(e){this.owner.removeSound(this.src),this.onerror&&this.onerror(e)},t.toString=function(){return"[WebAudioPlugin Loader]"},createjs.WebAudioPlugin.Loader=e}(),this.createjs=this.createjs||{},function(){"use strict";function e(){this._init()}var t=e;t.MAX_INSTANCES=30,t._AUDIO_READY="canplaythrough",t._AUDIO_ENDED="ended",t._AUDIO_SEEKED="seeked",t._AUDIO_STALLED="stalled",t._capabilities=null,t.enableIOS=!1,t.isSupported=function(){if(createjs.Sound.BrowserDetect.isIOS&&!t.enableIOS)return!1;t._generateCapabilities();var e=t.tag;return null==e||null==t._capabilities?!1:!0},t._generateCapabilities=function(){if(null==t._capabilities){var e=t.tag=document.createElement("audio");if(null==e.canPlayType)return null;t._capabilities={panning:!0,volume:!0,tracks:-1};for(var n=createjs.Sound.SUPPORTED_EXTENSIONS,r=createjs.Sound.EXTENSION_MAP,i=0,o=n.length;o>i;i++){var a=n[i],s=r[a]||a;t._capabilities[a]="no"!=e.canPlayType("audio/"+a)&&""!=e.canPlayType("audio/"+a)||"no"!=e.canPlayType("audio/"+s)&&""!=e.canPlayType("audio/"+s)}}};var n=e.prototype;n._capabilities=null,n._audioSources=null,n.defaultNumChannels=2,n.loadedHandler=null,n._init=function(){this._capabilities=t._capabilities,this._audioSources={}},n.register=function(e,t){this._audioSources[e]=!0;for(var n=createjs.HTMLAudioPlugin.TagPool.get(e),r=null,i=t||this.defaultNumChannels,o=0;i>o;o++)r=this._createTag(e),n.add(r);if(r.id=e,this.loadedHandler=createjs.proxy(this._handleTagLoad,this),r.addEventListener&&r.addEventListener("canplaythrough",this.loadedHandler),null==r.onreadystatechange)r.onreadystatechange=this.loadedHandler;else{var a=r.onreadystatechange;r.onreadystatechange=function(){a(),this.loadedHandler()}}return{tag:r,numChannels:i}},n._handleTagLoad=function(e){e.target.removeEventListener&&e.target.removeEventListener("canplaythrough",this.loadedHandler),e.target.onreadystatechange=null,e.target.src!=e.target.id&&createjs.HTMLAudioPlugin.TagPool.checkSrc(e.target.id)},n._createTag=function(e){var t=document.createElement("audio");return t.autoplay=!1,t.preload="none",t.src=e,t},n.removeSound=function(e){delete this._audioSources[e],createjs.HTMLAudioPlugin.TagPool.remove(e)},n.removeAllSounds=function(){this._audioSources={},createjs.HTMLAudioPlugin.TagPool.removeAll()},n.create=function(e){if(!this.isPreloadStarted(e)){var t=createjs.HTMLAudioPlugin.TagPool.get(e),n=this._createTag(e);n.id=e,t.add(n),this.preload(e,{tag:n})}return new createjs.HTMLAudioPlugin.SoundInstance(e,this)},n.isPreloadStarted=function(e){return null!=this._audioSources[e]},n.preload=function(e,t){this._audioSources[e]=!0,new createjs.HTMLAudioPlugin.Loader(e,t.tag)},n.toString=function(){return"[HTMLAudioPlugin]"},createjs.HTMLAudioPlugin=e}(),function(){"use strict";function e(e,t){this._init(e,t)}var t=e.prototype=new createjs.EventDispatcher;t.src=null,t.uniqueId=-1,t.playState=null,t._owner=null,t.loaded=!1,t._offset=0,t._delay=0,t._volume=1;try{Object.defineProperty(t,"volume",{get:function(){return this._volume},set:function(e){null!=Number(e)&&(e=Math.max(0,Math.min(1,e)),this._volume=e,this._updateVolume())}})}catch(n){}t.pan=0,t._duration=0,t._remainingLoops=0,t._delayTimeoutId=null,t.tag=null,t._muted=!1,t._paused=!1,t._endedHandler=null,t._readyHandler=null,t._stalledHandler=null,t.loopHandler=null,t._init=function(e,t){this.src=e,this._owner=t,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleSoundReady,this),this._stalledHandler=createjs.proxy(this._handleSoundStalled,this),this.loopHandler=createjs.proxy(this.handleSoundLoop,this)},t._sendEvent=function(e){var t=new createjs.Event(e);this.dispatchEvent(t)},t._cleanUp=function(){var e=this.tag;if(null!=e){e.pause(),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1);try{e.currentTime=0}catch(t){}createjs.HTMLAudioPlugin.TagPool.setInstance(this.src,e),this.tag=null}clearTimeout(this._delayTimeoutId),null!=window.createjs&&createjs.Sound._playFinished(this)},t._interrupt=function(){null!=this.tag&&(this.playState=createjs.Sound.PLAY_INTERRUPTED,this._cleanUp(),this._paused=!1,this._sendEvent("interrupted"))},t.play=function(e,t,n,r,i,o){this._cleanUp(),createjs.Sound._playInstance(this,e,t,n,r,i,o)},t._beginPlaying=function(e,t,n,r){if(null==window.createjs)return-1;var i=this.tag=createjs.HTMLAudioPlugin.TagPool.getInstance(this.src);return null==i?(this.playFailed(),-1):(i.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._offset=e,this.volume=n,this.pan=r,this._updateVolume(),this._remainingLoops=t,4!==i.readyState?(i.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),i.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),i.preload="auto",i.load()):this._handleSoundReady(null),this._sendEvent("succeeded"),1)},t._handleSoundStalled=function(){this._cleanUp(),this._sendEvent("failed")},t._handleSoundReady=function(){if(null!=window.createjs){if(this._duration=1e3*this.tag.duration,this.playState=createjs.Sound.PLAY_SUCCEEDED,this._paused=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._offset>=this.getDuration())return this.playFailed(),void 0;this._offset>0&&(this.tag.currentTime=.001*this._offset),-1==this._remainingLoops&&(this.tag.loop=!0),0!=this._remainingLoops&&(this.tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1),this.tag.loop=!0),this.tag.play()}},t.pause=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||null==this.tag?!1:(this._paused=!0,this.tag.pause(),clearTimeout(this._delayTimeoutId),!0)},t.resume=function(){return this._paused&&null!=this.tag?(this._paused=!1,this.tag.play(),!0):!1},t.stop=function(){return this._offset=0,this.pause(),this.playState=createjs.Sound.PLAY_FINISHED,this._cleanUp(),!0},t.setMasterVolume=function(){return this._updateVolume(),!0},t.setVolume=function(e){return this.volume=e,!0},t._updateVolume=function(){if(null!=this.tag){var e=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;return e!=this.tag.volume&&(this.tag.volume=e),!0}return!1},t.getVolume=function(){return this.volume},t.setMasterMute=function(){return this._updateVolume(),!0},t.setMute=function(e){return null==e||void 0==e?!1:(this._muted=e,this._updateVolume(),!0)},t.getMute=function(){return this._muted},t.setPan=function(){return!1},t.getPan=function(){return 0},t.getPosition=function(){return null==this.tag?this._offset:1e3*this.tag.currentTime},t.setPosition=function(e){if(null==this.tag)this._offset=e;else{this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1);try{this.tag.currentTime=.001*e}catch(t){return!1}this.tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1)}return!0},t.getDuration=function(){return this._duration},t._handleSoundComplete=function(){this._offset=0,null!=window.createjs&&(this.playState=createjs.Sound.PLAY_FINISHED,this._cleanUp(),this._sendEvent("complete"))},t.handleSoundLoop=function(){this._offset=0,this._remainingLoops--,0==this._remainingLoops&&(this.tag.loop=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1)),this._sendEvent("loop")},t.playFailed=function(){null!=window.createjs&&(this.playState=createjs.Sound.PLAY_FAILED,this._cleanUp(),this._sendEvent("failed"))},t.toString=function(){return"[HTMLAudioPlugin SoundInstance]"},createjs.HTMLAudioPlugin.SoundInstance=e}(),function(){"use strict";function e(e,t){this._init(e,t)}var t=e.prototype;t.src=null,t.tag=null,t.preloadTimer=null,t.loadedHandler=null,t._init=function(e,t){if(this.src=e,this.tag=t,this.preloadTimer=setInterval(createjs.proxy(this.preloadTick,this),200),this.loadedHandler=createjs.proxy(this.sendLoadedEvent,this),this.tag.addEventListener&&this.tag.addEventListener("canplaythrough",this.loadedHandler),null==this.tag.onreadystatechange)this.tag.onreadystatechange=createjs.proxy(this.sendLoadedEvent,this);else{var n=this.tag.onreadystatechange;this.tag.onreadystatechange=function(){n(),this.tag.onreadystatechange=createjs.proxy(this.sendLoadedEvent,this)}}this.tag.preload="auto",this.tag.load()},t.preloadTick=function(){var e=this.tag.buffered,t=this.tag.duration;e.length>0&&e.end(0)>=t-1&&this.handleTagLoaded()},t.handleTagLoaded=function(){clearInterval(this.preloadTimer)},t.sendLoadedEvent=function(){this.tag.removeEventListener&&this.tag.removeEventListener("canplaythrough",this.loadedHandler),this.tag.onreadystatechange=null,createjs.Sound._sendFileLoadEvent(this.src)},t.toString=function(){return"[HTMLAudioPlugin Loader]"},createjs.HTMLAudioPlugin.Loader=e}(),function(){"use strict";function e(e){this._init(e)}var t=e;t.tags={},t.get=function(n){var r=t.tags[n];return null==r&&(r=t.tags[n]=new e(n)),r},t.remove=function(e){var n=t.tags[e];return null==n?!1:(n.removeAll(),delete t.tags[e],!0)},t.removeAll=function(){for(var e in t.tags)t.tags[e].removeAll();t.tags={}},t.getInstance=function(e){var n=t.tags[e];return null==n?null:n.get()},t.setInstance=function(e,n){var r=t.tags[e];return null==r?null:r.set(n)},t.checkSrc=function(e){var n=t.tags[e];return null==n?null:(n.checkSrcChange(),void 0)};var n=e.prototype;n.src=null,n.length=0,n.available=0,n.tags=null,n._init=function(e){this.src=e,this.tags=[]},n.add=function(e){this.tags.push(e),this.length++,this.available++},n.removeAll=function(){for(;this.length--;)delete this.tags[this.length];this.src=null,this.tags.length=0},n.get=function(){if(0==this.tags.length)return null;this.available=this.tags.length;var e=this.tags.pop();return null==e.parentNode&&document.body.appendChild(e),e
},n.set=function(e){var t=createjs.indexOf(this.tags,e);-1==t&&this.tags.push(e),this.available=this.tags.length},n.checkSrcChange=function(){for(var e=this.tags.length-1,t=this.tags[e].src;e--;)this.tags[e].src=t},n.toString=function(){return"[HTMLAudioPlugin TagPool]"},createjs.HTMLAudioPlugin.TagPool=e}(),function(e){function t(){var e=-1,t=this;t.append=function(n){var r,i=t.table;for(r=0;r<n.length;r++)e=e>>>8^i[255&(e^n[r])]},t.get=function(){return~e}}function n(e,t,n){return e.slice?e.slice(t,t+n):e.webkitSlice?e.webkitSlice(t,t+n):e.mozSlice?e.mozSlice(t,t+n):e.msSlice?e.msSlice(t,t+n):void 0}function r(e,t){var n,r;return n=new ArrayBuffer(e),r=new Uint8Array(n),t&&r.set(t,0),{buffer:n,array:r,view:new DataView(n)}}function i(){}function o(e){function t(t,n){var o=new Blob([e],{type:D});r=new s(o),r.init(function(){i.size=r.size,t()},n)}function n(e,t,n,i){r.readUint8Array(e,t,n,i)}var r,i=this;i.size=0,i.init=t,i.readUint8Array=n}function a(t){function n(e){for(var n=t.length;"="==t.charAt(n-1);)n--;o=t.indexOf(",")+1,a.size=Math.floor(.75*(n-o)),e()}function i(n,i,a){var s,u=r(i),l=4*Math.floor(n/3),c=4*Math.ceil((n+i)/3),h=e.atob(t.substring(l+o,c+o)),f=n-3*Math.floor(l/4);for(s=f;f+i>s;s++)u.array[s-f]=h.charCodeAt(s);a(u.array)}var o,a=this;a.size=0,a.init=n,a.readUint8Array=i}function s(e){function t(t){this.size=e.size,t()}function r(t,r,i,o){var a=new FileReader;a.onload=function(e){i(new Uint8Array(e.target.result))},a.onerror=o,a.readAsArrayBuffer(n(e,t,r))}var i=this;i.size=0,i.init=t,i.readUint8Array=r}function u(){}function l(e){function t(e){i=new Blob([],{type:D}),e()}function n(e,t){i=new Blob([i,S?e:e.buffer],{type:D}),t()}function r(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=n,r.readAsText(i,e)}var i,o=this;o.init=t,o.writeUint8Array=n,o.getData=r}function c(t){function n(e){a+="data:"+(t||"")+";base64,",e()}function r(t,n){var r,i=s.length,o=s;for(s="",r=0;r<3*Math.floor((i+t.length)/3)-i;r++)o+=String.fromCharCode(t[r]);for(;r<t.length;r++)s+=String.fromCharCode(t[r]);o.length>2?a+=e.btoa(o):s=o,n()}function i(t){t(a+e.btoa(s))}var o=this,a="",s="";o.init=n,o.writeUint8Array=r,o.getData=i}function h(e){function t(t){i=new Blob([],{type:e}),t()}function n(t,n){i=new Blob([i,S?t:t.buffer],{type:e}),n()}function r(e){e(i)}var i,o=this;o.init=t,o.writeUint8Array=n,o.getData=r}function f(e,t,n,r,i,o,a,s,u,l){function c(){e.removeEventListener(F,h,!1),s(p)}function h(e){var t=e.data,r=t.data;t.onappend&&(p+=r.length,n.writeUint8Array(r,function(){o(!1,r),f()},l)),t.onflush&&(r?(p+=r.length,n.writeUint8Array(r,function(){o(!1,r),c()},l)):c()),t.progress&&a&&a(d+t.current,i)}function f(){d=g*M,i>d?t.readUint8Array(r+d,Math.min(M,i-d),function(t){e.postMessage({append:!0,data:t}),g++,a&&a(d,i),o(!0,t)},u):e.postMessage({flush:!0})}var d,p,g=0;p=0,e.addEventListener(F,h,!1),f()}function d(e,t,n,r,i,o,a,s,u,l){function c(){var p;h=f*M,i>h?t.readUint8Array(r+h,Math.min(M,i-h),function(t){var s=e.append(t,function(){a&&a(r+h,i)});d+=s.length,o(!0,t),n.writeUint8Array(s,function(){o(!1,s),f++,setTimeout(c,1)},l),a&&a(h,i)},u):(p=e.flush(),p?(d+=p.length,n.writeUint8Array(p,function(){o(!1,p),s(d)},l)):s(d))}var h,f=0,d=0;c()}function p(n,r,i,o,a,s,u,l,c){function h(e,t){a&&!e&&m.append(t)}function p(e){s(e,m.get())}var g,m=new t;return e.zip.useWebWorkers?(g=new Worker(e.zip.workerScriptsPath+q),f(g,n,r,i,o,h,u,p,l,c)):d(new e.zip.Inflater,n,r,i,o,h,u,p,l,c),g}function g(n,r,i,o,a,s,u){function l(e,t){e&&g.append(t)}function c(e){o(e,g.get())}function h(){p.removeEventListener(F,h,!1),f(p,n,r,0,n.size,l,a,c,s,u)}var p,g=new t;return e.zip.useWebWorkers?(p=new Worker(e.zip.workerScriptsPath+N),p.addEventListener(F,h,!1),p.postMessage({init:!0,level:i})):d(new e.zip.Deflater,n,r,0,n.size,l,a,c,s,u),p}function m(e,n,r,i,o,a,s,u,l){function c(){var t=h*M;i>t?e.readUint8Array(r+t,Math.min(M,i-t),function(e){o&&f.append(e),s&&s(t,i,e),n.writeUint8Array(e,function(){h++,c()},l)},u):a(i,f.get())}var h=0,f=new t;c()}function v(e){var t,n,r="",i=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(t=0;t<e.length;t++)n=255&e.charCodeAt(t),r+=n>127?i[n-128]:String.fromCharCode(n);return r}function y(e){return decodeURIComponent(escape(e))}function b(e){var t,n="";for(t=0;t<e.length;t++)n+=String.fromCharCode(e[t]);return n}function _(e){var t=(4294901760&e)>>16,n=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&n)>>11,(2016&n)>>5,2*(31&n),0)}catch(r){}}function x(e,t,n,r,i){return e.version=t.view.getUint16(n,!0),e.bitFlag=t.view.getUint16(n+2,!0),e.compressionMethod=t.view.getUint16(n+4,!0),e.lastModDateRaw=t.view.getUint32(n+6,!0),e.lastModDate=_(e.lastModDateRaw),1===(1&e.bitFlag)?(i(C),void 0):((r||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(n+10,!0),e.compressedSize=t.view.getUint32(n+14,!0),e.uncompressedSize=t.view.getUint32(n+18,!0)),4294967295===e.compressedSize||4294967295===e.uncompressedSize?(i(L),void 0):(e.filenameLength=t.view.getUint16(n+22,!0),e.extraFieldLength=t.view.getUint16(n+24,!0),void 0))}function w(e,t){function n(){}function i(n,o){e.readUint8Array(e.size-n,n,function(e){var t=r(e.length,e).view;1347093766!=t.getUint32(0)?i(n+1,o):o(t)},function(){t(P)})}return n.prototype.getData=function(n,i,o,a){function s(e,t){f&&f.terminate(),f=null,e&&e(t)}function u(e){var t=r(4);return t.view.setUint32(0,e),d.crc32==t.view.getUint32(0)}function l(e,t){a&&!u(t)?c():n.getData(function(e){s(i,e)})}function c(){s(t,O)}function h(){s(t,k)}var f,d=this;e.readUint8Array(d.offset,30,function(i){var s,u=r(i.length,i);return 1347093252!=u.view.getUint32(0)?(t(j),void 0):(x(d,u,4,!1,t),s=d.offset+30+d.filenameLength+d.extraFieldLength,n.init(function(){0===d.compressionMethod?m(e,n,s,d.compressedSize,a,l,o,c,h):f=p(e,n,s,d.compressedSize,a,l,o,c,h)},h),void 0)},c)},{getEntries:function(o){return e.size<22?(t(j),void 0):(i(22,function(i){var a,s;a=i.getUint32(16,!0),s=i.getUint16(8,!0),e.readUint8Array(a,e.size-a,function(e){var i,a,u,l,c=0,h=[],f=r(e.length,e);for(i=0;s>i;i++){if(a=new n,1347092738!=f.view.getUint32(c))return t(j),void 0;x(a,f,c+6,!0,t),a.commentLength=f.view.getUint16(c+32,!0),a.directory=16==(16&f.view.getUint8(c+38)),a.offset=f.view.getUint32(c+42,!0),u=b(f.array.subarray(c+46,c+46+a.filenameLength)),a.filename=2048===(2048&a.bitFlag)?y(u):v(u),a.directory||"/"!=a.filename.charAt(a.filename.length-1)||(a.directory=!0),l=b(f.array.subarray(c+46+a.filenameLength+a.extraFieldLength,c+46+a.filenameLength+a.extraFieldLength+a.commentLength)),a.comment=2048===(2048&a.bitFlag)?y(l):v(l),h.push(a),c+=46+a.filenameLength+a.extraFieldLength+a.commentLength}o(h)},function(){t(P)})}),void 0)},close:function(e){e&&e()}}}function T(e){return unescape(encodeURIComponent(e))}function A(e){var t,n=[];for(t=0;t<e.length;t++)n.push(e.charCodeAt(t));return n}function E(e,t,n){function i(e,t){s&&s.terminate(),s=null,e&&e(t)}function o(){i(t,R)}function a(){i(t,O)}var s,u={},l=[],c=0;return{add:function(h,f,d,p,v){function y(t){var i;E=v.lastModDate||new Date,x=r(26),u[h]={headerArray:x.array,directory:v.directory,filename:w,offset:c,comment:A(T(v.comment||""))},x.view.setUint32(0,335546376),v.version&&x.view.setUint8(0,v.version),n||0===v.level||v.directory||x.view.setUint16(4,2048),x.view.setUint16(6,(E.getHours()<<6|E.getMinutes())<<5|E.getSeconds()/2,!0),x.view.setUint16(8,(E.getFullYear()-1980<<4|E.getMonth()+1)<<5|E.getDate(),!0),x.view.setUint16(22,w.length,!0),i=r(30+w.length),i.view.setUint32(0,1347093252),i.array.set(x.array,4),i.array.set(w,30),c+=i.array.length,e.writeUint8Array(i.array,t,o)}function b(t,n){var a=r(16);c+=t||0,a.view.setUint32(0,1347094280),"undefined"!=typeof n&&(x.view.setUint32(10,n,!0),a.view.setUint32(4,n,!0)),f&&(a.view.setUint32(8,t,!0),x.view.setUint32(14,t,!0),a.view.setUint32(12,f.size,!0),x.view.setUint32(18,f.size,!0)),e.writeUint8Array(a.array,function(){c+=16,i(d)},o)}function _(){return v=v||{},h=h.trim(),v.directory&&"/"!=h.charAt(h.length-1)&&(h+="/"),u.hasOwnProperty(h)?(t(I),void 0):(w=A(T(h)),l.push(h),y(function(){f?n||0===v.level?m(f,e,0,f.size,!0,b,p,a,o):s=g(f,e,v.level,b,p,a,o):b()},o),void 0)}var x,w,E;f?f.init(_,a):_()},close:function(t){var n,a,s,h=0,f=0;for(a=0;a<l.length;a++)s=u[l[a]],h+=46+s.filename.length+s.comment.length;for(n=r(h+22),a=0;a<l.length;a++)s=u[l[a]],n.view.setUint32(f,1347092738),n.view.setUint16(f+4,5120),n.array.set(s.headerArray,f+6),n.view.setUint16(f+32,s.comment.length,!0),s.directory&&n.view.setUint8(f+38,16),n.view.setUint32(f+42,s.offset,!0),n.array.set(s.filename,f+46),n.array.set(s.comment,f+46+s.filename.length),f+=46+s.filename.length+s.comment.length;n.view.setUint32(f,1347093766),n.view.setUint16(f+8,l.length,!0),n.view.setUint16(f+10,l.length,!0),n.view.setUint32(f+12,h,!0),n.view.setUint32(f+16,c,!0),e.writeUint8Array(n.array,function(){i(function(){e.getData(t)})},o)}}}var S,j="File format is not recognized.",C="File contains encrypted entry.",L="File is using Zip64 (4gb+ file size).",P="Error while reading zip file.",R="Error while writing zip file.",k="Error while writing file data.",O="Error while reading file data.",I="File already exists.",M=524288,q="inflate.js",N="deflate.js",D="text/plain",F="message";try{S=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(B){}t.prototype.table=function(){var e,t,n,r=[];for(e=0;256>e;e++){for(n=e,t=0;8>t;t++)1&n?n=n>>>1^3988292384:n>>>=1;r[e]=n}return r}(),o.prototype=new i,o.prototype.constructor=o,a.prototype=new i,a.prototype.constructor=a,s.prototype=new i,s.prototype.constructor=s,u.prototype.getData=function(e){e(this.data)},l.prototype=new u,l.prototype.constructor=l,c.prototype=new u,c.prototype.constructor=c,h.prototype=new u,h.prototype.constructor=h,e.zip={Reader:i,Writer:u,BlobReader:s,Data64URIReader:a,TextReader:o,BlobWriter:h,Data64URIWriter:c,TextWriter:l,createReader:function(e,t,n){e.init(function(){t(w(e,n))},n)},createWriter:function(e,t,n,r){e.init(function(){t(E(e,n,r))},n)},workerScriptsPath:"",useWebWorkers:!0}}(this),zip.workerScriptsPath="vendor/zip.js/";var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,r,i,o,a,s,u,l,c,h,f=t&&t.split("/"),d=g.map,p=d&&d["*"]||{};if(e&&"."===e.charAt(0))if(t){for(f=f.slice(0,f.length-1),e=f.concat(e.split("/")),l=0;l<e.length;l+=1)if(h=e[l],"."===h)e.splice(l,1),l-=1;else if(".."===h){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||p)&&d){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),f)for(c=f.length;c>0;c-=1)if(i=d[f.slice(0,c).join("/")],i&&(i=i[r])){o=i,a=l;break}if(o)break;!s&&p&&p[r]&&(s=p[r],u=l)}!o&&s&&(o=s,a=u),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function r(t,n){return function(){return c.apply(e,y.call(arguments,0).concat([t,n]))}}function i(e){return function(t){return n(t,e)}}function o(e){return function(t){d[e]=t}}function a(n){if(t(p,n)){var r=p[n];delete p[n],m[n]=!0,l.apply(e,r)}if(!t(d,n)&&!t(m,n))throw new Error("No "+n);return d[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return g&&g.config&&g.config[e]||{}}}var l,c,h,f,d={},p={},g={},m={},v=Object.prototype.hasOwnProperty,y=[].slice;h=function(e,t){var r,o=s(e),u=o[0];return e=o[1],u&&(u=n(u,t),r=a(u)),u?e=r&&r.normalize?r.normalize(e,i(t)):n(e,t):(e=n(e,t),o=s(e),u=o[0],e=o[1],u&&(r=a(u))),{f:u?u+"!"+e:e,n:e,pr:u,p:r}},f={require:function(e){return r(e)},exports:function(e){var t=d[e];return"undefined"!=typeof t?t:d[e]={}},module:function(e){return{id:e,uri:"",exports:d[e],config:u(e)}}},l=function(n,i,s,u){var l,c,g,v,y,b,_=[];if(u=u||n,"function"==typeof s){for(i=!i.length&&s.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if(v=h(i[y],u),c=v.f,"require"===c)_[y]=f.require(n);else if("exports"===c)_[y]=f.exports(n),b=!0;else if("module"===c)l=_[y]=f.module(n);else if(t(d,c)||t(p,c)||t(m,c))_[y]=a(c);else{if(!v.p)throw new Error(n+" missing "+c);v.p.load(v.n,r(u,!0),o(c),{}),_[y]=d[c]}g=s.apply(d[n],_),n&&(l&&l.exports!==e&&l.exports!==d[n]?d[n]=l.exports:g===e&&b||(d[n]=g))}else n&&(d[n]=s)},requirejs=require=c=function(t,n,r,i,o){return"string"==typeof t?f[t]?f[t](n):a(h(t,n).f):(t.splice||(g=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},"function"==typeof r&&(r=i,i=o),i?l(e,t,n,r):setTimeout(function(){l(e,t,n,r)},4),c)},c.config=function(e){return g=e,g.deps&&c(g.deps,g.callback),c},requirejs._defined=d,define=function(e,n,r){n.splice||(r=n,n=[]),t(d,e)||t(p,e)||(p[e]=[e,n,r])},define.amd={jQuery:!0}}();var Desire=function(){function e(r,i){function o(e){if(!a[e]){if(!s[e])return r(e);a[e]={},a[e].value=s[e](o)}return a[e].value}"function"==typeof r||i||(i=r,r=n);var a={},s={};return o.register=function(e){return t(s,e),this},o.clone=function(){return new e(r,s)},o.registry=s,"object"==typeof i&&i&&o.register(i),i=null,o}function t(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e}function n(e){throw new Error("Component not registered: "+e)}var r=Object.prototype.hasOwnProperty;return e.value=function(e){return function(){return e}},e}();if("function"==typeof define&&define.amd&&define("desire",[],function(){return Desire}),"undefined"!=typeof module&&module&&module.exports&&(module.exports=Desire),function(){function e(e,t,n){for(var r=(n||0)-1,i=e?e.length:0;++r<i;)if(e[r]===t)return r;return-1}function t(t,n){var r=typeof n;if(t=t.cache,"boolean"==r||null==n)return t[n]?0:-1;"number"!=r&&"string"!=r&&(r="object");var i="number"==r?n:b+n;return t=(t=t[r])&&t[i],"object"==r?t&&e(t,n)>-1?0:-1:t?0:-1}function n(e){var t=this.cache,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?e:b+e,i=t[n]||(t[n]={});"object"==n?(i[r]||(i[r]=[])).push(e):i[r]=!0}}function r(e){return e.charCodeAt(0)}function i(e,t){for(var n=e.criteria,r=t.criteria,i=-1,o=n.length;++i<o;){var a=n[i],s=r[i];if(a!==s){if(a>s||"undefined"==typeof a)return 1;if(s>a||"undefined"==typeof s)return-1}}return e.index-t.index}function o(e){var t=-1,r=e.length,i=e[0],o=e[r/2|0],a=e[r-1];if(i&&"object"==typeof i&&o&&"object"==typeof o&&a&&"object"==typeof a)return!1;var s=u();s["false"]=s["null"]=s["true"]=s.undefined=!1;var l=u();for(l.array=e,l.cache=s,l.push=n;++t<r;)l.push(e[t]);return l}function a(e){return"\\"+Z[e]}function s(){return g.pop()||[]}function u(){return m.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function l(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}function c(e){e.length=0,g.length<x&&g.push(e)}function h(e){var t=e.cache;t&&h(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,m.length<x&&m.push(e)}function f(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,i=n-t||0,o=Array(0>i?0:i);++r<i;)o[r]=e[t+r];return o}function d(n){function g(e){return e&&"object"==typeof e&&!hi(e)&&Hr.call(e,"__wrapped__")?e:new m(e)}function m(e,t){this.__chain__=!!t,this.__wrapped__=e}function x(e){function t(){if(r){var e=f(r);Xr.apply(e,arguments)}if(this instanceof t){var o=tt(n.prototype),a=n.apply(o,e||arguments);return Nt(a)?a:o}return n.apply(i,e||arguments)}var n=e[0],r=e[2],i=e[4];return ci(t,e),t}function Z(e,t,n,r,i){if(n){var o=n(e);if("undefined"!=typeof o)return o}var a=Nt(e);if(!a)return e;var u=Nr.call(e);if(!Y[u]||!ui.nodeClass&&l(e))return e;var h=ai[u];switch(u){case B:case U:return new h(+e);case H:case z:return new h(e);case V:return o=h(e.source,j.exec(e)),o.lastIndex=e.lastIndex,o}var d=hi(e);if(t){var p=!r;r||(r=s()),i||(i=s());for(var g=r.length;g--;)if(r[g]==e)return i[g];o=d?h(e.length):{}}else o=d?f(e):wi({},e);return d&&(Hr.call(e,"index")&&(o.index=e.index),Hr.call(e,"input")&&(o.input=e.input)),t?(r.push(e),i.push(o),(d?xi:Ei)(e,function(e,a){o[a]=Z(e,t,n,r,i)}),p&&(c(r),c(i)),o):o}function tt(e){return Nt(e)?$r(e):{}}function nt(e,t,n){if("function"!=typeof e)return or;if("undefined"==typeof t||!("prototype"in e))return e;var r=e.__bindData__;if("undefined"==typeof r&&(ui.funcNames&&(r=!e.name),r=r||!ui.funcDecomp,!r)){var i=Wr.call(e);ui.funcNames||(r=!C.test(i)),r||(r=O.test(i),ci(e,r))}if(r===!1||r!==!0&&1&r[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return Wn(e,t)}function rt(e){function t(){var e=u?a:this;if(i){var p=f(i);Xr.apply(p,arguments)}if((o||c)&&(p||(p=f(arguments)),o&&Xr.apply(p,o),c&&p.length<s))return r|=16,rt([n,h?r:-4&r,p,null,a,s]);if(p||(p=arguments),l&&(n=e[d]),this instanceof t){e=tt(n.prototype);var g=n.apply(e,p);return Nt(g)?g:e}return n.apply(e,p)}var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=1&r,l=2&r,c=4&r,h=8&r,d=n;return ci(t,e),t}function it(n,r){var i=-1,a=gt(),s=n?n.length:0,u=s>=_&&a===e,l=[];if(u){var c=o(r);c?(a=t,r=c):u=!1}for(;++i<s;){var f=n[i];a(r,f)<0&&l.push(f)}return u&&h(r),l}function at(e,t,n,r){for(var i=(r||0)-1,o=e?e.length:0,a=[];++i<o;){var s=e[i];if(s&&"object"==typeof s&&"number"==typeof s.length&&(hi(s)||bt(s))){t||(s=at(s,t,n));var u=-1,l=s.length,c=a.length;for(a.length+=l;++u<l;)a[c++]=s[u]}else n||a.push(s)}return a}function st(e,t,n,r,i,o){if(n){var a=n(e,t);if("undefined"!=typeof a)return!!a}if(e===t)return 0!==e||1/e==1/t;var u=typeof e,h=typeof t;if(!(e!==e||e&&K[u]||t&&K[h]))return!1;if(null==e||null==t)return e===t;var f=Nr.call(e),d=Nr.call(t);if(f==D&&(f=X),d==D&&(d=X),f!=d)return!1;switch(f){case B:case U:return+e==+t;case H:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case V:case z:return e==Pr(t)}var p=f==F;if(!p){var g=Hr.call(e,"__wrapped__"),m=Hr.call(t,"__wrapped__");if(g||m)return st(g?e.__wrapped__:e,m?t.__wrapped__:t,n,r,i,o);if(f!=X||!ui.nodeClass&&(l(e)||l(t)))return!1;var v=!ui.argsObject&&bt(e)?Cr:e.constructor,y=!ui.argsObject&&bt(t)?Cr:t.constructor;if(v!=y&&!(qt(v)&&v instanceof v&&qt(y)&&y instanceof y)&&"constructor"in e&&"constructor"in t)return!1}var b=!i;i||(i=s()),o||(o=s());for(var _=i.length;_--;)if(i[_]==e)return o[_]==t;var x=0;if(a=!0,i.push(e),o.push(t),p){if(_=e.length,x=t.length,a=x==_,a||r)for(;x--;){var w=_,T=t[x];if(r)for(;w--&&!(a=st(e[w],T,n,r,i,o)););else if(!(a=st(e[x],T,n,r,i,o)))break}}else Ai(t,function(t,s,u){return Hr.call(u,s)?(x++,a=Hr.call(e,s)&&st(e[s],t,n,r,i,o)):void 0}),a&&!r&&Ai(e,function(e,t,n){return Hr.call(n,t)?a=--x>-1:void 0});return i.pop(),o.pop(),b&&(c(i),c(o)),a}function ut(e,t,n,r,i){(hi(t)?rn:Ei)(t,function(t,o){var a,s,u=t,l=e[o];if(t&&((s=hi(t))||Si(t))){for(var c=r.length;c--;)if(a=r[c]==t){l=i[c];break}if(!a){var h;n&&(u=n(l,t),(h="undefined"!=typeof u)&&(l=u)),h||(l=s?hi(l)?l:[]:Si(l)?l:{}),r.push(t),i.push(l),h||ut(l,t,n,r,i)}}else n&&(u=n(l,t),"undefined"==typeof u&&(u=t)),"undefined"!=typeof u&&(l=u);e[o]=l})}function lt(e,t){return e+Ur(oi()*(t-e+1))}function ct(n,r,i){var a=-1,u=gt(),l=n?n.length:0,f=[],d=!r&&l>=_&&u===e,p=i||d?s():f;if(d){var g=o(p);u=t,p=g}for(;++a<l;){var m=n[a],v=i?i(m,a,n):m;(r?!a||p[p.length-1]!==v:u(p,v)<0)&&((i||d)&&p.push(v),f.push(m))}return d?(c(p.array),h(p)):i&&c(p),f}function ht(e){return function(t,n,r){var i={};if(n=g.createCallback(n,r,3),hi(t))for(var o=-1,a=t.length;++o<a;){var s=t[o];e(i,s,n(s,o,t),t)}else xi(t,function(t,r,o){e(i,t,n(t,r,o),o)});return i}}function ft(e,t,n,r,i,o){var a=1&t,s=2&t,u=4&t,l=16&t,c=32&t;if(!s&&!qt(e))throw new Rr;l&&!n.length&&(t&=-17,l=n=!1),c&&!r.length&&(t&=-33,c=r=!1);var h=e&&e.__bindData__;if(h&&h!==!0)return h=f(h),h[2]&&(h[2]=f(h[2])),h[3]&&(h[3]=f(h[3])),!a||1&h[1]||(h[4]=i),!a&&1&h[1]&&(t|=8),!u||4&h[1]||(h[5]=o),l&&Xr.apply(h[2]||(h[2]=[]),n),c&&Jr.apply(h[3]||(h[3]=[]),r),h[1]|=t,ft.apply(null,h);var d=1==t||17===t?x:rt;return d([e,t,n,r,i,o])}function dt(){$.shadowedProps=q,$.array=$.bottom=$.loop=$.top="",$.init="iterable",$.useHas=!0;for(var e,t=0;e=arguments[t];t++)for(var n in e)$[n]=e[n];var r=$.args;$.firstArg=/^[^,]+/.exec(r)[0];var i=Er("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+r+") {\n"+li($)+"\n}");return i(nt,W,Or,Hr,y,bt,hi,Wt,$.keys,Ir,K,si,z,Mr,Nr)}function pt(e){return vi[e]}function gt(){var t=(t=g.indexOf)===En?e:t;return t}function mt(e){return"function"==typeof e&&Dr.test(e)}function vt(e){var t,n;return!e||Nr.call(e)!=X||(t=e.constructor,qt(t)&&!(t instanceof t))||!ui.argsClass&&bt(e)||!ui.nodeClass&&l(e)?!1:ui.ownLast?(Ai(e,function(e,t,r){return n=Hr.call(r,t),!1}),n!==!1):(Ai(e,function(e,t){n=t}),"undefined"==typeof n||Hr.call(e,n))}function yt(e){return yi[e]}function bt(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Nr.call(e)==D||!1}function _t(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n=t,t=!1),Z(e,t,"function"==typeof n&&nt(n,r,1))}function xt(e,t,n){return Z(e,!0,"function"==typeof t&&nt(t,n,1))}function wt(e,t){var n=tt(e);return t?wi(n,t):n}function Tt(e,t,n){var r;return t=g.createCallback(t,n,3),Ei(e,function(e,n,i){return t(e,n,i)?(r=n,!1):void 0}),r}function At(e,t,n){var r;return t=g.createCallback(t,n,3),St(e,function(e,n,i){return t(e,n,i)?(r=n,!1):void 0}),r}function Et(e,t,n){var r=[];Ai(e,function(e,t){r.push(t,e)});var i=r.length;for(t=nt(t,n,3);i--&&t(r[i--],r[i],e)!==!1;);return e}function St(e,t,n){var r=di(e),i=r.length;for(t=nt(t,n,3);i--;){var o=r[i];if(t(e[o],o,e)===!1)break}return e}function jt(e){var t=[];return Ai(e,function(e,n){qt(e)&&t.push(n)}),t.sort()}function Ct(e,t){return e?Hr.call(e,t):!1}function Lt(e){for(var t=-1,n=di(e),r=n.length,i={};++t<r;){var o=n[t];i[e[o]]=o}return i}function Pt(e){return e===!0||e===!1||e&&"object"==typeof e&&Nr.call(e)==B||!1}function Rt(e){return e&&"object"==typeof e&&Nr.call(e)==U||!1}function kt(e){return e&&1===e.nodeType||!1}function Ot(e){var t=!0;if(!e)return t;var n=Nr.call(e),r=e.length;return n==F||n==z||(ui.argsClass?n==D:bt(e))||n==X&&"number"==typeof r&&qt(e.splice)?!r:(Ei(e,function(){return t=!1}),t)}function It(e,t,n,r){return st(e,t,"function"==typeof n&&nt(n,r,2))}function Mt(e){return Zr(e)&&!ei(parseFloat(e))}function qt(e){return"function"==typeof e}function Nt(e){return!(!e||!K[typeof e])}function Dt(e){return Bt(e)&&e!=+e}function Ft(e){return null===e}function Bt(e){return"number"==typeof e||e&&"object"==typeof e&&Nr.call(e)==H||!1}function Ut(e){return e&&K[typeof e]&&Nr.call(e)==V||!1}function Wt(e){return"string"==typeof e||e&&"object"==typeof e&&Nr.call(e)==z||!1}function Gt(e){return"undefined"==typeof e}function Ht(e,t,n){var r={};return t=g.createCallback(t,n,3),Ei(e,function(e,n,i){r[n]=t(e,n,i)}),r}function Xt(e){var t=arguments,n=2;if(!Nt(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var r=nt(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(r=t[--n]);for(var i=f(arguments,1,n),o=-1,a=s(),u=s();++o<n;)ut(e,i[o],r,a,u);return c(a),c(u),e}function Vt(e,t,n){var r={};if("function"!=typeof t){var i=[];Ai(e,function(e,t){i.push(t)}),i=it(i,at(arguments,!0,!1,1));for(var o=-1,a=i.length;++o<a;){var s=i[o];r[s]=e[s]}}else t=g.createCallback(t,n,3),Ai(e,function(e,n,i){t(e,n,i)||(r[n]=e)});return r}function zt(e){for(var t=-1,n=di(e),r=n.length,i=xr(r);++t<r;){var o=n[t];i[t]=[o,e[o]]}return i}function Yt(e,t,n){var r={};if("function"!=typeof t)for(var i=-1,o=at(arguments,!0,!1,1),a=Nt(e)?o.length:0;++i<a;){var s=o[i];s in e&&(r[s]=e[s])}else t=g.createCallback(t,n,3),Ai(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r}function Jt(e,t,n,r){var i=hi(e);if(null==n)if(i)n=[];else{var o=e&&e.constructor,a=o&&o.prototype;n=tt(a)}return t&&(t=g.createCallback(t,r,4),(i?xi:Ei)(e,function(e,r,i){return t(n,e,r,i)})),n}function Qt(e){for(var t=-1,n=di(e),r=n.length,i=xr(r);++t<r;)i[t]=e[n[t]];return i}function $t(e){var t=arguments,n=-1,r=at(t,!0,!1,1),i=t[2]&&t[2][t[1]]===e?1:r.length,o=xr(i);for(ui.unindexedChars&&Wt(e)&&(e=e.split(""));++n<i;)o[n]=e[r[n]];return o}function Kt(e,t,n){var r=-1,i=gt(),o=e?e.length:0,a=!1;return n=(0>n?ni(0,o+n):n)||0,hi(e)?a=i(e,t,n)>-1:"number"==typeof o?a=(Wt(e)?e.indexOf(t,n):i(e,t,n))>-1:xi(e,function(e){return++r>=n?!(a=e===t):void 0}),a}function Zt(e,t,n){var r=!0;if(t=g.createCallback(t,n,3),hi(e))for(var i=-1,o=e.length;++i<o&&(r=!!t(e[i],i,e)););else xi(e,function(e,n,i){return r=!!t(e,n,i)});return r}function en(e,t,n){var r=[];if(t=g.createCallback(t,n,3),hi(e))for(var i=-1,o=e.length;++i<o;){var a=e[i];t(a,i,e)&&r.push(a)}else xi(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function tn(e,t,n){if(t=g.createCallback(t,n,3),!hi(e)){var r;return xi(e,function(e,n,i){return t(e,n,i)?(r=e,!1):void 0}),r}for(var i=-1,o=e.length;++i<o;){var a=e[i];if(t(a,i,e))return a}}function nn(e,t,n){var r;return t=g.createCallback(t,n,3),on(e,function(e,n,i){return t(e,n,i)?(r=e,!1):void 0}),r}function rn(e,t,n){if(t&&"undefined"==typeof n&&hi(e))for(var r=-1,i=e.length;++r<i&&t(e[r],r,e)!==!1;);else xi(e,t,n);return e}function on(e,t,n){var r=e,i=e?e.length:0;if(t=t&&"undefined"==typeof n?t:nt(t,n,3),hi(e))for(;i--&&t(e[i],i,e)!==!1;);else{if("number"!=typeof i){var o=di(e);i=o.length}else ui.unindexedChars&&Wt(e)&&(r=e.split(""));xi(e,function(e,n,a){return n=o?o[--i]:--i,t(r[n],n,a)})}return e}function an(e,t){var n=f(arguments,2),r=-1,i="function"==typeof t,o=e?e.length:0,a=xr("number"==typeof o?o:0);return rn(e,function(e){a[++r]=(i?t:e[t]).apply(e,n)}),a}function sn(e,t,n){var r=-1,i=e?e.length:0,o=xr("number"==typeof i?i:0);if(t=g.createCallback(t,n,3),hi(e))for(;++r<i;)o[r]=t(e[r],r,e);else xi(e,function(e,n,i){o[++r]=t(e,n,i)});return o}function un(e,t,n){var i=-1/0,o=i;if("function"!=typeof t&&n&&n[t]===e&&(t=null),null==t&&hi(e))for(var a=-1,s=e.length;++a<s;){var u=e[a];u>o&&(o=u)}else t=null==t&&Wt(e)?r:g.createCallback(t,n,3),xi(e,function(e,n,r){var a=t(e,n,r);a>i&&(i=a,o=e)});return o}function ln(e,t,n){var i=1/0,o=i;if("function"!=typeof t&&n&&n[t]===e&&(t=null),null==t&&hi(e))for(var a=-1,s=e.length;++a<s;){var u=e[a];o>u&&(o=u)}else t=null==t&&Wt(e)?r:g.createCallback(t,n,3),xi(e,function(e,n,r){var a=t(e,n,r);i>a&&(i=a,o=e)});return o}function cn(e,t,n,r){var i=arguments.length<3;if(t=g.createCallback(t,r,4),hi(e)){var o=-1,a=e.length;for(i&&(n=e[++o]);++o<a;)n=t(n,e[o],o,e)}else xi(e,function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)});return n}function hn(e,t,n,r){var i=arguments.length<3;return t=g.createCallback(t,r,4),on(e,function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)}),n}function fn(e,t,n){return t=g.createCallback(t,n,3),en(e,function(e,n,r){return!t(e,n,r)})}function dn(e,t,n){if(e&&"number"!=typeof e.length?e=Qt(e):ui.unindexedChars&&Wt(e)&&(e=e.split("")),null==t||n)return e?e[lt(0,e.length-1)]:p;var r=pn(e);return r.length=ri(ni(0,t),r.length),r}function pn(e){var t=-1,n=e?e.length:0,r=xr("number"==typeof n?n:0);return rn(e,function(e){var n=lt(0,++t);r[t]=r[n],r[n]=e}),r}function gn(e){var t=e?e.length:0;return"number"==typeof t?t:di(e).length}function mn(e,t,n){var r;if(t=g.createCallback(t,n,3),hi(e))for(var i=-1,o=e.length;++i<o&&!(r=t(e[i],i,e)););else xi(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function vn(e,t,n){var r=-1,o=hi(t),a=e?e.length:0,l=xr("number"==typeof a?a:0);for(o||(t=g.createCallback(t,n,3)),rn(e,function(e,n,i){var a=l[++r]=u();o?a.criteria=sn(t,function(t){return e[t]}):(a.criteria=s())[0]=t(e,n,i),a.index=r,a.value=e}),a=l.length,l.sort(i);a--;){var f=l[a];l[a]=f.value,o||c(f.criteria),h(f)}return l}function yn(e){return e&&"number"==typeof e.length?ui.unindexedChars&&Wt(e)?e.split(""):f(e):Qt(e)}function bn(e){for(var t=-1,n=e?e.length:0,r=[];++t<n;){var i=e[t];i&&r.push(i)}return r}function _n(e){return it(e,at(arguments,!0,!0,1))}function xn(e,t,n){var r=-1,i=e?e.length:0;for(t=g.createCallback(t,n,3);++r<i;)if(t(e[r],r,e))return r;return-1}function wn(e,t,n){var r=e?e.length:0;for(t=g.createCallback(t,n,3);r--;)if(t(e[r],r,e))return r;return-1}function Tn(e,t,n){var r=0,i=e?e.length:0;if("number"!=typeof t&&null!=t){var o=-1;for(t=g.createCallback(t,n,3);++o<i&&t(e[o],o,e);)r++}else if(r=t,null==r||n)return e?e[0]:p;return f(e,0,ri(ni(0,r),i))}function An(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n="function"!=typeof t&&r&&r[t]===e?null:t,t=!1),null!=n&&(e=sn(e,n,r)),at(e,t)}function En(t,n,r){if("number"==typeof r){var i=t?t.length:0;r=0>r?ni(0,i+r):r||0}else if(r){var o=In(t,n);return t[o]===n?o:-1}return e(t,n,r)}function Sn(e,t,n){var r=0,i=e?e.length:0;if("number"!=typeof t&&null!=t){var o=i;for(t=g.createCallback(t,n,3);o--&&t(e[o],o,e);)r++}else r=null==t||n?1:t||r;return f(e,0,ri(ni(0,i-r),i))}function jn(){for(var n=[],r=-1,i=arguments.length,a=s(),u=gt(),l=u===e,f=s();++r<i;){var d=arguments[r];(hi(d)||bt(d))&&(n.push(d),a.push(l&&d.length>=_&&o(r?n[r]:f)))}var p=n[0],g=-1,m=p?p.length:0,v=[];e:for(;++g<m;){var y=a[0];if(d=p[g],(y?t(y,d):u(f,d))<0){for(r=i,(y||f).push(d);--r;)if(y=a[r],(y?t(y,d):u(n[r],d))<0)continue e;v.push(d)}}for(;i--;)y=a[i],y&&h(y);return c(a),c(f),v}function Cn(e,t,n){var r=0,i=e?e.length:0;if("number"!=typeof t&&null!=t){var o=i;for(t=g.createCallback(t,n,3);o--&&t(e[o],o,e);)r++}else if(r=t,null==r||n)return e?e[i-1]:p;return f(e,ni(0,i-r))}function Ln(e,t,n){var r=e?e.length:0;for("number"==typeof n&&(r=(0>n?ni(0,r+n):ri(n,r-1))+1);r--;)if(e[r]===t)return r;return-1}function Pn(e){for(var t=arguments,n=0,r=t.length,i=e?e.length:0;++n<r;)for(var o=-1,a=t[n];++o<i;)e[o]===a&&(Yr.call(e,o--,1),i--);return e}function Rn(e,t,n){e=+e||0,n="number"==typeof n?n:+n||1,null==t&&(t=e,e=0);for(var r=-1,i=ni(0,Fr((t-e)/(n||1))),o=xr(i);++r<i;)o[r]=e,e+=n;return o}function kn(e,t,n){var r=-1,i=e?e.length:0,o=[];for(t=g.createCallback(t,n,3);++r<i;){var a=e[r];t(a,r,e)&&(o.push(a),Yr.call(e,r--,1),i--)}return o}function On(e,t,n){if("number"!=typeof t&&null!=t){var r=0,i=-1,o=e?e.length:0;for(t=g.createCallback(t,n,3);++i<o&&t(e[i],i,e);)r++}else r=null==t||n?1:ni(0,t);return f(e,r)}function In(e,t,n,r){var i=0,o=e?e.length:i;for(n=n?g.createCallback(n,r,1):or,t=n(t);o>i;){var a=i+o>>>1;n(e[a])<t?i=a+1:o=a}return i}function Mn(){return ct(at(arguments,!0,!0))}function qn(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n="function"!=typeof t&&r&&r[t]===e?null:t,t=!1),null!=n&&(n=g.createCallback(n,r,3)),ct(e,t,n)}function Nn(e){return it(e,f(arguments,1))}function Dn(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(hi(n)||bt(n))var r=r?ct(it(r,n).concat(it(n,r))):n}return r||[]}function Fn(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,n=e?un(Pi(e,"length")):0,r=xr(0>n?0:n);++t<n;)r[t]=Pi(e,t);return r}function Bn(e,t){var n=-1,r=e?e.length:0,i={};for(t||!r||hi(e[0])||(t=[]);++n<r;){var o=e[n];t?i[o]=t[n]:o&&(i[o[0]]=o[1])}return i}function Un(e,t){if(!qt(t))throw new Rr;return function(){return--e<1?t.apply(this,arguments):void 0}}function Wn(e,t){return arguments.length>2?ft(e,17,f(arguments,2),null,t):ft(e,1,null,null,t)}function Gn(e){for(var t=arguments.length>1?at(arguments,!0,!1,1):jt(e),n=-1,r=t.length;++n<r;){var i=t[n];e[i]=ft(e[i],1,null,null,e)}return e}function Hn(e,t){return arguments.length>2?ft(t,19,f(arguments,2),null,e):ft(t,3,null,null,e)}function Xn(){for(var e=arguments,t=e.length;t--;)if(!qt(e[t]))throw new Rr;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]
}}function Vn(e,t){return t="number"==typeof t?t:+t||e.length,ft(e,4,null,null,null,t)}function zn(e,t,n){var r,i,o,a,s,u,l,c=0,h=!1,f=!0;if(!qt(e))throw new Rr;if(t=ni(0,t)||0,n===!0){var d=!0;f=!1}else Nt(n)&&(d=n.leading,h="maxWait"in n&&(ni(t,n.maxWait)||0),f="trailing"in n?n.trailing:f);var g=function(){var n=t-(ki()-a);if(0>=n){i&&Br(i);var h=l;i=u=l=p,h&&(c=ki(),o=e.apply(s,r),u||i||(r=s=null))}else u=zr(g,n)},m=function(){u&&Br(u),i=u=l=p,(f||h!==t)&&(c=ki(),o=e.apply(s,r),u||i||(r=s=null))};return function(){if(r=arguments,a=ki(),s=this,l=f&&(u||!d),h===!1)var n=d&&!u;else{i||d||(c=a);var p=h-(a-c),v=0>=p;v?(i&&(i=Br(i)),c=a,o=e.apply(s,r)):i||(i=zr(m,p))}return v&&u?u=Br(u):u||t===h||(u=zr(g,t)),n&&(v=!0,o=e.apply(s,r)),!v||u||i||(r=s=null),o}}function Yn(e){if(!qt(e))throw new Rr;var t=f(arguments,1);return zr(function(){e.apply(p,t)},1)}function Jn(e,t){if(!qt(e))throw new Rr;var n=f(arguments,2);return zr(function(){e.apply(p,n)},t)}function Qn(e,t){if(!qt(e))throw new Rr;var n=function(){var r=n.cache,i=t?t.apply(this,arguments):b+arguments[0];return Hr.call(r,i)?r[i]:r[i]=e.apply(this,arguments)};return n.cache={},n}function $n(e){var t,n;if(!qt(e))throw new Rr;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function Kn(e){return ft(e,16,f(arguments,1))}function Zn(e){return ft(e,32,null,f(arguments,1))}function er(e,t,n){var r=!0,i=!0;if(!qt(e))throw new Rr;return n===!1?r=!1:Nt(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),J.leading=r,J.maxWait=t,J.trailing=i,zn(e,t,J)}function tr(e,t){return ft(t,16,[e])}function nr(e){return function(){return e}}function rr(e,t,n){var r=typeof e;if(null==e||"function"==r)return nt(e,t,n);if("object"!=r)return lr(e);var i=di(e),o=i[0],a=e[o];return 1!=i.length||a!==a||Nt(a)?function(t){for(var n=i.length,r=!1;n--&&(r=st(t[i[n]],e[i[n]],null,!0)););return r}:function(e){var t=e[o];return a===t&&(0!==a||1/a==1/t)}}function ir(e){return null==e?"":Pr(e).replace(_i,pt)}function or(e){return e}function ar(e,t,n){var r=!0,i=t&&jt(t);t&&(n||i.length)||(null==n&&(n=t),o=m,t=e,e=g,i=jt(t)),n===!1?r=!1:Nt(n)&&"chain"in n&&(r=n.chain);var o=e,a=qt(o);rn(i,function(n){var i=e[n]=t[n];a&&(o.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,a=[n];Xr.apply(a,arguments);var s=i.apply(e,a);if(r||t){if(n===s&&Nt(s))return this;s=new o(s),s.__chain__=t}return s})})}function sr(){return n._=qr,this}function ur(){}function lr(e){return function(t){return t[e]}}function cr(e,t,n){var r=null==e,i=null==t;if(null==n&&("boolean"==typeof e&&i?(n=e,e=1):i||"boolean"!=typeof t||(n=t,i=!0)),r&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0,n||e%1||t%1){var o=oi();return ri(e+o*(t-e+parseFloat("1e-"+((o+"").length-1))),t)}return lt(e,t)}function hr(e,t){if(e){var n=e[t];return qt(n)?e[t]():n}}function fr(e,t,n){var r=g.templateSettings;e=Pr(e||""),n=Ti({},n,r);var i,o=Ti({},n.imports,r.imports),s=di(o),u=Qt(o),l=0,c=n.interpolate||R,h="__p += '",f=Lr((n.escape||R).source+"|"+c.source+"|"+(c===L?S:R).source+"|"+(n.evaluate||R).source+"|$","g");e.replace(f,function(t,n,r,o,s,u){return r||(r=o),h+=e.slice(l,u).replace(I,a),n&&(h+="' +\n__e("+n+") +\n'"),s&&(i=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=u+t.length,t}),h+="';\n";var d=n.variable,m=d;m||(d="obj",h="with ("+d+") {\n"+h+"\n}\n"),h=(i?h.replace(T,""):h).replace(A,"$1").replace(E,"$1;"),h="function("+d+") {\n"+(m?"":d+" || ("+d+" = {});\n")+"var __t, __p = '', __e = _.escape"+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var v="\n/*\n//# sourceURL="+(n.sourceURL||"/lodash/template/source["+N++ +"]")+"\n*/";try{var y=Er(s,"return "+h+v).apply(p,u)}catch(b){throw b.source=h,b}return t?y(t):(y.source=h,y)}function dr(e,t,n){e=(e=+e)>-1?e:0;var r=-1,i=xr(e);for(t=nt(t,n,1);++r<e;)i[r]=t(r);return i}function pr(e){return null==e?"":Pr(e).replace(bi,yt)}function gr(e){var t=++v;return Pr(null==e?"":e)+t}function mr(e){return e=new m(e),e.__chain__=!0,e}function vr(e,t){return t(e),e}function yr(){return this.__chain__=!0,this}function br(){return Pr(this.__wrapped__)}function _r(){return this.__wrapped__}n=n?ot.defaults(et.Object(),n,ot.pick(et,M)):et;var xr=n.Array,wr=n.Boolean,Tr=n.Date,Ar=n.Error,Er=n.Function,Sr=n.Math,jr=n.Number,Cr=n.Object,Lr=n.RegExp,Pr=n.String,Rr=n.TypeError,kr=[],Or=Ar.prototype,Ir=Cr.prototype,Mr=Pr.prototype,qr=n._,Nr=Ir.toString,Dr=Lr("^"+Pr(Nr).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Fr=Sr.ceil,Br=n.clearTimeout,Ur=Sr.floor,Wr=Er.prototype.toString,Gr=mt(Gr=Cr.getPrototypeOf)&&Gr,Hr=Ir.hasOwnProperty,Xr=kr.push,Vr=Ir.propertyIsEnumerable,zr=n.setTimeout,Yr=kr.splice,Jr=kr.unshift,Qr=function(){try{var e={},t=mt(t=Cr.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}(),$r=mt($r=Cr.create)&&$r,Kr=mt(Kr=xr.isArray)&&Kr,Zr=n.isFinite,ei=n.isNaN,ti=mt(ti=Cr.keys)&&ti,ni=Sr.max,ri=Sr.min,ii=n.parseInt,oi=Sr.random,ai={};ai[F]=xr,ai[B]=wr,ai[U]=Tr,ai[G]=Er,ai[X]=Cr,ai[H]=jr,ai[V]=Lr,ai[z]=Pr;var si={};si[F]=si[U]=si[H]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},si[B]=si[z]={constructor:!0,toString:!0,valueOf:!0},si[W]=si[G]=si[V]={constructor:!0,toString:!0},si[X]={constructor:!0},function(){for(var e=q.length;e--;){var t=q[e];for(var n in si)Hr.call(si,n)&&!Hr.call(si[n],t)&&(si[n][t]=!1)}}(),m.prototype=g.prototype;var ui=g.support={};!function(){var e=function(){this.x=1},t={0:1,length:1},r=[];e.prototype={valueOf:1,y:1};for(var i in new e)r.push(i);for(i in arguments);ui.argsClass=Nr.call(arguments)==D,ui.argsObject=arguments.constructor==Cr&&!(arguments instanceof xr),ui.enumErrorProps=Vr.call(Or,"message")||Vr.call(Or,"name"),ui.enumPrototypes=Vr.call(e,"prototype"),ui.funcDecomp=!mt(n.WinRTError)&&O.test(d),ui.funcNames="string"==typeof Er.name,ui.nonEnumArgs=0!=i,ui.nonEnumShadows=!/valueOf/.test(r),ui.ownLast="x"!=r[0],ui.spliceObjects=(kr.splice.call(t,0,1),!t[0]),ui.unindexedChars="x"[0]+Cr("x")[0]!="xx";try{ui.nodeClass=!(Nr.call(document)==X&&!({toString:0}+""))}catch(o){ui.nodeClass=!0}}(1),g.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:L,variable:"",imports:{_:g}};var li=function(e){var t="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";";e.array?(t+="\nvar length = iterable.length; index = -1;\nif ("+e.array+") {  ",ui.unindexedChars&&(t+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),t+="\n  while (++index < length) {\n    "+e.loop+";\n  }\n}\nelse {  "):ui.nonEnumArgs&&(t+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+";\n    }\n  } else {  "),ui.enumPrototypes&&(t+="\n  var skipProto = typeof iterable == 'function';\n  "),ui.enumErrorProps&&(t+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(ui.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),ui.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),e.useHas&&e.keys)t+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }  ";else if(t+="\n  for (index in iterable) {\n",e.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }    ",ui.nonEnumShadows){for(t+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)t+="\n    index = '"+e.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",e.useHas||(t+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),t+=") {\n      "+e.loop+";\n    }      ";t+="\n  }    "}return(e.array||ui.nonEnumArgs)&&(t+="\n}"),t+=e.bottom+";\nreturn result"};$r||(tt=function(){function e(){}return function(t){if(Nt(t)){e.prototype=t;var r=new e;e.prototype=null}return r||n.Object()}}());var ci=Qr?function(e,t){Q.value=t,Qr(e,"__bindData__",Q)}:ur;ui.argsClass||(bt=function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Hr.call(e,"callee")&&!Vr.call(e,"callee")||!1});var hi=Kr||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Nr.call(e)==F||!1},fi=dt({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),di=ti?function(e){return Nt(e)?ui.enumPrototypes&&"function"==typeof e||ui.nonEnumArgs&&e.length&&bt(e)?fi(e):ti(e):[]}:fi,pi={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:di,loop:"if (callback(iterable[index], index, collection) === false) return result"},gi={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:di,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},mi={top:"if (!objectTypes[typeof iterable]) return result;\n"+pi.top,array:!1},vi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},yi=Lt(vi),bi=Lr("("+di(yi).join("|")+")","g"),_i=Lr("["+di(vi).join("")+"]","g"),xi=dt(pi),wi=dt(gi,{top:gi.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Ti=dt(gi),Ai=dt(pi,mi,{useHas:!1}),Ei=dt(pi,mi);qt(/x/)&&(qt=function(e){return"function"==typeof e&&Nr.call(e)==G});var Si=Gr?function(e){if(!e||Nr.call(e)!=X||!ui.argsClass&&bt(e))return!1;var t=e.valueOf,n=mt(t)&&(n=Gr(t))&&Gr(n);return n?e==n||Gr(e)==n:vt(e)}:vt,ji=ht(function(e,t,n){Hr.call(e,n)?e[n]++:e[n]=1}),Ci=ht(function(e,t,n){(Hr.call(e,n)?e[n]:e[n]=[]).push(t)}),Li=ht(function(e,t,n){e[n]=t}),Pi=sn,Ri=en,ki=mt(ki=Tr.now)&&ki||function(){return(new Tr).getTime()},Oi=8==ii(w+"08")?ii:function(e,t){return ii(Wt(e)?e.replace(P,""):e,t||0)};return g.after=Un,g.assign=wi,g.at=$t,g.bind=Wn,g.bindAll=Gn,g.bindKey=Hn,g.chain=mr,g.compact=bn,g.compose=Xn,g.constant=nr,g.countBy=ji,g.create=wt,g.createCallback=rr,g.curry=Vn,g.debounce=zn,g.defaults=Ti,g.defer=Yn,g.delay=Jn,g.difference=_n,g.filter=en,g.flatten=An,g.forEach=rn,g.forEachRight=on,g.forIn=Ai,g.forInRight=Et,g.forOwn=Ei,g.forOwnRight=St,g.functions=jt,g.groupBy=Ci,g.indexBy=Li,g.initial=Sn,g.intersection=jn,g.invert=Lt,g.invoke=an,g.keys=di,g.map=sn,g.mapValues=Ht,g.max=un,g.memoize=Qn,g.merge=Xt,g.min=ln,g.omit=Vt,g.once=$n,g.pairs=zt,g.partial=Kn,g.partialRight=Zn,g.pick=Yt,g.pluck=Pi,g.property=lr,g.pull=Pn,g.range=Rn,g.reject=fn,g.remove=kn,g.rest=On,g.shuffle=pn,g.sortBy=vn,g.tap=vr,g.throttle=er,g.times=dr,g.toArray=yn,g.transform=Jt,g.union=Mn,g.uniq=qn,g.values=Qt,g.where=Ri,g.without=Nn,g.wrap=tr,g.xor=Dn,g.zip=Fn,g.zipObject=Bn,g.collect=sn,g.drop=On,g.each=rn,g.eachRight=on,g.extend=wi,g.methods=jt,g.object=Bn,g.select=en,g.tail=On,g.unique=qn,g.unzip=Fn,ar(g),g.clone=_t,g.cloneDeep=xt,g.contains=Kt,g.escape=ir,g.every=Zt,g.find=tn,g.findIndex=xn,g.findKey=Tt,g.findLast=nn,g.findLastIndex=wn,g.findLastKey=At,g.has=Ct,g.identity=or,g.indexOf=En,g.isArguments=bt,g.isArray=hi,g.isBoolean=Pt,g.isDate=Rt,g.isElement=kt,g.isEmpty=Ot,g.isEqual=It,g.isFinite=Mt,g.isFunction=qt,g.isNaN=Dt,g.isNull=Ft,g.isNumber=Bt,g.isObject=Nt,g.isPlainObject=Si,g.isRegExp=Ut,g.isString=Wt,g.isUndefined=Gt,g.lastIndexOf=Ln,g.mixin=ar,g.noConflict=sr,g.noop=ur,g.now=ki,g.parseInt=Oi,g.random=cr,g.reduce=cn,g.reduceRight=hn,g.result=hr,g.runInContext=d,g.size=gn,g.some=mn,g.sortedIndex=In,g.template=fr,g.unescape=pr,g.uniqueId=gr,g.all=Zt,g.any=mn,g.detect=tn,g.findWhere=tn,g.foldl=cn,g.foldr=hn,g.include=Kt,g.inject=cn,ar(function(){var e={};return Ei(g,function(t,n){g.prototype[n]||(e[n]=t)}),e}(),!1),g.first=Tn,g.last=Cn,g.sample=dn,g.take=Tn,g.head=Tn,Ei(g,function(e,t){var n="sample"!==t;g.prototype[t]||(g.prototype[t]=function(t,r){var i=this.__chain__,o=e(this.__wrapped__,t,r);return i||null!=t&&(!r||n&&"function"==typeof t)?new m(o,i):o})}),g.VERSION="2.4.1",g.prototype.chain=yr,g.prototype.toString=br,g.prototype.value=_r,g.prototype.valueOf=_r,xi(["join","pop","shift"],function(e){var t=kr[e];g.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new m(n,e):n}}),xi(["push","reverse","sort","unshift"],function(e){var t=kr[e];g.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),xi(["concat","slice","splice"],function(e){var t=kr[e];g.prototype[e]=function(){return new m(t.apply(this.__wrapped__,arguments),this.__chain__)}}),ui.spliceObjects||xi(["pop","shift","splice"],function(e){var t=kr[e],n="splice"==e;g.prototype[e]=function(){var e=this.__chain__,r=this.__wrapped__,i=t.apply(r,arguments);return 0===r.length&&delete r[0],e||n?new m(i,e):i}}),g}var p,g=[],m=[],v=0,y={},b=+new Date+"",_=75,x=40,w=" 	\f\n\r\u2028\u2029",T=/\b__p \+= '';/g,A=/\b(__p \+=) '' \+/g,E=/(__e\(.*?\)|\b__t\)) \+\n'';/g,S=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,j=/\w*$/,C=/^\s*function[ \n\r\t]+\w/,L=/<%=([\s\S]+?)%>/g,P=RegExp("^["+w+"]*0+(?=.$)"),R=/($^)/,O=/\bthis\b/,I=/['\n\r\t\u2028\u2029\\]/g,M=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],q=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],N=0,D="[object Arguments]",F="[object Array]",B="[object Boolean]",U="[object Date]",W="[object Error]",G="[object Function]",H="[object Number]",X="[object Object]",V="[object RegExp]",z="[object String]",Y={};Y[G]=!1,Y[D]=Y[F]=Y[B]=Y[U]=Y[H]=Y[X]=Y[V]=Y[z]=!0;var J={leading:!1,maxWait:0,trailing:!1},Q={configurable:!1,enumerable:!1,value:null,writable:!1},$={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},K={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Z={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},et=K[typeof window]&&window||this,tt=K[typeof exports]&&exports&&!exports.nodeType&&exports,nt=K[typeof module]&&module&&!module.nodeType&&module,rt=nt&&nt.exports===tt&&tt,it=K[typeof global]&&global;!it||it.global!==it&&it.window!==it||(et=it);var ot=d();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(et._=ot,define("lodash",[],function(){return ot})):tt&&nt?rt?(nt.exports=ot)._=ot:tt._=ot:et._=ot}.call(this),define("itself",["require"],function(){var e={};return function(t){return e[t]||(e[t]=new Function("its","return its"+t))}}),define("hooks",["require","lodash","itself"],function(e){{var t=e("lodash");e("itself")}return function(){var e={},n={};return e.register=function(e){var r=n[e.on]||(n[e.on]=[]);r.splice(t.sortedIndex(r,e,"order"),0,e)},e.run=function(e,t,r){var i=n[e];if(!i)return t;for(var o=0;o<i.length;o++)i[o].do.call(r,t)},e}}),function(e){e("when/when",["require"],function(e){function t(e,t,r,i){return n(e).then(t,r,i)}function n(e){return e instanceof r?e:i(e)}function r(e,t){this._message=e,this.inspect=t}function i(e){return s(function(t){t(e)})}function o(e){return t(e,h)}function a(){function e(e,o,a){t.resolve=t.resolver.resolve=function(t){return r?i(t):(r=!0,e(t),n)},t.reject=t.resolver.reject=function(e){return r?i(h(e)):(r=!0,o(e),n)},t.notify=t.resolver.notify=function(e){return a(e),e}}var t,n,r;return t={promise:Y,resolve:Y,reject:Y,notify:Y,resolver:{resolve:Y,reject:Y,notify:Y}},t.promise=n=s(e),t}function s(e){return u(e,H.PromiseStatus&&H.PromiseStatus())}function u(e,t){function n(e,t,n,r){function i(i){i._message(e,t,n,r)}f?f.push(i):R(function(){i(c)})}function i(){return c?c.inspect():P()}function o(e){if(f){var n=f;f=Y,R(function(){c=p(u,e),t&&y(c,t),l(n,c)})}}function a(e){o(h(e))}function s(e){if(f){var t=f;R(function(){l(t,d(e))})}}var u,c,f=[];u=new r(n,i),u._status=t;try{e(o,a,s)}catch(g){a(g)}return u}function l(e,t){for(var n=0;n<e.length;n++)e[n](t)}function c(e){return f(new m(e),function(){return C(e)})}function h(e){return f(new v(e),function(){return L(e)})}function f(e,t){return new r(function(t,n,r){try{r(e[t].apply(e,n))}catch(i){r(h(i))}},t)}function d(e){return new r(function(t,n,r,i){var o=n[2];try{i("function"==typeof o?o(e):e)}catch(a){i(a)}})}function p(e,t){if(t===e)return h(new TypeError);if(t instanceof r)return t;try{var n=t===Object(t)&&t.then;return"function"==typeof n?g(n,t):c(t)}catch(i){return h(i)}}function g(e,t){return s(function(n,r){D(e,t,n,r)})}function m(e){this.value=e}function v(e){this.reason=e}function y(e,t){function n(){t.fulfilled()}function r(e){t.rejected(e)}e.then(n,r)}function b(e){return e&&"function"==typeof e.then}function _(e,n,r,i,o){return t(e,function(e){function a(r,i,o){function a(e){d(e)}function s(e){f(e)}var u,l,c,h,f,d,p,g;if(p=e.length>>>0,u=Math.max(0,Math.min(n,p)),c=[],l=p-u+1,h=[],u)for(d=function(e){h.push(e),--l||(f=d=O,i(h))},f=function(e){c.push(e),--u||(f=d=O,r(c))},g=0;p>g;++g)g in e&&t(e[g],s,a,o);else r(c)}return s(a).then(r,i,o)})}function x(e,t,n,r){function i(e){return t?t(e[0]):e[0]}return _(e,1,i,n,r)}function w(e,t,n,r){return S(e,O).then(t,n,r)}function T(){return S(arguments,O)}function A(e){return S(e,C,L)}function E(e,t){return S(e,t)}function S(e,n,r){return t(e,function(e){function i(i,o,a){function s(e,s){t(e,n,r).then(function(e){u[s]=e,--c||i(u)},o,a)}var u,l,c,h;if(c=l=e.length>>>0,u=[],!c)return i(u),void 0;for(h=0;l>h;h++)h in e?s(e[h],h):--c}return u(i)})}function j(e,n){var r=D(N,arguments,1);return t(e,function(e){var i;return i=e.length,r[0]=function(e,r,o){return t(e,function(e){return t(r,function(t){return n(e,t,o,i)})})},q.apply(e,r)})}function C(e){return{state:"fulfilled",value:e}}function L(e){return{state:"rejected",reason:e}}function P(){return{state:"pending"}}function R(e){1===B.push(e)&&F(k)}function k(){l(B),B=[]}function O(e){return e}function I(e){throw"function"==typeof H.reportUnhandled?H.reportUnhandled():R(function(){throw e}),e}t.promise=s,t.resolve=i,t.reject=o,t.defer=a,t.join=T,t.all=w,t.map=E,t.reduce=j,t.settle=A,t.any=x,t.some=_,t.isPromise=b,t.isPromiseLike=b;var M=r.prototype;M.then=function(){var e,t;return e=arguments,t=this._message,u(function(n,r,i){t("when",e,n,i)},this._status&&this._status.observed())},M["catch"]=M.otherwise=function(e){return this.then(Y,e)},M["finally"]=M.ensure=function(e){function t(){return i(e())}return"function"==typeof e?this.then(t,t).yield(this):this},M.done=function(e,t){this.then(e,t).otherwise(I)},M.yield=function(e){return this.then(function(){return e})},M.tap=function(e){return this.then(e).yield(this)},M.spread=function(e){return this.then(function(t){return w(t,function(t){return e.apply(Y,t)})})},M.always=function(e,t){return this.then(e,e,t)},m.prototype.when=function(e){return"function"==typeof e?e(this.value):this.value},v.prototype.when=function(e,t){if("function"==typeof t)return t(this.reason);throw this.reason};var q,N,D,F,B,U,W,G,H,X,V,z,Y;if(V=e,B=[],H="undefined"!=typeof console?console:t,"object"==typeof process&&process.nextTick)F=process.nextTick;else if(z="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)F=function(e,t,n){var r=e.createElement("div");return new t(n).observe(r,{attributes:!0}),function(){r.setAttribute("x","x")}}(document,z,k);else try{F=V("vertx").runOnLoop||V("vertx").runOnContext}catch(J){X=setTimeout,F=function(e){X(e,0)}}return U=Function.prototype,W=U.call,D=U.bind?W.bind(W):function(e,t){return e.apply(t,N.call(arguments,2))},G=[],N=G.slice,q=G.reduce||function(e){var t,n,r,i,o;if(o=0,t=Object(this),i=t.length>>>0,n=arguments,n.length<=1)for(;;){if(o in t){r=t[o++];break}if(++o>=i)throw new TypeError}else r=n[1];for(;i>o;++o)o in t&&(r=e(r,t[o],o,t));return r},t})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)}),define("when",["when/when"],function(e){return e}),define("app",["require","desire","hooks","lodash","when"],function(e){{var t=e("desire"),n=e("hooks"),r=e("lodash");e("when")}return function(){function e(e){o.register(e.components),r.each(e.hooks,a.register)}function i(e){function t(t,n){return a.run(t,n,e)}return t.derive=i,t}var o=new t,a=new n,s={desire:o};return s.desire=o,s.plug=e,s.hook=i(s),o.register({hook:t.value(s.hook)}),o.register({hooks:t.value(a)}),s}}),function(){function e(){return i.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,i.Matrix}function t(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}function t(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}var n=this,i=i||{};i.Point=function(e,t){this.x=e||0,this.y=t||0},i.Point.prototype.clone=function(){return new i.Point(this.x,this.y)},i.Point.prototype.constructor=i.Point,i.Rectangle=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},i.Rectangle.prototype.clone=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},i.Rectangle.prototype.constructor=i.Rectangle,i.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var t=[],n=0,r=e.length;r>n;n+=2)t.push(new i.Point(e[n],e[n+1]));e=t}this.points=e},i.Polygon.prototype.clone=function(){for(var e=[],t=0;t<this.points.length;t++)e.push(this.points[t].clone());return new i.Polygon(e)},i.Polygon.prototype.contains=function(e,t){for(var n=!1,r=0,i=this.points.length-1;r<this.points.length;i=r++){var o=this.points[r].x,a=this.points[r].y,s=this.points[i].x,u=this.points[i].y,l=a>t!=u>t&&(s-o)*(t-a)/(u-a)+o>e;l&&(n=!n)}return n},i.Polygon.prototype.constructor=i.Polygon,i.Circle=function(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0},i.Circle.prototype.clone=function(){return new i.Circle(this.x,this.y,this.radius)},i.Circle.prototype.contains=function(e,t){if(this.radius<=0)return!1;var n=this.x-e,r=this.y-t,i=this.radius*this.radius;return n*=n,r*=r,i>=n+r},i.Circle.prototype.constructor=i.Circle,i.Ellipse=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},i.Ellipse.prototype.clone=function(){return new i.Ellipse(this.x,this.y,this.width,this.height)},i.Ellipse.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width-.5,r=(t-this.y)/this.height-.5;return n*=n,r*=r,.25>n+r},i.Ellipse.getBounds=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Ellipse.prototype.constructor=i.Ellipse,e(),i.mat3={},i.mat3.create=function(){var e=new i.Matrix(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},i.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},i.mat4={},i.mat4.create=function(){var e=new i.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.mat3.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=t[0],d=t[1],p=t[2],g=t[3],m=t[4],v=t[5],y=t[6],b=t[7],_=t[8];return n[0]=f*r+d*a+p*l,n[1]=f*i+d*s+p*c,n[2]=f*o+d*u+p*h,n[3]=g*r+m*a+v*l,n[4]=g*i+m*s+v*c,n[5]=g*o+m*u+v*h,n[6]=y*r+b*a+_*l,n[7]=y*i+b*s+_*c,n[8]=y*o+b*u+_*h,n},i.mat3.clone=function(e){var t=new i.Matrix(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},i.mat3.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},i.mat3.toMat4=function(e,t){return t||(t=i.mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},i.mat4.create=function(){var e=new i.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.mat4.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=o,e[11]=e[14],e[12]=i,e[13]=a,e[14]=s,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},i.mat4.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=t[0],_=t[1],x=t[2],w=t[3];return n[0]=b*r+_*s+x*h+w*g,n[1]=b*i+_*u+x*f+w*m,n[2]=b*o+_*l+x*d+w*v,n[3]=b*a+_*c+x*p+w*y,b=t[4],_=t[5],x=t[6],w=t[7],n[4]=b*r+_*s+x*h+w*g,n[5]=b*i+_*u+x*f+w*m,n[6]=b*o+_*l+x*d+w*v,n[7]=b*a+_*c+x*p+w*y,b=t[8],_=t[9],x=t[10],w=t[11],n[8]=b*r+_*s+x*h+w*g,n[9]=b*i+_*u+x*f+w*m,n[10]=b*o+_*l+x*d+w*v,n[11]=b*a+_*c+x*p+w*y,b=t[12],_=t[13],x=t[14],w=t[15],n[12]=b*r+_*s+x*h+w*g,n[13]=b*i+_*u+x*f+w*m,n[14]=b*o+_*l+x*d+w*v,n[15]=b*a+_*c+x*p+w*y,n},i.DisplayObject=function(){this.last=this,this.first=this,this.position=new i.Point,this.scale=new i.Point(1,1),this.pivot=new i.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.worldTransform=i.mat3.create(),this.localTransform=i.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1},i.DisplayObject.prototype.constructor=i.DisplayObject,i.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(i.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(i.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=e,e?this.addFilter(e):this.removeFilter()}}),i.DisplayObject.prototype.addFilter=function(e){if(!this.filter){this.filter=!0;var t=new i.FilterBlock,n=new i.FilterBlock;t.mask=e,n.mask=e,t.first=t.last=this,n.first=n.last=this,t.open=!0;var r,o,a=t,s=t;o=this.first._iPrev,o?(r=o._iNext,a._iPrev=o,o._iNext=a):r=this,r&&(r._iPrev=s,s._iNext=r);var a=n,s=n,r=null,o=null;o=this.last,r=o._iNext,r&&(r._iPrev=s,s._iNext=r),a._iPrev=o,o._iNext=a;for(var u=this,l=this.last;u;)u.last==l&&(u.last=n),u=u.parent;this.first=t,this.__renderGroup&&this.__renderGroup.addFilterBlocks(t,n),e.renderable=!1}},i.DisplayObject.prototype.removeFilter=function(){if(this.filter){this.filter=!1;var e=this.first,t=e._iNext,n=e._iPrev;t&&(t._iPrev=n),n&&(n._iNext=t),this.first=e._iNext;var r=this.last,t=r._iNext,n=r._iPrev;t&&(t._iPrev=n),n._iNext=t;for(var i=r._iPrev,o=this;o.last==r&&(o.last=i,o=o.parent););var a=e.mask;a.renderable=!0,this.__renderGroup&&this.__renderGroup.removeFilterBlocks(e,r)}},i.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.localTransform,t=this.parent.worldTransform,n=this.worldTransform;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y;var r=this.pivot.x,o=this.pivot.y,a=e[0],s=e[1],u=this.position.x-e[0]*r-o*e[1],l=e[3],c=e[4],h=this.position.y-e[4]*o-r*e[3],f=t[0],d=t[1],p=t[2],g=t[3],m=t[4],v=t[5];e[2]=u,e[5]=h,n[0]=f*a+d*l,n[1]=f*s+d*c,n[2]=f*u+d*h+p,n[3]=g*a+m*l,n[4]=g*s+m*c,n[5]=g*u+m*h+v,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.vcount=i.visibleCount},i.visibleCount=0,i.DisplayObjectContainer=function(){i.DisplayObject.call(this),this.children=[]},i.DisplayObjectContainer.prototype=Object.create(i.DisplayObject.prototype),i.DisplayObjectContainer.prototype.constructor=i.DisplayObjectContainer,i.DisplayObjectContainer.prototype.addChild=function(e){if(void 0!=e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.stage){var t=e;do t.interactive&&(this.stage.dirty=!0),t.stage=this.stage,t=t._iNext;while(t)}var n,r,i=e.first,o=e.last;r=this.filter?this.last._iPrev:this.last,n=r._iNext;for(var a=this,s=r;a;)a.last==s&&(a.last=e.last),a=a.parent;n&&(n._iPrev=o,o._iNext=n),i._iPrev=r,r._iNext=i,this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},i.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(!(t>=0&&t<=this.children.length))throw new Error(e+" The index "+t+" supplied is out of bounds "+this.children.length);if(void 0!=e.parent&&e.parent.removeChild(e),e.parent=this,this.stage){var n=e;do n.interactive&&(this.stage.dirty=!0),n.stage=this.stage,n=n._iNext;while(n)}var r,i,o=e.first,a=e.last;if(t==this.children.length){i=this.last;for(var s=this,u=this.last;s;)s.last==u&&(s.last=e.last),s=s.parent}else i=0==t?this:this.children[t-1].last;r=i._iNext,r&&(r._iPrev=a,a._iNext=r),o._iPrev=i,i._iNext=o,this.children.splice(t,0,e),this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},i.DisplayObjectContainer.prototype.swapChildren=function(){},i.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},i.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error(e+" The supplied DisplayObject must be a child of the caller "+this);var n=e.first,r=e.last,i=r._iNext,o=n._iPrev;if(i&&(i._iPrev=o),o._iNext=i,this.last==r)for(var a=n._iPrev,s=this;s.last==r.last&&(s.last=a,s=s.parent););if(r._iNext=null,n._iPrev=null,this.stage){var u=e;do u.interactive&&(this.stage.dirty=!0),u.stage=null,u=u._iNext;while(u)}e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),e.parent=void 0,this.children.splice(t,1)},i.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){i.DisplayObject.prototype.updateTransform.call(this);for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform()}},i.blendModes={},i.blendModes.NORMAL=0,i.blendModes.SCREEN=1,i.Sprite=function(e){i.DisplayObjectContainer.call(this),this.anchor=new i.Point,this.texture=e,this.blendMode=i.blendModes.NORMAL,this._width=0,this._height=0,e.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Sprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Sprite.prototype.constructor=i.Sprite,Object.defineProperty(i.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width
},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(i.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),i.Sprite.prototype.setTexture=function(e){this.texture.baseTexture!=e.baseTexture?(this.textureChange=!0,this.texture=e,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=e,this.updateFrame=!0},i.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},i.Sprite.fromFrame=function(e){var t=i.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache"+this);return new i.Sprite(t)},i.Sprite.fromImage=function(e){var t=i.Texture.fromImage(e);return new i.Sprite(t)},i.MovieClip=function(e){i.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},i.MovieClip.prototype=Object.create(i.Sprite.prototype),i.MovieClip.prototype.constructor=i.MovieClip,i.MovieClip.prototype.stop=function(){this.playing=!1},i.MovieClip.prototype.play=function(){this.playing=!0},i.MovieClip.prototype.gotoAndStop=function(e){this.playing=!1,this.currentFrame=e;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},i.MovieClip.prototype.gotoAndPlay=function(e){this.currentFrame=e,this.playing=!0},i.MovieClip.prototype.updateTransform=function(){if(i.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var e=this.currentFrame+.5|0;this.loop||e<this.textures.length?this.setTexture(this.textures[e%this.textures.length]):e>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},i.FilterBlock=function(e){this.graphics=e,this.visible=!0,this.renderable=!0},i.Text=function(e,t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),i.Sprite.call(this,i.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},i.Text.prototype=Object.create(i.Sprite.prototype),i.Text.prototype.constructor=i.Text,i.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,this.style=e,this.dirty=!0},i.Sprite.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},i.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,o=0;o<t.length;o++){var a=this.context.measureText(t[o]).width;n[o]=a,r=Math.max(r,a)}this.canvas.width=r+this.style.strokeThickness;var s=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=s*t.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",o=0;o<t.length;o++){var u=new i.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+o*s);"right"==this.style.align?u.x+=r-n[o]:"center"==this.style.align&&(u.x+=(r-n[o])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[o],u.x,u.y),this.style.fill&&this.context.fillText(t[o],u.x,u.y)}this.updateTexture()},i.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,i.texturesToUpdate.push(this.texture.baseTexture)},i.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),i.Sprite.prototype.updateTransform.call(this)},i.Text.prototype.determineFontHeight=function(e){var t=i.Text.heightCache[e];if(!t){var n=document.getElementsByTagName("body")[0],r=document.createElement("div"),o=document.createTextNode("M");r.appendChild(o),r.setAttribute("style",e+";position:absolute;top:0;left:0"),n.appendChild(r),t=r.offsetHeight,i.Text.heightCache[e]=t,n.removeChild(r)}return t},i.Text.prototype.wordWrap=function(e){for(var t=function(e,t,n,r,i){var o=Math.floor((r-n)/2)+n;return o==n?1:e.measureText(t.substring(0,o)).width<=i?e.measureText(t.substring(0,o+1)).width>i?o:arguments.callee(e,t,o,r,i):arguments.callee(e,t,n,o,i)},n=function(e,n,r){if(e.measureText(n).width<=r||n.length<1)return n;var i=t(e,n,0,n.length,r);return n.substring(0,i)+"\n"+arguments.callee(e,n.substring(i),r)},r="",i=e.split("\n"),o=0;o<i.length;o++)r+=n(this.context,i[o],this.style.wordWrapWidth)+"\n";return r},i.Text.prototype.destroy=function(e){e&&this.texture.destroy()},i.Text.heightCache={},i.BitmapText=function(e,t){i.DisplayObjectContainer.call(this),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},i.BitmapText.prototype=Object.create(i.DisplayObjectContainer.prototype),i.BitmapText.prototype.constructor=i.BitmapText,i.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},i.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var t=e.font.split(" ");this.fontName=t[t.length-1],this.fontSize=t.length>=2?parseInt(t[t.length-2],10):i.BitmapText.fonts[this.fontName].size,this.dirty=!0},i.BitmapText.prototype.updateText=function(){for(var e=i.BitmapText.fonts[this.fontName],t=new i.Point,n=null,r=[],o=0,a=[],s=0,u=this.fontSize/e.size,l=0;l<this.text.length;l++){var c=this.text.charCodeAt(l);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(l)))a.push(t.x),o=Math.max(o,t.x),s++,t.x=0,t.y+=e.lineHeight,n=null;else{var h=e.chars[c];h&&(n&&h[n]&&(t.x+=h.kerning[n]),r.push({texture:h.texture,line:s,charCode:c,position:new i.Point(t.x+h.xOffset,t.y+h.yOffset)}),t.x+=h.xAdvance,n=c)}}a.push(t.x),o=Math.max(o,t.x);var f=[];for(l=0;s>=l;l++){var d=0;"right"==this.style.align?d=o-a[l]:"center"==this.style.align&&(d=(o-a[l])/2),f.push(d)}for(l=0;l<r.length;l++){var p=new i.Sprite(r[l].texture);p.position.x=(r[l].position.x+f[r[l].line])*u,p.position.y=r[l].position.y*u,p.scale.x=p.scale.y=u,this.addChild(p)}this.width=t.x*u,this.height=(t.y+e.lineHeight)*u},i.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.BitmapText.fonts={},i.InteractionManager=function(e){this.stage=e,this.mouse=new i.InteractionData,this.touchs={},this.tempPoint=new i.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.last=0},i.InteractionManager.prototype.constructor=i.InteractionManager,i.InteractionManager.prototype.collectInteractiveSprite=function(e,t){for(var n=e.children,r=n.length,i=r-1;i>=0;i--){var o=n[i];o.interactive?(t.interactiveChildren=!0,this.interactiveItems.push(o),o.children.length>0&&this.collectInteractiveSprite(o,o)):(o.__iParent=null,o.children.length>0&&this.collectInteractiveSprite(o,t))}},i.InteractionManager.prototype.setTarget=function(e){window.navigator.msPointerEnabled&&(e.view.style["-ms-content-zooming"]="none",e.view.style["-ms-touch-action"]="none"),this.target=e,e.view.addEventListener("mousemove",this.onMouseMove.bind(this),!0),e.view.addEventListener("mousedown",this.onMouseDown.bind(this),!0),document.body.addEventListener("mouseup",this.onMouseUp.bind(this),!0),e.view.addEventListener("mouseout",this.onMouseOut.bind(this),!0),e.view.addEventListener("touchstart",this.onTouchStart.bind(this),!0),e.view.addEventListener("touchend",this.onTouchEnd.bind(this),!0),e.view.addEventListener("touchmove",this.onTouchMove.bind(this),!0)},i.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),t=e-this.last;if(t=30*t/1e3,!(1>t)){if(this.last=e,this.dirty){this.dirty=!1;for(var n=this.interactiveItems.length,r=0;n>r;r++)this.interactiveItems[r].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var i=this.interactiveItems.length;this.target.view.style.cursor="default";for(var r=0;i>r;r++){var o=this.interactiveItems[r];(o.mouseover||o.mouseout||o.buttonMode)&&(o.__hit=this.hitTest(o,this.mouse),this.mouse.target=o,o.__hit?(o.buttonMode&&(this.target.view.style.cursor="pointer"),o.__isOver||(o.mouseover&&o.mouseover(this.mouse),o.__isOver=!0)):o.__isOver&&(o.mouseout&&o.mouseout(this.mouse),o.__isOver=!1))}}}},i.InteractionManager.prototype.onMouseMove=function(e){this.mouse.originalEvent=e||window.event;var t=this.target.view.getBoundingClientRect();this.mouse.global.x=(e.clientX-t.left)*(this.target.width/t.width),this.mouse.global.y=(e.clientY-t.top)*(this.target.height/t.height);for(var n=this.interactiveItems.length,r=(this.mouse.global,0);n>r;r++){var i=this.interactiveItems[r];i.mousemove&&i.mousemove(this.mouse)}},i.InteractionManager.prototype.onMouseDown=function(e){this.mouse.originalEvent=e||window.event;for(var t=this.interactiveItems.length,n=(this.mouse.global,this.stage,0);t>n;n++){var r=this.interactiveItems[n];if((r.mousedown||r.click)&&(r.__mouseIsDown=!0,r.__hit=this.hitTest(r,this.mouse),r.__hit&&(r.mousedown&&r.mousedown(this.mouse),r.__isDown=!0,!r.interactiveChildren)))break}},i.InteractionManager.prototype.onMouseOut=function(){var e=this.interactiveItems.length;this.target.view.style.cursor="default";for(var t=0;e>t;t++){var n=this.interactiveItems[t];n.__isOver&&(this.mouse.target=n,n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1)}},i.InteractionManager.prototype.onMouseUp=function(e){this.mouse.originalEvent=e||window.event;for(var t=(this.mouse.global,this.interactiveItems.length),n=!1,r=0;t>r;r++){var i=this.interactiveItems[r];(i.mouseup||i.mouseupoutside||i.click)&&(i.__hit=this.hitTest(i,this.mouse),i.__hit&&!n?(i.mouseup&&i.mouseup(this.mouse),i.__isDown&&i.click&&i.click(this.mouse),i.interactiveChildren||(n=!0)):i.__isDown&&i.mouseupoutside&&i.mouseupoutside(this.mouse),i.__isDown=!1)}},i.InteractionManager.prototype.hitTest=function(e,t){var n=t.global;if(e.vcount!==i.visibleCount)return!1;var r=e instanceof i.Sprite,o=e.worldTransform,a=o[0],s=o[1],u=o[2],l=o[3],c=o[4],h=o[5],f=1/(a*c+s*-l),d=c*f*n.x+-s*f*n.y+(h*s-u*c)*f,p=a*f*n.y+-l*f*n.x+(-h*a+u*l)*f;if(t.target=e,e.hitArea&&e.hitArea.contains)return e.hitArea.contains(d,p)?(t.target=e,!0):!1;if(r){var g,m=e.texture.frame.width,v=e.texture.frame.height,y=-m*e.anchor.x;if(d>y&&y+m>d&&(g=-v*e.anchor.y,p>g&&g+v>p))return t.target=e,!0}for(var b=e.children.length,_=0;b>_;_++){var x=e.children[_],w=this.hitTest(x,t);if(w)return t.target=e,!0}return!1},i.InteractionManager.prototype.onTouchMove=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier];o.originalEvent=e||window.event,o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height)}for(var a=this.interactiveItems.length,r=0;a>r;r++){var s=this.interactiveItems[r];s.touchmove&&s.touchmove(o)}},i.InteractionManager.prototype.onTouchStart=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var o=n[r],a=this.pool.pop();a||(a=new i.InteractionData),a.originalEvent=e||window.event,this.touchs[o.identifier]=a,a.global.x=(o.clientX-t.left)*(this.target.width/t.width),a.global.y=(o.clientY-t.top)*(this.target.height/t.height);for(var s=this.interactiveItems.length,u=0;s>u;u++){var l=this.interactiveItems[u];if((l.touchstart||l.tap)&&(l.__hit=this.hitTest(l,a),l.__hit&&(l.touchstart&&l.touchstart(a),l.__isDown=!0,l.__touchData=a,!l.interactiveChildren)))break}}},i.InteractionManager.prototype.onTouchEnd=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier],a=!1;o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height);for(var s=this.interactiveItems.length,u=0;s>u;u++){var l=this.interactiveItems[u],c=l.__touchData;l.__hit=this.hitTest(l,o),c==o&&(o.originalEvent=e||window.event,(l.touchend||l.tap)&&(l.__hit&&!a?(l.touchend&&l.touchend(o),l.__isDown&&l.tap&&l.tap(o),l.interactiveChildren||(a=!0)):l.__isDown&&l.touchendoutside&&l.touchendoutside(o),l.__isDown=!1),l.__touchData=null)}this.pool.push(o),this.touchs[i.identifier]=null}},i.InteractionData=function(){this.global=new i.Point,this.local=new i.Point,this.target,this.originalEvent},i.InteractionData.prototype.getLocalPosition=function(e){var t=e.worldTransform,n=this.global,r=t[0],o=t[1],a=t[2],s=t[3],u=t[4],l=t[5],c=1/(r*u+o*-s);return new i.Point(u*c*n.x+-o*c*n.y+(l*o-a*u)*c,r*c*n.y+-s*c*n.x+(-l*r+a*s)*c)},i.InteractionData.prototype.constructor=i.InteractionData,i.Stage=function(e,t){i.DisplayObjectContainer.call(this),this.worldTransform=i.mat3.create(),this.interactive=t,this.interactionManager=new i.InteractionManager(this),this.dirty=!0,this.__childrenAdded=[],this.__childrenRemoved=[],this.stage=this,this.stage.hitArea=new i.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e),this.worldVisible=!0},i.Stage.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Stage.prototype.constructor=i.Stage,i.Stage.prototype.updateTransform=function(){this.worldAlpha=1,this.vcount=i.visibleCount;for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},i.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},i.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var o=0,s=["ms","moz","webkit","o"],u=0;u<s.length&&!window.requestAnimationFrame;++u)window.requestAnimationFrame=window[s[u]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s[u]+"CancelAnimationFrame"]||window[s[u]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-o)),r=window.setTimeout(function(){e(t+n)},n);return o=t+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimFrame=window.requestAnimationFrame,"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function n(){var o=i.concat(e.call(arguments));r.apply(this instanceof n?this:t,o)}var r=this,i=e.call(arguments,1);if("function"!=typeof r)throw new TypeError;return n.prototype=function o(e){return e&&(o.prototype=e),this instanceof o?void 0:new o}(r.prototype),n}}());var l=i.AjaxRequest=function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}};i.runList=function(e){console.log(">>>>>>>>>"),console.log("_");var t=0,n=e.first;for(console.log(n);n._iNext;)if(t++,n=n._iNext,console.log(n),t>100){console.log("BREAK");break}},i.EventTarget=function(){var e={};this.addEventListener=this.on=function(t,n){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(n)&&e[t].push(n)},this.dispatchEvent=this.emit=function(t){for(var n in e[t.type])e[t.type][n](t)},this.removeEventListener=this.off=function(t,n){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}},i.autoDetectRenderer=function(e,t,n,r,o){e||(e=800),t||(t=600);var a=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}();if(a){var s=-1!=navigator.userAgent.toLowerCase().indexOf("msie");a=!s}return a?new i.WebGLRenderer(e,t,n,r,o):new i.CanvasRenderer(e,t,n,r)},i.PolyK={},i.PolyK.Triangulate=function(e){var t=!0,n=e.length>>1;if(3>n)return[];for(var r=[],o=[],a=0;n>a;a++)o.push(a);for(var a=0,s=n;s>3;){var u=o[(a+0)%s],l=o[(a+1)%s],c=o[(a+2)%s],h=e[2*u],f=e[2*u+1],d=e[2*l],p=e[2*l+1],g=e[2*c],m=e[2*c+1],v=!1;if(i.PolyK._convex(h,f,d,p,g,m,t)){v=!0;for(var y=0;s>y;y++){var b=o[y];if(b!=u&&b!=l&&b!=c&&i.PolyK._PointInTriangle(e[2*b],e[2*b+1],h,f,d,p,g,m)){v=!1;break}}}if(v)r.push(u,l,c),o.splice((a+1)%s,1),s--,a=0;else if(a++>3*s){if(!t)return console.log("PIXI Warning: shape too complex to fill"),[];var r=[];o=[];for(var a=0;n>a;a++)o.push(a);a=0,s=n,t=!1}}return r.push(o[0],o[1],o[2]),r},i.PolyK._PointInTriangle=function(e,t,n,r,i,o,a,s){var u=a-n,l=s-r,c=i-n,h=o-r,f=e-n,d=t-r,p=u*u+l*l,g=u*c+l*h,m=u*f+l*d,v=c*c+h*h,y=c*f+h*d,b=1/(p*v-g*g),_=(v*m-g*y)*b,x=(p*y-g*m)*b;return _>=0&&x>=0&&1>_+x},i.PolyK._convex=function(e,t,n,r,i,o,a){return(t-r)*(i-n)+(n-e)*(o-r)>=0==a},i.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],i.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = vec4( aVertexPosition.x / projectionVector.x -1.0, aVertexPosition.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.stripShaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"],i.stripShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.primitiveShaderFragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"],i.primitiveShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"],i.initPrimitiveShader=function(){var e=i.gl,t=i.compileProgram(i.primitiveShaderVertexSrc,i.primitiveShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),i.primitiveProgram=t},i.initDefaultShader=function(){var e=this.gl,t=i.compileProgram(i.shaderVertexSrc,i.shaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),i.shaderProgram=t},i.initDefaultStripShader=function(){var e=this.gl,t=i.compileProgram(i.stripShaderVertexSrc,i.stripShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),i.stripShaderProgram=t},i.CompileVertexShader=function(e,t){return i._CompileShader(e,t,e.VERTEX_SHADER)},i.CompileFragmentShader=function(e,t){return i._CompileShader(e,t,e.FRAGMENT_SHADER)},i._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert(e.getShaderInfoLog(i)),null)},i.compileProgram=function(e,t){var n=i.gl,r=i.CompileFragmentShader(n,t),o=i.CompileVertexShader(n,e),a=n.createProgram();return n.attachShader(a,o),n.attachShader(a,r),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||alert("Could not initialise shaders"),a},i.activateDefaultShader=function(){var e=i.gl,t=i.shaderProgram;e.useProgram(t),e.enableVertexAttribArray(t.vertexPositionAttribute),e.enableVertexAttribArray(t.textureCoordAttribute),e.enableVertexAttribArray(t.colorAttribute)},i.activatePrimitiveShader=function(){var e=i.gl;e.disableVertexAttribArray(i.shaderProgram.textureCoordAttribute),e.disableVertexAttribArray(i.shaderProgram.colorAttribute),e.useProgram(i.primitiveProgram),e.enableVertexAttribArray(i.primitiveProgram.vertexPositionAttribute),e.enableVertexAttribArray(i.primitiveProgram.colorAttribute)},i.WebGLGraphics=function(){},i.WebGLGraphics.renderGraphics=function(e,t){var n=i.gl;e._webGL||(e._webGL={points:[],indices:[],lastIndex:0,buffer:n.createBuffer(),indexBuffer:n.createBuffer()}),e.dirty&&(e.dirty=!1,e.clearDirty&&(e.clearDirty=!1,e._webGL.lastIndex=0,e._webGL.points=[],e._webGL.indices=[]),i.WebGLGraphics.updateGraphics(e)),i.activatePrimitiveShader();var r=i.mat3.clone(e.worldTransform);i.mat3.transpose(r),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.uniformMatrix3fv(i.primitiveProgram.translationMatrix,!1,r),n.uniform2f(i.primitiveProgram.projectionVector,t.x,t.y),n.uniform1f(i.primitiveProgram.alpha,e.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e._webGL.buffer),n.vertexAttribPointer(i.shaderProgram.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.vertexAttribPointer(i.primitiveProgram.vertexPositionAttribute,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(i.primitiveProgram.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,e._webGL.indices.length,n.UNSIGNED_SHORT,0),i.activateDefaultShader()},i.WebGLGraphics.updateGraphics=function(e){for(var t=e._webGL.lastIndex;t<e.graphicsData.length;t++){var n=e.graphicsData[t];n.type==i.Graphics.POLY?(n.fill&&n.points.length>3&&i.WebGLGraphics.buildPoly(n,e._webGL),n.lineWidth>0&&i.WebGLGraphics.buildLine(n,e._webGL)):n.type==i.Graphics.RECT?i.WebGLGraphics.buildRectangle(n,e._webGL):(n.type==i.Graphics.CIRC||n.type==i.Graphics.ELIP)&&i.WebGLGraphics.buildCircle(n,e._webGL)}e._webGL.lastIndex=e.graphicsData.length;var r=i.gl;e._webGL.glPoints=new Float32Array(e._webGL.points),r.bindBuffer(r.ARRAY_BUFFER,e._webGL.buffer),r.bufferData(r.ARRAY_BUFFER,e._webGL.glPoints,r.STATIC_DRAW),e._webGL.glIndicies=new Uint16Array(e._webGL.indices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e._webGL.glIndicies,r.STATIC_DRAW)},i.WebGLGraphics.buildRectangle=function(e,n){var r=e.points,o=r[0],a=r[1],s=r[2],u=r[3];if(e.fill){var l=t(e.fillColor),c=e.fillAlpha,h=l[0]*c,f=l[1]*c,d=l[2]*c,p=n.points,g=n.indices,m=p.length/6;p.push(o,a),p.push(h,f,d,c),p.push(o+s,a),p.push(h,f,d,c),p.push(o,a+u),p.push(h,f,d,c),p.push(o+s,a+u),p.push(h,f,d,c),g.push(m,m,m+1,m+2,m+3,m+3)}e.lineWidth&&(e.points=[o,a,o+s,a,o+s,a+u,o,a+u,o,a],i.WebGLGraphics.buildLine(e,n))},i.WebGLGraphics.buildCircle=function(e,n){var r=e.points,o=r[0],a=r[1],s=r[2],u=r[3],l=40,c=2*Math.PI/l;if(e.fill){var h=t(e.fillColor),f=e.fillAlpha,d=h[0]*f,p=h[1]*f,g=h[2]*f,m=n.points,v=n.indices,y=m.length/6;v.push(y);for(var b=0;l+1>b;b++)m.push(o,a,d,p,g,f),m.push(o+Math.sin(c*b)*s,a+Math.cos(c*b)*u,d,p,g,f),v.push(y++,y++);v.push(y-1)}if(e.lineWidth){e.points=[];for(var b=0;l+1>b;b++)e.points.push(o+Math.sin(c*b)*s,a+Math.cos(c*b)*u);i.WebGLGraphics.buildLine(e,n)}},i.WebGLGraphics.buildLine=function(e,n){var r=e.points;if(0!=r.length){var o=new i.Point(r[0],r[1]),a=new i.Point(r[r.length-2],r[r.length-1]);if(o.x==a.x&&o.y==a.y){r.pop(),r.pop(),a=new i.Point(r[r.length-2],r[r.length-1]);var s=a.x+.5*(o.x-a.x),u=a.y+.5*(o.y-a.y);r.unshift(s,u),r.push(s,u)}var l,c,h,f,d,p,g,m,v,y,b,_,x,w,T,A,E,S,j,C,L,P=n.points,R=n.indices,k=r.length/2,O=r.length,I=P.length/6,M=e.lineWidth/2,q=t(e.lineColor),N=e.lineAlpha,D=q[0]*N,F=q[1]*N,B=q[2]*N;l=r[0],c=r[1],h=r[2],f=r[3],g=-(c-f),m=l-h,L=Math.sqrt(g*g+m*m),g/=L,m/=L,g*=M,m*=M,P.push(l-g,c-m,D,F,B,N),P.push(l+g,c+m,D,F,B,N);for(var U=1;k-1>U;U++)l=r[2*(U-1)],c=r[2*(U-1)+1],h=r[2*U],f=r[2*U+1],d=r[2*(U+1)],p=r[2*(U+1)+1],g=-(c-f),m=l-h,L=Math.sqrt(g*g+m*m),g/=L,m/=L,g*=M,m*=M,v=-(f-p),y=h-d,L=Math.sqrt(v*v+y*y),v/=L,y/=L,v*=M,y*=M,x=-m+c-(-m+f),w=-g+h-(-g+l),T=(-g+l)*(-m+f)-(-g+h)*(-m+c),A=-y+p-(-y+f),E=-v+h-(-v+d),S=(-v+d)*(-y+f)-(-v+h)*(-y+p),j=x*E-A*w,0==j&&(j+=1),px=(w*S-E*T)/j,py=(A*T-x*S)/j,C=(px-h)*(px-h)+(py-f)+(py-f),C>19600?(b=g-v,_=m-y,L=Math.sqrt(b*b+_*_),b/=L,_/=L,b*=M,_*=M,P.push(h-b,f-_),P.push(D,F,B,N),P.push(h+b,f+_),P.push(D,F,B,N),P.push(h-b,f-_),P.push(D,F,B,N),O++):(P.push(px,py),P.push(D,F,B,N),P.push(h-(px-h),f-(py-f)),P.push(D,F,B,N));l=r[2*(k-2)],c=r[2*(k-2)+1],h=r[2*(k-1)],f=r[2*(k-1)+1],g=-(c-f),m=l-h,L=Math.sqrt(g*g+m*m),g/=L,m/=L,g*=M,m*=M,P.push(h-g,f-m),P.push(D,F,B,N),P.push(h+g,f+m),P.push(D,F,B,N),R.push(I);for(var U=0;O>U;U++)R.push(I++);R.push(I-1)}},i.WebGLGraphics.buildPoly=function(e,n){var r=e.points;if(!(r.length<6)){for(var o=n.points,a=n.indices,s=r.length/2,u=t(e.fillColor),l=e.fillAlpha,c=u[0]*l,h=u[1]*l,f=u[2]*l,d=i.PolyK.Triangulate(r),p=o.length/6,g=0;g<d.length;g+=3)a.push(d[g]+p),a.push(d[g]+p),a.push(d[g+1]+p),a.push(d[g+2]+p),a.push(d[g+2]+p);for(var g=0;s>g;g++)o.push(r[2*g],r[2*g+1],c,h,f,l)}},i._defaultFrame=new i.Rectangle(0,0,1,1),i.gl,i.WebGLRenderer=function(e,t,n,r,o){this.transparent=!!r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var a=this;this.view.addEventListener("webglcontextlost",function(e){a.handleContextLost(e)},!1),this.view.addEventListener("webglcontextrestored",function(e){a.handleContextRestored(e)},!1),this.batchs=[];try{i.gl=this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!!o,premultipliedAlpha:!1,stencil:!0})}catch(s){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}i.initPrimitiveShader(),i.initDefaultShader(),i.initDefaultStripShader(),i.activateDefaultShader();var u=this.gl;i.WebGLRenderer.gl=u,this.batch=new i.WebGLBatch(u),u.disable(u.DEPTH_TEST),u.disable(u.CULL_FACE),u.enable(u.BLEND),u.colorMask(!0,!0,!0,this.transparent),i.projection=new i.Point(400,300),this.resize(this.width,this.height),this.contextLost=!1,this.stageRenderGroup=new i.WebGLRenderGroup(this.gl)},i.WebGLRenderer.prototype.constructor=i.WebGLRenderer,i.WebGLRenderer.getBatch=function(){return 0==i._batchs.length?new i.WebGLBatch(i.WebGLRenderer.gl):i._batchs.pop()},i.WebGLRenderer.returnBatch=function(e){e.clean(),i._batchs.push(e)},i.WebGLRenderer.prototype.render=function(e){if(!this.contextLost){this.__stage!==e&&(this.__stage=e,this.stageRenderGroup.setRenderable(e)),i.WebGLRenderer.updateTextures(),i.visibleCount++,e.updateTransform();var t=this.gl;if(t.colorMask(!0,!0,!0,this.transparent),t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],!this.transparent),t.clear(t.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=e.backgroundColorSplit,this.stageRenderGroup.render(i.projection),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0){for(var n=0;n<i.Texture.frameUpdates.length;n++)i.Texture.frameUpdates[n].updateFrame=!1;i.Texture.frameUpdates=[]}}},i.WebGLRenderer.updateTextures=function(){for(var e=0;e<i.texturesToUpdate.length;e++)i.WebGLRenderer.updateTexture(i.texturesToUpdate[e]);for(var e=0;e<i.texturesToDestroy.length;e++)i.WebGLRenderer.destroyTexture(i.texturesToDestroy[e]);i.texturesToUpdate=[],i.texturesToDestroy=[]},i.WebGLRenderer.updateTexture=function(e){var t=i.gl;e._glTexture||(e._glTexture=t.createTexture()),e.hasLoaded&&(t.bindTexture(t.TEXTURE_2D,e._glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e._powerOf2?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindTexture(t.TEXTURE_2D,null))},i.WebGLRenderer.destroyTexture=function(e){var t=i.gl;e._glTexture&&(e._glTexture=t.createTexture(),t.deleteTexture(t.TEXTURE_2D,e._glTexture))},i.WebGLRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),i.projection.x=this.width/2,i.projection.y=this.height/2},i.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},i.WebGLRenderer.prototype.handleContextRestored=function(){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var e in i.TextureCache){var t=i.TextureCache[e].baseTexture;t._glTexture=null,i.WebGLRenderer.updateTexture(t)}for(var n=0;n<this.batchs.length;n++)this.batchs[n].restoreLostContext(this.gl),this.batchs[n].dirty=!0;i._restoreBatchs(this.gl),this.contextLost=!1},i._batchs=[],i._getBatch=function(e){return 0==i._batchs.length?new i.WebGLBatch(e):i._batchs.pop()},i._returnBatch=function(e){e.clean(),i._batchs.push(e)},i._restoreBatchs=function(e){for(var t=0;t<i._batchs.length;t++)i._batchs[t].restoreLostContext(e)},i.WebGLBatch=function(e){this.gl=e,this.size=0,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.blendMode=i.blendModes.NORMAL,this.dynamicSize=1},i.WebGLBatch.prototype.constructor=i.WebGLBatch,i.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},i.WebGLBatch.prototype.restoreLostContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer()},i.WebGLBatch.prototype.init=function(e){e.batch=this,this.dirty=!0,this.blendMode=e.blendMode,this.texture=e.texture.baseTexture,this.head=e,this.tail=e,this.size=1,this.growBatch()},i.WebGLBatch.prototype.insertBefore=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__prev;t.__prev=e,e.__next=t,n?(e.__prev=n,n.__next=e):this.head=e},i.WebGLBatch.prototype.insertAfter=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__next;
t.__next=e,e.__prev=t,n?(e.__next=n,n.__prev=e):this.tail=e},i.WebGLBatch.prototype.remove=function(e){return this.size--,0==this.size?(e.batch=null,e.__prev=null,e.__next=null,void 0):(e.__prev?e.__prev.__next=e.__next:(this.head=e.__next,this.head.__prev=null),e.__next?e.__next.__prev=e.__prev:(this.tail=e.__prev,this.tail.__next=null),e.batch=null,e.__next=null,e.__prev=null,this.dirty=!0,void 0)},i.WebGLBatch.prototype.split=function(e){this.dirty=!0;var t=new i.WebGLBatch(this.gl);t.init(e),t.texture=this.texture,t.tail=this.tail,this.tail=e.__prev,this.tail.__next=null,e.__prev=null;for(var n=0;e;)n++,e.batch=t,e=e.__next;return t.size=n,this.size-=n,t},i.WebGLBatch.prototype.merge=function(e){this.dirty=!0,this.tail.__next=e.head,e.head.__prev=this.tail,this.size+=e.size,this.tail=e.tail;for(var t=e.head;t;)t.batch=this,t=t.__next},i.WebGLBatch.prototype.growBatch=function(){var e=this.gl;this.dynamicSize=1==this.size?1:1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.verticies,e.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var t=this.indices.length/6,n=0;t>n;n++){var r=6*n,i=4*n;this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},i.WebGLBatch.prototype.refresh=function(){this.gl;this.dynamicSize<this.size&&this.growBatch();for(var e,t=0,n=this.head;n;){e=8*t;var r=n.texture,i=r.frame,o=r.baseTexture.width,a=r.baseTexture.height;this.uvs[e+0]=i.x/o,this.uvs[e+1]=i.y/a,this.uvs[e+2]=(i.x+i.width)/o,this.uvs[e+3]=i.y/a,this.uvs[e+4]=(i.x+i.width)/o,this.uvs[e+5]=(i.y+i.height)/a,this.uvs[e+6]=i.x/o,this.uvs[e+7]=(i.y+i.height)/a,n.updateFrame=!1,colorIndex=4*t,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=n.worldAlpha,n=n.__next,t++}this.dirtyUVS=!0,this.dirtyColors=!0},i.WebGLBatch.prototype.update=function(){for(var e,t,n,r,o,a,s,u,l,c,h,f,d,p,g,m,v=(this.gl,0),y=this.head;y;){if(y.vcount===i.visibleCount){if(t=y.texture.frame.width,n=y.texture.frame.height,r=y.anchor.x,o=y.anchor.y,a=t*(1-r),s=t*-r,u=n*(1-o),l=n*-o,c=8*v,e=y.worldTransform,h=e[0],f=e[3],d=e[1],p=e[4],g=e[2],m=e[5],this.verticies[c+0]=h*s+d*l+g,this.verticies[c+1]=p*l+f*s+m,this.verticies[c+2]=h*a+d*l+g,this.verticies[c+3]=p*l+f*a+m,this.verticies[c+4]=h*a+d*u+g,this.verticies[c+5]=p*u+f*a+m,this.verticies[c+6]=h*s+d*u+g,this.verticies[c+7]=p*u+f*s+m,y.updateFrame||y.texture.updateFrame){this.dirtyUVS=!0;var b=y.texture,_=b.frame,x=b.baseTexture.width,w=b.baseTexture.height;this.uvs[c+0]=_.x/x,this.uvs[c+1]=_.y/w,this.uvs[c+2]=(_.x+_.width)/x,this.uvs[c+3]=_.y/w,this.uvs[c+4]=(_.x+_.width)/x,this.uvs[c+5]=(_.y+_.height)/w,this.uvs[c+6]=_.x/x,this.uvs[c+7]=(_.y+_.height)/w,y.updateFrame=!1}if(y.cacheAlpha!=y.worldAlpha){y.cacheAlpha=y.worldAlpha;var T=4*v;this.colors[T]=this.colors[T+1]=this.colors[T+2]=this.colors[T+3]=y.worldAlpha,this.dirtyColors=!0}}else c=8*v,this.verticies[c+0]=0,this.verticies[c+1]=0,this.verticies[c+2]=0,this.verticies[c+3]=0,this.verticies[c+4]=0,this.verticies[c+5]=0,this.verticies[c+6]=0,this.verticies[c+7]=0;v++,y=y.__next}},i.WebGLBatch.prototype.render=function(e,t){if(e=e||0,void 0==t&&(t=this.size),this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var n=this.gl,r=i.shaderProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.uvs)),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.colors)),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var o=t-e;n.drawElements(n.TRIANGLES,6*o,n.UNSIGNED_SHORT,2*e*6)}},i.WebGLRenderGroup=function(e){this.gl=e,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},i.WebGLRenderGroup.prototype.constructor=i.WebGLRenderGroup,i.WebGLRenderGroup.prototype.setRenderable=function(e){this.root&&this.removeDisplayObjectAndChildren(this.root),e.worldVisible=e.visible,this.root=e,this.addDisplayObjectAndChildren(e)},i.WebGLRenderGroup.prototype.render=function(e){i.WebGLRenderer.updateTextures();var t=this.gl;t.uniform2f(i.shaderProgram.projectionVector,e.x,e.y),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);for(var n,r=0;r<this.batchs.length;r++)if(n=this.batchs[r],n instanceof i.WebGLBatch)this.batchs[r].render();else{var o=n.vcount===i.visibleCount;n instanceof i.TilingSprite?o&&this.renderTilingSprite(n,e):n instanceof i.Strip?o&&this.renderStrip(n,e):n instanceof i.Graphics?o&&n.renderable&&i.WebGLGraphics.renderGraphics(n,e):n instanceof i.FilterBlock&&(n.open?(t.enable(t.STENCIL_TEST),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),i.WebGLGraphics.renderGraphics(n.mask,e),t.colorMask(!0,!0,!0,!1),t.stencilFunc(t.NOTEQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)):t.disable(t.STENCIL_TEST))}},i.WebGLRenderGroup.prototype.handleFilter=function(){},i.WebGLRenderGroup.prototype.renderSpecific=function(e,t){i.WebGLRenderer.updateTextures();var n=this.gl;n.uniform2f(i.shaderProgram.projectionVector,t.x,t.y);for(var r,o,a,s,u=e.first;u._iNext&&(u=u._iNext,!u.renderable||!u.__renderGroup););var l=u.batch;if(u instanceof i.Sprite){l=u.batch;var c=l.head;if(c==u)r=0;else for(r=1;c.__next!=u;)r++,c=c.__next}else l=u;for(var h,f=e,d=e;d.children.length>0;)d=d.children[d.children.length-1],d.renderable&&(f=d);if(f instanceof i.Sprite){h=f.batch;var c=h.head;if(c==f)a=0;else for(a=1;c.__next!=f;)a++,c=c.__next}else h=f;if(l==h)return l instanceof i.WebGLBatch?l.render(r,a+1):this.renderSpecial(l,t),void 0;o=this.batchs.indexOf(l),s=this.batchs.indexOf(h),l instanceof i.WebGLBatch?l.render(r):this.renderSpecial(l,t);for(var p=o+1;s>p;p++)renderable=this.batchs[p],renderable instanceof i.WebGLBatch?this.batchs[p].render():this.renderSpecial(renderable,t);h instanceof i.WebGLBatch?h.render(0,a+1):this.renderSpecial(h,t)},i.WebGLRenderGroup.prototype.renderSpecial=function(e,t){var n=e.vcount===i.visibleCount;if(e instanceof i.TilingSprite)n&&this.renderTilingSprite(e,t);else if(e instanceof i.Strip)n&&this.renderStrip(e,t);else if(e instanceof i.CustomRenderable)n&&e.renderWebGL(this,t);else if(e instanceof i.Graphics)n&&e.renderable&&i.WebGLGraphics.renderGraphics(e,t);else if(e instanceof i.FilterBlock){var r=i.gl;e.open?(r.enable(r.STENCIL_TEST),r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,1,255),r.stencilOp(r.KEEP,r.KEEP,r.REPLACE),i.WebGLGraphics.renderGraphics(e.mask,t),r.colorMask(!0,!0,!0,!0),r.stencilFunc(r.NOTEQUAL,0,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)):r.disable(r.STENCIL_TEST)}},i.WebGLRenderGroup.prototype.updateTexture=function(e){this.removeObject(e);for(var t=e.first;t!=this.root&&(t=t._iPrev,!t.renderable||!t.__renderGroup););for(var n=e.last;n._iNext&&(n=n._iNext,!n.renderable||!n.__renderGroup););this.insertObject(e,t,n)},i.WebGLRenderGroup.prototype.addFilterBlocks=function(e,t){e.__renderGroup=this,t.__renderGroup=this;for(var n=e;n!=this.root&&(n=n._iPrev,!n.renderable||!n.__renderGroup););this.insertAfter(e,n);for(var r=t;r!=this.root&&(r=r._iPrev,!r.renderable||!r.__renderGroup););this.insertAfter(t,r)},i.WebGLRenderGroup.prototype.removeFilterBlocks=function(e,t){this.removeObject(e),this.removeObject(t)},i.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(e){e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e);for(var t=e.first;t!=this.root.first&&(t=t._iPrev,!t.renderable||!t.__renderGroup););for(var n=e.last;n._iNext&&(n=n._iNext,!n.renderable||!n.__renderGroup););var r=e.first,i=e.last._iNext;do r.__renderGroup=this,r.renderable&&(this.insertObject(r,t,n),t=r),r=r._iNext;while(r!=i)},i.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(e){if(e.__renderGroup==this){{e.last}do e.__renderGroup=null,e.renderable&&this.removeObject(e),e=e._iNext;while(e)}},i.WebGLRenderGroup.prototype.insertObject=function(e,t,n){var r=t,o=n;if(e instanceof i.Sprite){var a,s;if(r instanceof i.Sprite){if(a=r.batch,a&&a.texture==e.texture.baseTexture&&a.blendMode==e.blendMode)return a.insertAfter(e,r),void 0}else a=r;if(o)if(o instanceof i.Sprite){if(s=o.batch){if(s.texture==e.texture.baseTexture&&s.blendMode==e.blendMode)return s.insertBefore(e,o),void 0;if(s==a){var u=a.split(o),l=i.WebGLRenderer.getBatch(),c=this.batchs.indexOf(a);return l.init(e),this.batchs.splice(c+1,0,l,u),void 0}}}else s=o;var l=i.WebGLRenderer.getBatch();if(l.init(e),a){var c=this.batchs.indexOf(a);this.batchs.splice(c+1,0,l)}else this.batchs.push(l)}else e instanceof i.TilingSprite?this.initTilingSprite(e):e instanceof i.Strip&&this.initStrip(e),this.insertAfter(e,r)},i.WebGLRenderGroup.prototype.insertAfter=function(e,t){if(t instanceof i.Sprite){var n=t.batch;if(n)if(n.tail==t){var r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e)}else{var o=n.split(t.__next),r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e,o)}else this.batchs.push(e)}else{var r=this.batchs.indexOf(t);this.batchs.splice(r+1,0,e)}},i.WebGLRenderGroup.prototype.removeObject=function(e){var t;if(e instanceof i.Sprite){var n=e.batch;if(!n)return;n.remove(e),0==n.size&&(t=n)}else t=e;if(t){var r=this.batchs.indexOf(t);if(-1==r)return;if(0==r||r==this.batchs.length-1)return this.batchs.splice(r,1),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t),void 0;if(this.batchs[r-1]instanceof i.WebGLBatch&&this.batchs[r+1]instanceof i.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode)return this.batchs[r-1].merge(this.batchs[r+1]),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t),i.WebGLRenderer.returnBatch(this.batchs[r+1]),this.batchs.splice(r,2),void 0;this.batchs.splice(r,1),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t)}},i.WebGLRenderGroup.prototype.initTilingSprite=function(e){var t=this.gl;e.verticies=new Float32Array([0,0,e.width,0,e.width,e.height,0,e.height]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.colors=new Float32Array([1,1,1,1]),e.indices=new Uint16Array([0,1,3,2]),e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW),e.texture.baseTexture._glTexture?(t.bindTexture(t.TEXTURE_2D,e.texture.baseTexture._glTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),e.texture.baseTexture._powerOf2=!0):e.texture.baseTexture._powerOf2=!0},i.WebGLRenderGroup.prototype.renderStrip=function(e,t){var n=this.gl,r=i.shaderProgram;n.useProgram(i.stripShaderProgram);var o=i.mat3.clone(e.worldTransform);i.mat3.transpose(o),n.uniformMatrix3fv(i.stripShaderProgram.translationMatrix,!1,o),n.uniform2f(i.stripShaderProgram.projectionVector,t.x,t.y),n.uniform1f(i.stripShaderProgram.alpha,e.worldAlpha),e.dirty?(e.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,e.verticies,n.STATIC_DRAW),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferData(n.ARRAY_BUFFER,e.uvs,n.STATIC_DRAW),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.bufferData(n.ARRAY_BUFFER,e.colors,n.STATIC_DRAW),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),n.useProgram(i.shaderProgram)},i.WebGLRenderGroup.prototype.renderTilingSprite=function(e,t){var n=this.gl,r=(i.shaderProgram,e.tilePosition),o=e.tileScale,a=r.x/e.texture.baseTexture.width,s=r.y/e.texture.baseTexture.height,u=e.width/e.texture.baseTexture.width/o.x,l=e.height/e.texture.baseTexture.height/o.y;e.uvs[0]=0-a,e.uvs[1]=0-s,e.uvs[2]=1*u-a,e.uvs[3]=0-s,e.uvs[4]=1*u-a,e.uvs[5]=1*l-s,e.uvs[6]=0-a,e.uvs[7]=1*l-s,n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.uvs),this.renderStrip(e,t)},i.WebGLRenderGroup.prototype.initStrip=function(e){{var t=this.gl;this.shaderProgram}e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW)},i.CanvasRenderer=function(e,t,n,r){this.transparent=r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0},i.CanvasRenderer.prototype.constructor=i.CanvasRenderer,i.CanvasRenderer.prototype.render=function(e){i.texturesToUpdate=[],i.texturesToDestroy=[],i.visibleCount++,e.updateTransform(),this.view.style.backgroundColor==e.backgroundColorString||this.transparent||(this.view.style.backgroundColor=e.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0&&(i.Texture.frameUpdates=[])},i.CanvasRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t},i.CanvasRenderer.prototype.renderDisplayObject=function(e){var t,n=this.context;n.globalCompositeOperation="source-over";var r=e.last._iNext;e=e.first;do if(t=e.worldTransform,e.visible)if(e.renderable){if(e instanceof i.Sprite){var o=e.texture.frame;o&&(n.globalAlpha=e.worldAlpha,n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),n.drawImage(e.texture.baseTexture.source,o.x,o.y,o.width,o.height,e.anchor.x*-o.width,e.anchor.y*-o.height,o.width,o.height))}else if(e instanceof i.Strip)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderStrip(e);else if(e instanceof i.TilingSprite)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderTilingSprite(e);else if(e instanceof i.CustomRenderable)e.renderCanvas(this);else if(e instanceof i.Graphics)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),i.CanvasGraphics.renderGraphics(e,n);else if(e instanceof i.FilterBlock)if(e.open){n.save();var a=e.mask.alpha,s=e.mask.worldTransform;n.setTransform(s[0],s[3],s[1],s[4],s[2],s[5]),e.mask.worldAlpha=.5,n.worldAlpha=0,i.CanvasGraphics.renderGraphicsMask(e.mask,n),n.clip(),e.mask.worldAlpha=a}else n.restore();e=e._iNext}else e=e._iNext;else e=e.last._iNext;while(e!=r)},i.CanvasRenderer.prototype.renderStripFlat=function(e){var t=this.context,n=e.verticies,r=(e.uvs,n.length/2);this.count++,t.beginPath();for(var i=1;r-2>i;i++){var o=2*i,a=n[o],s=n[o+2],u=n[o+4],l=n[o+1],c=n[o+3],h=n[o+5];t.moveTo(a,l),t.lineTo(s,c),t.lineTo(u,h)}t.fillStyle="#FF0000",t.fill(),t.closePath()},i.CanvasRenderer.prototype.renderTilingSprite=function(e){var t=this.context;t.globalAlpha=e.worldAlpha,e.__tilePattern||(e.__tilePattern=t.createPattern(e.texture.baseTexture.source,"repeat")),t.beginPath();var n=e.tilePosition,r=e.tileScale;t.scale(r.x,r.y),t.translate(n.x,n.y),t.fillStyle=e.__tilePattern,t.fillRect(-n.x,-n.y,e.width/r.x,e.height/r.y),t.scale(1/r.x,1/r.y),t.translate(-n.x,-n.y),t.closePath()},i.CanvasRenderer.prototype.renderStrip=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++;for(var o=1;i-2>o;o++){var a=2*o,s=n[a],u=n[a+2],l=n[a+4],c=n[a+1],h=n[a+3],f=n[a+5],d=r[a]*e.texture.width,p=r[a+2]*e.texture.width,g=r[a+4]*e.texture.width,m=r[a+1]*e.texture.height,v=r[a+3]*e.texture.height,y=r[a+5]*e.texture.height;t.save(),t.beginPath(),t.moveTo(s,c),t.lineTo(u,h),t.lineTo(l,f),t.closePath(),t.clip();var b=d*v+m*g+p*y-v*g-m*p-d*y,_=s*v+m*l+u*y-v*l-m*u-s*y,x=d*u+s*g+p*l-u*g-s*p-d*l,w=d*v*l+m*u*g+s*p*y-s*v*g-m*p*l-d*u*y,T=c*v+m*f+h*y-v*f-m*h-c*y,A=d*h+c*g+p*f-h*g-c*p-d*f,E=d*v*f+m*h*g+c*p*y-c*v*g-m*p*f-d*h*y;t.transform(_/b,T/b,x/b,A/b,w/b,E/b),t.drawImage(e.texture.baseTexture.source,0,0),t.restore()}},i.CanvasGraphics=function(){},i.CanvasGraphics.renderGraphics=function(e,t){for(var n=e.worldAlpha,r=0;r<e.graphicsData.length;r++){var o=e.graphicsData[r],a=o.points;if(t.strokeStyle=color="#"+("00000"+(0|o.lineColor).toString(16)).substr(-6),t.lineWidth=o.lineWidth,o.type===i.Graphics.POLY){t.beginPath(),t.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)t.lineTo(a[2*s],a[2*s+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke())}else if(o.type===i.Graphics.RECT)void 0!=o.fillColor&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fillRect(a[0],a[1],a[2],a[3])),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeRect(a[0],a[1],a[2],a[3]));else if(o.type==i.Graphics.CIRC)t.beginPath(),t.arc(a[0],a[1],a[2],0,2*Math.PI),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke());else if(o.type==i.Graphics.ELIP){var u=o.points,l=2*u[2],c=2*u[3],h=u[0]-l/2,f=u[1]-c/2;t.beginPath();var d=.5522848,p=l/2*d,g=c/2*d,m=h+l,v=f+c,y=h+l/2,b=f+c/2;t.moveTo(h,b),t.bezierCurveTo(h,b-g,y-p,f,y,f),t.bezierCurveTo(y+p,f,m,b-g,m,b),t.bezierCurveTo(m,b+g,y+p,v,y,v),t.bezierCurveTo(y-p,v,h,b+g,h,b),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke())}}},i.CanvasGraphics.renderGraphicsMask=function(e,t){var n=(e.worldAlpha,e.graphicsData.length);n>1&&(n=1,console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;1>r;r++){var o=e.graphicsData[r],a=o.points;if(o.type==i.Graphics.POLY){t.beginPath(),t.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)t.lineTo(a[2*s],a[2*s+1]);a[0]==a[a.length-2]&&a[1]==a[a.length-1]&&t.closePath()}else if(o.type==i.Graphics.RECT)t.beginPath(),t.rect(a[0],a[1],a[2],a[3]),t.closePath();else if(o.type==i.Graphics.CIRC)t.beginPath(),t.arc(a[0],a[1],a[2],0,2*Math.PI),t.closePath();else if(o.type==i.Graphics.ELIP){var u=o.points,l=2*u[2],c=2*u[3],h=u[0]-l/2,f=u[1]-c/2;t.beginPath();var d=.5522848,p=l/2*d,g=c/2*d,m=h+l,v=f+c,y=h+l/2,b=f+c/2;t.moveTo(h,b),t.bezierCurveTo(h,b-g,y-p,f,y,f),t.bezierCurveTo(y+p,f,m,b-g,m,b),t.bezierCurveTo(m,b+g,y+p,v,y,v),t.bezierCurveTo(y-p,v,h,b+g,h,b),t.closePath()}}},i.Graphics=function(){i.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.currentPath={points:[]}},i.Graphics.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Graphics.prototype.constructor=i.Graphics,i.Graphics.prototype.lineStyle=function(e,t,n){0==this.currentPath.points.length&&this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=void 0==n?1:n,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:i.Graphics.POLY},this.graphicsData.push(this.currentPath)},i.Graphics.prototype.moveTo=function(e,t){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:i.Graphics.POLY},this.currentPath.points.push(e,t),this.graphicsData.push(this.currentPath)},i.Graphics.prototype.lineTo=function(e,t){this.currentPath.points.push(e,t),this.dirty=!0},i.Graphics.prototype.beginFill=function(e,t){this.filling=!0,this.fillColor=e||0,this.fillAlpha=void 0==t?1:t},i.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},i.Graphics.prototype.drawRect=function(e,t,n,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:i.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.drawCircle=function(e,t,n){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,n],type:i.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.drawElipse=function(e,t,n,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:i.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[]},i.Graphics.POLY=0,i.Graphics.RECT=1,i.Graphics.CIRC=2,i.Graphics.ELIP=3,i.Strip=function(e,t,n){i.DisplayObjectContainer.call(this),this.texture=e,this.blendMode=i.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(r){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=t,this.height=n,e.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Strip.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Strip.prototype.constructor=i.Strip,i.Strip.prototype.setTexture=function(e){this.texture=e,this.width=e.frame.width,this.height=e.frame.height,this.updateFrame=!0},i.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Rope=function(e,t){i.Strip.call(this,e),this.points=t;try{this.verticies=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length)}catch(n){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},i.Rope.prototype=Object.create(i.Strip.prototype),i.Rope.prototype.constructor=i.Rope,i.Rope.prototype.refresh=function(){var e=this.points;if(!(e.length<1)){var t=this.uvs,n=this.indices,r=this.colors,i=e[0],o=e[0];this.count-=.2,t[0]=0,t[1]=1,t[2]=0,t[3]=1,r[0]=1,r[1]=1,n[0]=0,n[1]=1;for(var a=e.length,s=1;a>s;s++){var o=e[s],u=4*s,l=s/(a-1);s%2?(t[u]=l,t[u+1]=0,t[u+2]=l,t[u+3]=1):(t[u]=l,t[u+1]=0,t[u+2]=l,t[u+3]=1),u=2*s,r[u]=1,r[u+1]=1,u=2*s,n[u]=u,n[u+1]=u+1,i=o}}},i.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var t,n=this.verticies,r=e[0],o={x:0,y:0},a=e[0];this.count-=.2,n[0]=a.x+o.x,n[1]=a.y+o.y,n[2]=a.x-o.x,n[3]=a.y-o.y;for(var s=e.length,u=1;s>u;u++){var a=e[u],l=4*u;t=u<e.length-1?e[u+1]:a,o.y=-(t.x-r.x),o.x=t.y-r.y;var c=10*(1-u/(s-1));c>1&&(c=1);var h=Math.sqrt(o.x*o.x+o.y*o.y),f=this.texture.height/2;o.x/=h,o.y/=h,o.x*=f,o.y*=f,n[l]=a.x+o.x,n[l+1]=a.y+o.y,n[l+2]=a.x-o.x,n[l+3]=a.y-o.y,r=a}i.DisplayObjectContainer.prototype.updateTransform.call(this)}},i.Rope.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},i.TilingSprite=function(e,t,n){i.DisplayObjectContainer.call(this),this.texture=e,this.width=t,this.height=n,this.tileScale=new i.Point(1,1),this.tilePosition=new i.Point(0,0),this.renderable=!0,this.blendMode=i.blendModes.NORMAL},i.TilingSprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.TilingSprite.prototype.constructor=i.TilingSprite,i.TilingSprite.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},i.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Spine=function(e){if(i.DisplayObjectContainer.call(this),this.spineData=i.AnimCache[e],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+e);this.skeleton=new c.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new c.AnimationStateData(this.spineData),this.state=new c.AnimationState(this.stateData),this.slotContainers=[];for(var t=0,n=this.skeleton.drawOrder.length;n>t;t++){var r=this.skeleton.drawOrder[t],o=r.attachment,a=new i.DisplayObjectContainer;if(this.slotContainers.push(a),this.addChild(a),o instanceof c.RegionAttachment){var s=o.rendererObject.name,u=this.createSprite(r,o.rendererObject);r.currentSprite=u,r.currentSpriteName=s,a.addChild(u)}}},i.Spine.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Spine.prototype.constructor=i.Spine,i.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var t=this.skeleton.drawOrder,n=0,r=t.length;r>n;n++){var o=t[n],a=o.attachment,s=this.slotContainers[n];if(a instanceof c.RegionAttachment){if(a.rendererObject&&(!o.currentSpriteName||o.currentSpriteName!=a.name)){var u=a.rendererObject.name;if(void 0!==o.currentSprite&&(o.currentSprite.visible=!1),o.sprites=o.sprites||{},void 0!==o.sprites[u])o.sprites[u].visible=!0;else{var l=this.createSprite(o,a.rendererObject);s.addChild(l)}o.currentSprite=o.sprites[u],o.currentSpriteName=u}s.visible=!0;var h=o.bone;s.position.x=h.worldX+a.x*h.m00+a.y*h.m01,s.position.y=h.worldY+a.x*h.m10+a.y*h.m11,s.scale.x=h.worldScaleX,s.scale.y=h.worldScaleY,s.rotation=-(o.bone.worldRotation*Math.PI/180)}else s.visible=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.Spine.prototype.createSprite=function(e,t){var n=i.TextureCache[t.name]?t.name:t.name+".png",r=new i.Sprite(i.Texture.fromFrame(n));return r.scale=t.scale,r.rotation=t.rotation,r.anchor.x=r.anchor.y=.5,e.sprites=e.sprites||{},e.sprites[t.name]=r,r};var c={};c.BoneData=function(e,t){this.name=e,this.parent=t},c.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},c.SlotData=function(e,t){this.name=e,this.boneData=t},c.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},c.Bone=function(e,t){this.data=e,this.parent=t,this.setToSetupPose()},c.Bone.yDown=!1,c.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,t){var n=this.parent;null!=n?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY,this.worldRotation=n.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var r=this.worldRotation*Math.PI/180,i=Math.cos(r),o=Math.sin(r);this.m00=i*this.worldScaleX,this.m10=o*this.worldScaleX,this.m01=-o*this.worldScaleY,this.m11=i*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),t&&(this.m10=-this.m10,this.m11=-this.m11),c.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY}},c.Slot=function(e,t,n){this.data=e,this.skeleton=t,this.bone=n,this.setToSetupPose()},c.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;for(var t=this.skeleton.data.slots,n=0,r=t.length;r>n;n++)if(t[n]==e){this.setAttachment(e.attachmentName?this.skeleton.getAttachmentBySlotIndex(n,e.attachmentName):null);break}}},c.Skin=function(e){this.name=e,this.attachments={}},c.Skin.prototype={addAttachment:function(e,t,n){this.attachments[e+":"+t]=n},getAttachment:function(e,t){return this.attachments[e+":"+t]},_attachAll:function(e,t){for(var n in t.attachments){var r=n.indexOf(":"),i=parseInt(n.substring(0,r)),o=n.substring(r+1),a=e.slots[i];if(a.attachment&&a.attachment.name==o){var s=this.getAttachment(i,o);s&&a.setAttachment(s)}}}},c.Animation=function(e,t,n){this.name=e,this.timelines=t,this.duration=n},c.Animation.prototype={apply:function(e,t,n){n&&0!=this.duration&&(t%=this.duration);for(var r=this.timelines,i=0,o=r.length;o>i;i++)r[i].apply(e,t,1)},mix:function(e,t,n,r){n&&0!=this.duration&&(t%=this.duration);for(var i=this.timelines,o=0,a=i.length;a>o;o++)i[o].apply(e,t,r)}},c.binarySearch=function(e,t,n){var r=0,i=Math.floor(e.length/n)-2;if(0==i)return n;for(var o=i>>>1;;){if(e[(o+1)*n]<=t?r=o+1:i=o,r==i)return(r+1)*n;o=r+i>>>1}},c.linearSearch=function(e,t,n){for(var r=0,i=e.length-n;i>=r;r+=n)if(e[r]>t)return r;return-1},c.Curves=function(e){this.curves=[],this.curves.length=6*(e-1)},c.Curves.prototype={setLinear:function(e){this.curves[6*e]=0},setStepped:function(e){this.curves[6*e]=-1},setCurve:function(e,t,n,r,i){var o=.1,a=o*o,s=a*o,u=3*o,l=3*a,c=6*a,h=6*s,f=2*-t+r,d=2*-n+i,p=3*(t-r)+1,g=3*(n-i)+1,m=6*e,v=this.curves;v[m]=t*u+f*l+p*s,v[m+1]=n*u+d*l+g*s,v[m+2]=f*c+p*h,v[m+3]=d*c+g*h,v[m+4]=p*h,v[m+5]=g*h},getCurvePercent:function(e,t){t=0>t?0:t>1?1:t;var n=6*e,r=this.curves,i=r[n];if(!i)return t;if(-1==i)return 0;
for(var o=r[n+1],a=r[n+2],s=r[n+3],u=r[n+4],l=r[n+5],c=i,h=o,f=8;;){if(c>=t){var d=c-i,p=h-o;return p+(h-p)*(t-d)/(c-d)}if(0==f)break;f--,i+=a,o+=s,a+=u,s+=l,c+=i,h+=o}return h+(1-h)*(t-c)/(1-c)}},c.RotateTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=2*e},c.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n){e*=2,this.frames[e]=t,this.frames[e+1]=n},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-2]){for(var o=i.data.rotation+r[r.length-1]-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;return i.rotation+=o*n,void 0}var a=c.binarySearch(r,t,2),s=r[a-1],u=r[a],l=1-(t-u)/(r[a-2]-u);l=this.curves.getCurvePercent(a/2-1,l);for(var o=r[a+1]-s;o>180;)o-=360;for(;-180>o;)o+=360;for(o=i.data.rotation+(s+o*l)-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;i.rotation+=o*n}}},c.TranslateTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=3*e},c.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-3])return i.x+=(i.data.x+r[r.length-2]-i.x)*n,i.y+=(i.data.y+r[r.length-1]-i.y)*n,void 0;var o=c.binarySearch(r,t,3),a=r[o-2],s=r[o-1],u=r[o],l=1-(t-u)/(r[o+-3]-u);l=this.curves.getCurvePercent(o/3-1,l),i.x+=(i.data.x+a+(r[o+1]-a)*l-i.x)*n,i.y+=(i.data.y+s+(r[o+2]-s)*l-i.y)*n}}},c.ScaleTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=3*e},c.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-3])return i.scaleX+=(i.data.scaleX-1+r[r.length-2]-i.scaleX)*n,i.scaleY+=(i.data.scaleY-1+r[r.length-1]-i.scaleY)*n,void 0;var o=c.binarySearch(r,t,3),a=r[o-2],s=r[o-1],u=r[o],l=1-(t-u)/(r[o+-3]-u);l=this.curves.getCurvePercent(o/3-1,l),i.scaleX+=(i.data.scaleX-1+a+(r[o+1]-a)*l-i.scaleX)*n,i.scaleY+=(i.data.scaleY-1+s+(r[o+2]-s)*l-i.scaleY)*n}}},c.ColorTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=5*e},c.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t){e*=5,this.frames[e]=t,this.frames[e+1]=r,this.frames[e+2]=g,this.frames[e+3]=b,this.frames[e+4]=a},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.slots[this.slotIndex];if(t>=r[r.length-5]){var o=r.length-1;return i.r=r[o-3],i.g=r[o-2],i.b=r[o-1],i.a=r[o],void 0}var a=c.binarySearch(r,t,5),s=r[a-4],u=r[a-3],l=r[a-2],h=r[a-1],f=r[a],d=1-(t-f)/(r[a-5]-f);d=this.curves.getCurvePercent(a/5-1,d);var p=s+(r[a+1]-s)*d,g=u+(r[a+2]-u)*d,m=l+(r[a+3]-l)*d,v=h+(r[a+4]-h)*d;1>n?(i.r+=(p-i.r)*n,i.g+=(g-i.g)*n,i.b+=(m-i.b)*n,i.a+=(v-i.a)*n):(i.r=p,i.g=g,i.b=m,i.a=v)}}},c.AttachmentTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e},c.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(e,t,n){this.frames[e]=t,this.attachmentNames[e]=n},apply:function(e,t){var n=this.frames;if(!(t<n[0])){var r;r=t>=n[n.length-1]?n.length-1:c.binarySearch(n,t,1)-1;var i=this.attachmentNames[r];e.slots[this.slotIndex].setAttachment(i?e.getAttachmentBySlotIndex(this.slotIndex,i):null)}}},c.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},c.SkeletonData.prototype={defaultSkin:null,findBone:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},findBoneIndex:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].name==e)return n;return-1},findSlot:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].name==e)return slot[n];return null},findSlotIndex:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].name==e)return n;return-1},findSkin:function(e){for(var t=this.skins,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},findAnimation:function(e){for(var t=this.animations,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null}},c.Skeleton=function(e){this.data=e,this.bones=[];for(var t=0,n=e.bones.length;n>t;t++){var r=e.bones[t],i=r.parent?this.bones[e.bones.indexOf(r.parent)]:null;this.bones.push(new c.Bone(r,i))}this.slots=[],this.drawOrder=[];for(var t=0,n=e.slots.length;n>t;t++){var o=e.slots[t],a=this.bones[e.bones.indexOf(o.boneData)],s=new c.Slot(o,this,a);this.slots.push(s),this.drawOrder.push(s)}},c.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var e=this.flipX,t=this.flipY,n=this.bones,r=0,i=n.length;i>r;r++)n[r].updateWorldTransform(e,t)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var e=this.bones,t=0,n=e.length;n>t;t++)e[t].setToSetupPose()},setSlotsToSetupPose:function(){for(var e=this.slots,t=0,n=e.length;n>t;t++)e[t].setToSetupPose(t)},getRootBone:function(){return 0==this.bones.length?null:this.bones[0]},findBone:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return t[n];return null},findBoneIndex:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return n;return-1},findSlot:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return t[n];return null},findSlotIndex:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return n;return-1},setSkinByName:function(e){var t=this.data.findSkin(e);if(!t)throw"Skin not found: "+e;this.setSkin(t)},setSkin:function(e){this.skin&&e&&e._attachAll(this,this.skin),this.skin=e},getAttachmentBySlotName:function(e,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),t)},getAttachmentBySlotIndex:function(e,t){if(this.skin){var n=this.skin.getAttachment(e,t);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null},setAttachment:function(e,t){for(var n=this.slots,r=0,i=n.size;i>r;r++){var o=n[r];if(o.data.name==e){var a=null;if(t&&(a=this.getAttachment(r,t),null==a))throw"Attachment not found: "+t+", for slot: "+e;return o.setAttachment(a),void 0}}throw"Slot not found: "+e},update:function(e){time+=e}},c.AttachmentType={region:0},c.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},c.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,t,n,r,i){var o=this.uvs;i?(o[2]=e,o[3]=r,o[4]=e,o[5]=t,o[6]=n,o[7]=t,o[0]=n,o[1]=r):(o[0]=e,o[1]=r,o[2]=e,o[3]=t,o[4]=n,o[5]=t,o[6]=n,o[7]=r)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,t=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*e,r=-this.height/2*this.scaleY+this.regionOffsetY*t,i=n+this.regionWidth*e,o=r+this.regionHeight*t,a=this.rotation*Math.PI/180,s=Math.cos(a),u=Math.sin(a),l=n*s+this.x,c=n*u,h=r*s+this.y,f=r*u,d=i*s+this.x,p=i*u,g=o*s+this.y,m=o*u,v=this.offset;v[0]=l-f,v[1]=h+c,v[2]=l-m,v[3]=g+c,v[4]=d-m,v[5]=g+p,v[6]=d-f,v[7]=h+p},computeVertices:function(e,t,n,r){e+=n.worldX,t+=n.worldY;var i=n.m00,o=n.m01,a=n.m10,s=n.m11,u=this.offset;r[0]=u[0]*i+u[1]*o+e,r[1]=u[0]*a+u[1]*s+t,r[2]=u[2]*i+u[3]*o+e,r[3]=u[2]*a+u[3]*s+t,r[4]=u[4]*i+u[5]*o+e,r[5]=u[4]*a+u[5]*s+t,r[6]=u[6]*i+u[7]*o+e,r[7]=u[6]*a+u[7]*s+t}},c.AnimationStateData=function(e){this.skeletonData=e,this.animationToMixTime={}},c.AnimationStateData.prototype={defaultMix:0,setMixByName:function(e,t,n){var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setMix(r,i,n)},setMix:function(e,t,n){this.animationToMixTime[e.name+":"+t.name]=n},getMix:function(e,t){var n=this.animationToMixTime[e.name+":"+t.name];return n?n:this.defaultMix}},c.AnimationState=function(e){this.data=e,this.queue=[]},c.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(e){if(this.currentTime+=e,this.previousTime+=e,this.mixTime+=e,this.queue.length>0){var t=this.queue[0];this.currentTime>=t.delay&&(this._setAnimation(t.animation,t.loop),this.queue.shift())}},apply:function(e){if(this.current)if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;t>=1&&(t=1,this.previous=null),this.current.mix(e,this.currentTime,this.currentLoop,t)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(e,t){this.previous=null,e&&this.current&&(this.mixDuration=this.data.getMix(this.current,e),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=e,this.currentLoop=t,this.currentTime=0},setAnimationByName:function(e,t){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setAnimation(n,t)},setAnimation:function(e,t){this.queue.length=0,this._setAnimation(e,t)},addAnimationByName:function(e,t,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.addAnimation(r,t,n)},addAnimation:function(e,t,n){var r={};if(r.animation=e,r.loop=t,!n||0>=n){var i=0==this.queue.length?this.current:this.queue[this.queue.length-1].animation;n=null!=i?i.duration-this.data.getMix(i,e)+(n||0):0}r.delay=n,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},c.SkeletonJson=function(e){this.attachmentLoader=e},c.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){for(var t=new c.SkeletonData,n=e.bones,r=0,i=n.length;i>r;r++){var o=n[r],a=null;if(o.parent&&(a=t.findBone(o.parent),!a))throw"Parent bone not found: "+o.parent;var s=new c.BoneData(o.name,a);s.length=(o.length||0)*this.scale,s.x=(o.x||0)*this.scale,s.y=(o.y||0)*this.scale,s.rotation=o.rotation||0,s.scaleX=o.scaleX||1,s.scaleY=o.scaleY||1,t.bones.push(s)}for(var u=e.slots,r=0,i=u.length;i>r;r++){var l=u[r],s=t.findBone(l.bone);if(!s)throw"Slot bone not found: "+l.bone;var h=new c.SlotData(l.name,s),f=l.color;f&&(h.r=c.SkeletonJson.toColor(f,0),h.g=c.SkeletonJson.toColor(f,1),h.b=c.SkeletonJson.toColor(f,2),h.a=c.SkeletonJson.toColor(f,3)),h.attachmentName=l.attachment,t.slots.push(h)}var d=e.skins;for(var p in d)if(d.hasOwnProperty(p)){var g=d[p],m=new c.Skin(p);for(var v in g)if(g.hasOwnProperty(v)){var y=t.findSlotIndex(v),b=g[v];for(var _ in b)if(b.hasOwnProperty(_)){var x=this.readAttachment(m,_,b[_]);null!=x&&m.addAttachment(y,_,x)}}t.skins.push(m),"default"==m.name&&(t.defaultSkin=m)}var w=e.animations;for(var T in w)w.hasOwnProperty(T)&&this.readAnimation(T,w[T],t);return t},readAttachment:function(e,t,n){t=n.name||t;var r=c.AttachmentType[n.type||"region"];if(r==c.AttachmentType.region){var i=new c.RegionAttachment;return i.x=(n.x||0)*this.scale,i.y=(n.y||0)*this.scale,i.scaleX=n.scaleX||1,i.scaleY=n.scaleY||1,i.rotation=n.rotation||0,i.width=(n.width||32)*this.scale,i.height=(n.height||32)*this.scale,i.updateOffset(),i.rendererObject={},i.rendererObject.name=t,i.rendererObject.scale={},i.rendererObject.scale.x=i.scaleX,i.rendererObject.scale.y=i.scaleY,i.rendererObject.rotation=-i.rotation*Math.PI/180,i}throw"Unknown attachment type: "+r},readAnimation:function(e,t,n){var r=[],i=0,o=t.bones;for(var a in o)if(o.hasOwnProperty(a)){var s=n.findBoneIndex(a);if(-1==s)throw"Bone not found: "+a;var u=o[a];for(var l in u)if(u.hasOwnProperty(l)){var h=u[l];if("rotate"==l){var f=new c.RotateTimeline(h.length);f.boneIndex=s;for(var d=0,p=0,g=h.length;g>p;p++){var m=h[p];f.setFrame(d,m.time,m.angle),c.SkeletonJson.readCurve(f,d,m),d++}r.push(f),i=Math.max(i,f.frames[2*f.getFrameCount()-2])}else{if("translate"!=l&&"scale"!=l)throw"Invalid timeline type for a bone: "+l+" ("+a+")";var f,v=1;"scale"==l?f=new c.ScaleTimeline(h.length):(f=new c.TranslateTimeline(h.length),v=this.scale),f.boneIndex=s;for(var d=0,p=0,g=h.length;g>p;p++){var m=h[p],y=(m.x||0)*v,b=(m.y||0)*v;f.setFrame(d,m.time,y,b),c.SkeletonJson.readCurve(f,d,m),d++}r.push(f),i=Math.max(i,f.frames[3*f.getFrameCount()-3])}}}var _=t.slots;for(var x in _)if(_.hasOwnProperty(x)){var w=_[x],T=n.findSlotIndex(x);for(var l in w)if(w.hasOwnProperty(l)){var h=w[l];if("color"==l){var f=new c.ColorTimeline(h.length);f.slotIndex=T;for(var d=0,p=0,g=h.length;g>p;p++){var m=h[p],A=m.color,E=c.SkeletonJson.toColor(A,0),S=c.SkeletonJson.toColor(A,1),j=c.SkeletonJson.toColor(A,2),C=c.SkeletonJson.toColor(A,3);f.setFrame(d,m.time,E,S,j,C),c.SkeletonJson.readCurve(f,d,m),d++}r.push(f),i=Math.max(i,f.frames[5*f.getFrameCount()-5])}else{if("attachment"!=l)throw"Invalid timeline type for a slot: "+l+" ("+x+")";var f=new c.AttachmentTimeline(h.length);f.slotIndex=T;for(var d=0,p=0,g=h.length;g>p;p++){var m=h[p];f.setFrame(d++,m.time,m.name)}r.push(f),i=Math.max(i,f.frames[f.getFrameCount()-1])}}}n.animations.push(new c.Animation(e,r,i))}},c.SkeletonJson.readCurve=function(e,t,n){var r=n.curve;r&&("stepped"==r?e.curves.setStepped(t):r instanceof Array&&e.curves.setCurve(t,r[0],r[1],r[2],r[3]))},c.SkeletonJson.toColor=function(e,t){if(8!=e.length)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substring(2*t,2),16)/255},c.Atlas=function(e,t){this.textureLoader=t,this.pages=[],this.regions=[];var n=new c.AtlasReader(e),r=[];r.length=4;for(var i=null;;){var o=n.readLine();if(null==o)break;if(o=n.trim(o),0==o.length)i=null;else if(i){var a=new c.AtlasRegion;a.name=o,a.page=i,a.rotate="true"==n.readValue(),n.readTuple(r);var s=parseInt(r[0]),u=parseInt(r[1]);n.readTuple(r);var l=parseInt(r[0]),h=parseInt(r[1]);a.u=s/i.width,a.v=u/i.height,a.rotate?(a.u2=(s+h)/i.width,a.v2=(u+l)/i.height):(a.u2=(s+l)/i.width,a.v2=(u+h)/i.height),a.x=s,a.y=u,a.width=Math.abs(l),a.height=Math.abs(h),4==n.readTuple(r)&&(a.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==n.readTuple(r)&&(a.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r))),a.originalWidth=parseInt(r[0]),a.originalHeight=parseInt(r[1]),n.readTuple(r),a.offsetX=parseInt(r[0]),a.offsetY=parseInt(r[1]),a.index=parseInt(n.readValue()),this.regions.push(a)}else{i=new c.AtlasPage,i.name=o,i.format=c.Atlas.Format[n.readValue()],n.readTuple(r),i.minFilter=c.Atlas.TextureFilter[r[0]],i.magFilter=c.Atlas.TextureFilter[r[1]];var f=n.readValue();i.uWrap=c.Atlas.TextureWrap.clampToEdge,i.vWrap=c.Atlas.TextureWrap.clampToEdge,"x"==f?i.uWrap=c.Atlas.TextureWrap.repeat:"y"==f?i.vWrap=c.Atlas.TextureWrap.repeat:"xy"==f&&(i.uWrap=i.vWrap=c.Atlas.TextureWrap.repeat),t.load(i,o),this.pages.push(i)}}},c.Atlas.prototype={findRegion:function(e){for(var t=this.regions,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},dispose:function(){for(var e=this.pages,t=0,n=e.length;n>t;t++)this.textureLoader.unload(e[t].rendererObject)},updateUVs:function(e){for(var t=this.regions,n=0,r=t.length;r>n;n++){var i=t[n];i.page==e&&(i.u=i.x/e.width,i.v=i.y/e.height,i.rotate?(i.u2=(i.x+i.height)/e.width,i.v2=(i.y+i.width)/e.height):(i.u2=(i.x+i.width)/e.width,i.v2=(i.y+i.height)/e.height))}}},c.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},c.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},c.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},c.AtlasPage=function(){},c.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},c.AtlasRegion=function(){},c.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},c.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)},c.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var e=this.readLine(),t=e.indexOf(":");if(-1==t)throw"Invalid line: "+e;return this.trim(e.substring(t+1))},readTuple:function(e){var t=this.readLine(),n=t.indexOf(":");if(-1==n)throw"Invalid line: "+t;for(var r=0,i=n+1;3>r;r++){var o=t.indexOf(",",i);if(-1==o){if(0==r)throw"Invalid line: "+t;break}e[r]=this.trim(t.substr(i,o-i)),i=o+1}return e[r]=this.trim(t.substring(i)),r+1}},c.AtlasAttachmentLoader=function(e){this.atlas=e},c.AtlasAttachmentLoader.prototype={newAttachment:function(e,t,n){switch(t){case c.AttachmentType.region:var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" ("+t+")";var i=new c.RegionAttachment(n);return i.rendererObject=r,i.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),i.regionOffsetX=r.offsetX,i.regionOffsetY=r.offsetY,i.regionWidth=r.width,i.regionHeight=r.height,i.regionOriginalWidth=r.originalWidth,i.regionOriginalHeight=r.originalHeight,i}throw"Unknown attachment type: "+t}},i.AnimCache={},c.Bone.yDown=!0,i.CustomRenderable=function(){i.DisplayObject.call(this)},i.CustomRenderable.prototype=Object.create(i.DisplayObject.prototype),i.CustomRenderable.prototype.constructor=i.CustomRenderable,i.CustomRenderable.prototype.renderCanvas=function(){},i.CustomRenderable.prototype.initWebGL=function(){},i.CustomRenderable.prototype.renderWebGL=function(){},i.BaseTextureCache={},i.texturesToUpdate=[],i.texturesToDestroy=[],i.BaseTexture=function(e){if(i.EventTarget.call(this),this.width=100,this.height=100,this.hasLoaded=!1,this.source=e,e){if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);else{var t=this;this.source.onload=function(){t.hasLoaded=!0,t.width=t.source.width,t.height=t.source.height,i.texturesToUpdate.push(t),t.dispatchEvent({type:"loaded",content:t})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);this._powerOf2=!1}},i.BaseTexture.prototype.constructor=i.BaseTexture,i.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,i.texturesToDestroy.push(this)},i.BaseTexture.fromImage=function(e,t){var n=i.BaseTextureCache[e];if(!n){var r=new Image;t&&(r.crossOrigin=""),r.src=e,n=new i.BaseTexture(r),i.BaseTextureCache[e]=n}return n},i.TextureCache={},i.FrameCache={},i.Texture=function(e,t){if(i.EventTarget.call(this),t||(this.noFrame=!0,t=new i.Rectangle(0,0,1,1)),e instanceof i.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=t,this.trim=new i.Point,this.scope=this,e.hasLoaded)this.noFrame&&(t=new i.Rectangle(0,0,e.width,e.height)),this.setFrame(t);else{var n=this;e.addEventListener("loaded",function(){n.onBaseTextureLoaded()})}},i.Texture.prototype.constructor=i.Texture,i.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new i.Rectangle(0,0,e.width,e.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},i.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy()},i.Texture.prototype.setFrame=function(e){if(this.frame=e,this.width=e.width,this.height=e.height,e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,i.Texture.frameUpdates.push(this)},i.Texture.fromImage=function(e,t){var n=i.TextureCache[e];return n||(n=new i.Texture(i.BaseTexture.fromImage(e,t)),i.TextureCache[e]=n),n},i.Texture.fromFrame=function(e){var t=i.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache "+this);return t},i.Texture.fromCanvas=function(e){var t=new i.BaseTexture(e);return new i.Texture(t)},i.Texture.addTextureToCache=function(e,t){i.TextureCache[t]=e},i.Texture.removeTextureFromCache=function(e){var t=i.TextureCache[e];return i.TextureCache[e]=null,t},i.Texture.frameUpdates=[],i.RenderTexture=function(e,t){i.EventTarget.call(this),this.width=e||100,this.height=t||100,this.indetityMatrix=i.mat3.create(),this.frame=new i.Rectangle(0,0,this.width,this.height),i.gl?this.initWebGL():this.initCanvas()},i.RenderTexture.prototype=Object.create(i.Texture.prototype),i.RenderTexture.prototype.constructor=i.RenderTexture,i.RenderTexture.prototype.initWebGL=function(){var e=i.gl;this.glFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new i.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.baseTexture._glTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.baseTexture._glTexture,0),this.projection=new i.Point(this.width/2,this.height/2),this.render=this.renderWebGL},i.RenderTexture.prototype.resize=function(e,t){if(this.width=e,this.height=t,i.gl){this.projection.x=this.width/2,this.projection.y=this.height/2;var n=i.gl;n.bindTexture(n.TEXTURE_2D,this.baseTexture._glTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},i.RenderTexture.prototype.initCanvas=function(){this.renderer=new i.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new i.BaseTexture(this.renderer.view),this.frame=new i.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},i.RenderTexture.prototype.renderWebGL=function(e,t,n){var r=i.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),n&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var o=e.children,a=e.worldTransform;e.worldTransform=i.mat3.create(),e.worldTransform[4]=-1,e.worldTransform[5]=2*this.projection.y,t&&(e.worldTransform[2]=t.x,e.worldTransform[5]-=t.y),i.visibleCount++,e.vcount=i.visibleCount;for(var s=0,u=o.length;u>s;s++)o[s].updateTransform();var l=e.__renderGroup;l?e==l.root?l.render(this.projection):l.renderSpecific(e,this.projection):(this.renderGroup||(this.renderGroup=new i.WebGLRenderGroup(r)),this.renderGroup.setRenderable(e),this.renderGroup.render(this.projection)),e.worldTransform=a},i.RenderTexture.prototype.renderCanvas=function(e,t,n){var r=e.children;e.worldTransform=i.mat3.create(),t&&(e.worldTransform[2]=t.x,e.worldTransform[5]=t.y);for(var o=0,a=r.length;a>o;o++)r[o].updateTransform();n&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(e),this.renderer.context.setTransform(1,0,0,1,0,0)},i.AssetLoader=function(e,t){i.EventTarget.call(this),this.assetURLs=e,this.crossorigin=t,this.loadersByType={jpg:i.ImageLoader,jpeg:i.ImageLoader,png:i.ImageLoader,gif:i.ImageLoader,json:i.JsonLoader,anim:i.SpineLoader,xml:i.BitmapFontLoader,fnt:i.BitmapFontLoader}},i.AssetLoader.prototype.constructor=i.AssetLoader,i.AssetLoader.prototype.load=function(){var e=this;this.loadCount=this.assetURLs.length;for(var t=0;t<this.assetURLs.length;t++){var n=this.assetURLs[t],r=n.split(".").pop().toLowerCase(),i=this.loadersByType[r];if(!i)throw new Error(r+" is an unsupported file type");var o=new i(n,this.crossorigin);o.addEventListener("loaded",function(){e.onAssetLoaded()}),o.load()}},i.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},i.JsonLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.loaded=!1},i.JsonLoader.prototype.constructor=i.JsonLoader,i.JsonLoader.prototype.load=function(){this.ajaxRequest=new l;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},i.JsonLoader.prototype.onJSONLoaded=function(){if(4==this.ajaxRequest.readyState)if(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var e=this,t=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(){e.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()}else if(this.json.bones){var s=new c.SkeletonJson,u=s.readSkeletonData(this.json);i.AnimCache[this.url]=u,this.onLoaded()}else this.onLoaded();else this.onError()},i.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},i.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},i.SpriteSheetLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},i.SpriteSheetLoader.prototype.constructor=i.SpriteSheetLoader,i.SpriteSheetLoader.prototype.load=function(){var e=this,t=new i.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},i.SpriteSheetLoader.prototype.onJSONLoaded=function(){var e=this,t=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(){e.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()},i.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.ImageLoader=function(e,t){i.EventTarget.call(this),this.texture=i.Texture.fromImage(e,t)},i.ImageLoader.prototype.constructor=i.ImageLoader,i.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var e=this;this.texture.baseTexture.addEventListener("loaded",function(){e.onLoaded()})}},i.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.BitmapFontLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null},i.BitmapFontLoader.prototype.constructor=i.BitmapFontLoader,i.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},i.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))){var e=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,t=new i.ImageLoader(e,this.crossorigin);this.texture=t.texture.baseTexture;var n={},r=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],o=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];n.font=r.attributes.getNamedItem("face").nodeValue,n.size=parseInt(r.attributes.getNamedItem("size").nodeValue,10),n.lineHeight=parseInt(o.attributes.getNamedItem("lineHeight").nodeValue,10),n.chars={};for(var a=this.ajaxRequest.responseXML.getElementsByTagName("char"),s=0;s<a.length;s++){var u=parseInt(a[s].attributes.getNamedItem("id").nodeValue,10),l={x:parseInt(a[s].attributes.getNamedItem("x").nodeValue,10),y:parseInt(a[s].attributes.getNamedItem("y").nodeValue,10),width:parseInt(a[s].attributes.getNamedItem("width").nodeValue,10),height:parseInt(a[s].attributes.getNamedItem("height").nodeValue,10)};i.TextureCache[u]=new i.Texture(this.texture,l),n.chars[u]={xOffset:parseInt(a[s].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(a[s].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(a[s].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new i.Texture(this.texture,l)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(s=0;s<c.length;s++){var h=parseInt(c[s].attributes.getNamedItem("first").nodeValue,10),f=parseInt(c[s].attributes.getNamedItem("second").nodeValue,10),d=parseInt(c[s].attributes.getNamedItem("amount").nodeValue,10);n.chars[f].kerning[h]=d}i.BitmapText.fonts[n.font]=n;var p=this;t.addEventListener("loaded",function(){p.onLoaded()}),t.load()}},i.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.SpineLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.loaded=!1},i.SpineLoader.prototype.constructor=i.SpineLoader,i.SpineLoader.prototype.load=function(){var e=this,t=new i.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},i.SpineLoader.prototype.onJSONLoaded=function(){var e=new c.SkeletonJson,t=e.readSkeletonData(this.json);i.AnimCache[this.url]=t,this.onLoaded()},i.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.PIXI=i):n.PIXI=i}.call(this),define("pixi",function(e){return function(){var t;return t||e.PIXI}}(this)),define("core/loading_stage",["require","pixi"],function(e){var t=e("pixi");return function(e,n,r){var i=new t.Stage(0),o=new t.Graphics,a=new t.Text("Yo!! We are loading "+e+"!",{fill:"white"});a.position=new t.Point(20,360);var s=new t.Text(""+n,{fill:"white"});s.position=new t.Point(20,20);var u=new t.Text(""+r,{fill:"#8b8685"});return u.position=new t.Point(20,60),i.addChild(o),i.addChild(a),i.addChild(s),i.addChild(u),i.setProgress=function(e){o.beginFill(13421772),o.drawRect(0,400,800,80),o.beginFill(0),o.drawRect(20,420,760*e,40)},i}}),function(){function e(t,n){return n>t?e(n,t):0===n?t:e(n,t%n)}function t(t){function n(e){var t="000"+e;return t.substr(t.length-3)}function r(e){var t="00"+e;return t.substr(t.length-2)}function o(e){var t=r((l++).toString(36).toUpperCase());return s.push("#BPM"+t+" "+e),t}var a,s=[];for(a in t.headers)s.push("#"+String(a).toUpperCase()+" "+t.headers[a]);for(a in t.keysounds)s.push("#WAV"+String(a).toUpperCase()+" "+t.keysounds[a]);
for(a in t.measureSizes)1!==Number(t.measureSizes[a])&&s.push("#"+n(a)+"02:"+t.measureSizes[a]);var u={},l=1,c=t.events.map(function(e){if(8!=e.channel)return e;if(Math.abs(e.value-Math.round(e.value))<1e-5&&e.value>0&&e.value<=255)return{measure:e.measure,position:e.position,channel:3,value:r(Math.round(e.value).toString(16).toUpperCase())};var t=String(e.value),n=u[t]||(u[t]=o(t));return{measure:e.measure,position:e.position,channel:3,value:n}}),h=[],f=i(c).groupBy(function(e){return e.measure}),d=i(f).chain().keys().map(Number).sortBy(Number).value();return d.forEach(function(o){var a=f[o],s=i(a).groupBy(function(e){return e.channel}),u=i(s).chain().keys().map(Number).sortBy(Number).value(),l=Math.round(192*(t.measureSizes[o]||1));h.push("");var c=101;u.forEach(function(t){var i=r(t+"");for(t>100&&(i="01");t>c;)h.push("#"+n(o)+"01:00"),c++;var a={},u=[];s[t].forEach(function(e){var t=Math.round(e.position*l);u.push(t),a[t]=e});for(var f=u.reduce(e,l),d="",p=0;l>p;p+=f)if(a[p]){var g="00"+a[p].value;d+=g.substr(g.length-2)}else d+="00";h.push("#"+n(o)+i+":"+d)})}),s.concat(h).join("\r\n")}function n(e){var t={};return function(){var n=0;e.events.forEach(function(e){n=Math.max(n,e.measure)}),function(){for(var t in e.measureSizes){var r=parseInt(t,10);n=Math.max(n,r)}}(),t.maxMeasure=n}(),function(){for(var n=[],r=0,i=192,o=0;o<=t.maxMeasure;o++)i=Math.round(e.measureSizes[o]?192*e.measureSizes[o]:192),n[o]={start:r,size:i,end:r+i},r+=i;t.measureStart=function(e){return e<n.length?n[e].start:n[n.length-1].start+n[n.length-1].size+192*(e-n.length+1)},t.measureSize=function(e){return e<n.length?n[e].size:192},t.row=function(e,n){return"object"==typeof e&&null!=e.measure&&null!=e.position?t.row(e.measure,e.position):t.measureStart(e)+Math.round(t.measureSize(e)*n)},t.fromRow=function(e){for(var t=0;t<n.length;t++)if(n[t].start<=e&&e<n[t].end)return{measure:t,position:(e-n[t].start)/n[t].size};var r=n[n.length-1].end;return{measure:Math.floor((e-r)/192),position:(e-r)%192/192}}}(),t}function r(e){var t=i(e).chain().sortBy(function(e){return e.value}).groupBy(function(e){return e.row}).value(),n=i(t).keys().map(Number);return n.sort(function(e,t){return e-t}),{rows:n,map:t}}var i=this._?this._:require("underscore"),o={};o.parse=function(e){function t(e,t,n){if(2==t){var r=parseFloat(n);if(isNaN(r))throw new Error("invalid measure size");return o[e]=r,void 0}1==t&&(t=l[e]=(l[e]||100)+1);for(var a=Math.floor(n.length/2),u=0;a>u;u++){var c=n.substr(2*u,2),h=u/a;if("00"!=c){var f={measure:e,position:h};if(3==t){if(f.channel=8,f.value=parseInt(c,16),isNaN(f.value))throw new Error("invalid bpm: "+c)}else if(8==t){if(f.channel=8,f.value=s[c.toUpperCase()],!f.value)throw new Error("invalid bpmref: "+c)}else f.channel=t,f.value=c.toUpperCase();i.push(f)}}}var n=e.split(/\n/).map(function(e){return e.replace(/^\s+|\s+$/g,"")}).filter(function(e){return e.match(/^#/)}),r={},i=[],o={},a=[],s={},u={},l={};return n.forEach(function(e){var t;if(t=e.match(/^#(\d\d\d)(\d\d):(.+)/)){var n=parseInt(t[1],10),i=parseInt(t[2],10);a.push({measure:n,channel:i,content:t[3]})}else if(t=e.match(/^#wav(..)\s+(.+)$/i))u[t[1].toUpperCase()]=t[2];else if(t=e.match(/^#bpm(..)\s+(.+)$/i)){var o=parseFloat(t[2]);if(isNaN(o))throw new Error("invalid bpm : "+t[2]);s[t[1].toUpperCase()]=o}else(t=e.match(/^#(\w+)\s+(.+)$/))&&(r[t[1].toLowerCase()]=t[2])}),a.forEach(function(e){t(e.measure,e.channel,e.content)}),{headers:r,events:i,measureSizes:o,keysounds:u}},o.stringify=t,o.stat=n,o.byRow=r,o.isNote=function(e){return 10<e.channel&&e.channel<30||50<e.channel&&e.channel<70||100<e.channel},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=o:this.BMS=o}(),define("bms",["lodash"],function(e){return function(){var t;return t||e.BMS}}(this)),define("createjs",[],function(){return window.createjs}),define("loader",["require","when","bms","createjs"],function(e){var t=e("when"),n=e("bms"),r=e("createjs"),i={file:function(e){return t.promise(function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){t(n.responseText)},n.send("")})},bms:function(e){return i.file(e).then(function(e){return n.parse(e)})},audio:function(e,n){return t.promise(function(t){r.Sound.addEventListener("fileload",function(e){e.id==n&&t()}),r.Sound.registerSound(e,n)})}};return i}),define("bsearch",["require"],function(){function e(e,t){for(var n=0,r=e.length-1;r>=n;){var i=Math.floor((n+r)/2),o=0>i-1||!t(e[i-1]),a=t(e[i]);if(o&&a)return i;a?r=i-1:n=i+1}return null}return e.first=function(t,n){var r=e(t,n);return null!=r?t[r]:null},e.lastIndex=function(t,n){var r=e(t,function(e){return!n(e)});return null==r?t.length-1:0===r?null:r-1},e.last=function(t,n){var r=e.lastIndex(t,n);return null==r?null:t[r]},e}),define("guard_modification",["require"],function(){return function(e,t){function n(e){return function(){if(!i)throw new Error("Modifications to this object must be called using apply.");return e.apply(this,arguments)}}function r(e){if(i)throw new Error("apply() calls must not be nested");try{i=!0;var t=e();return o&&o(),t}finally{i=!1}}var i=!1;e.apply=r,r.guard=n;var o=t(n);return r}}),define("timing_data",["require","lodash","bsearch","guard_modification"],function(e){var t=e("lodash"),n=e("bsearch"),r=e("guard_modification");return function(){function e(e){return n.last(o,e)}function i(){var e=0,n=0,r=60;o.sort(function(e,t){return e.beat-t.beat}),t.each(o,function(t){e+=60*(t.beat-n)/r,t.startTime=e,"bpm"==t.type&&(r=+t.bpm),n=t.beat})}var o=[],a={};return a._segments=o,r(a,function(e){return a.add=e(function(e){o.push(e)}),i}),a.beatToSecond=function(t){var n=e(function(e){return t>=e.beat});return n?n.startTime+60*(t-n.beat)/n.bpm:o.length>=1?60*t/o[0].bpm:0},a.secondToBeat=function(t){var n=e(function(e){return t>=e.startTime});return n?n.beat+(t-n.startTime)*n.bpm/60:o.length>=1?t*o[0].bpm/60:0},a}}),define("note_data",["require","lodash","bsearch"],function(e){{var t=e("lodash");e("bsearch")}return function(e){e=t.sortBy(e,"beat");var n={_notes:e};return n.length=e.length,n.each=function(n){return t.each(e,n)},n}}),define("time_signatures",["require","guard_modification","bsearch"],function(e){var t=e("guard_modification"),n=e("bsearch");return function(){function e(e){return 4*(i[e]||1)}var r={},i=[],o=[0];return t(r,function(t){return r.set=t(function(e,t){i[e]=t}),function(){var t=0;o.length=0;for(var n=0;n<i.length;n++){o[n]=t;var r=e(n);t+=r}o[n]=t}}),r.measureToBeat=function(t){var n=Math.floor(t),r=t-n;return t>=i.length?o[i.length]+4*(t-i.length):o[n]+r*e(n)},r.beatToMeasure=function(t){if(t>=o[o.length-1])return i.length+(t-o[o.length-1])/4;var r=n.lastIndex(o,function(e){return t>=e});return null==r?0:r+(t-o[r])/e(r)},r.range=function(e,t){return{each:function(n){for(var i=Math.ceil(r.beatToMeasure(e)),o=Math.floor(r.beatToMeasure(t)),a=i;o>=a;a++)if(n(a)===!1)return!1}}},r}}),define("bukkit",["require","itself"],function(e){var t=e("itself");return function(){function e(e){var t=e.split("/").map(parseFloat);return 1==t.length?+t[0]:t[0]/t[1]}var n=1;return function(r){r=""+r;var i,o=r.match(/^([\+\-\*\/])=([\d\.\/]+)$/);if(o){if(i=e(o[2]),isNaN(i))return n;n=t(o[1]+i)(n)}else{if(i=e(r.replace(/^=/,"")),isNaN(i))return n;n=i}return n}}}),define("integrator",["require","lodash","bsearch"],function(e){var t=e("lodash"),n=e("bsearch");return function(e){var r=[],i=0,o=0,a=1;return t.each(t.sortBy(e,"0"),function(e){var t=a*(e[0]-o);i+=t,r.push({x:e[0],y:i,dy:e[1]}),o=e[0],a=e[1]}),function(e){var t=n.last(r,function(t){return e>=t.x});return t?t.y+t.dy*(e-t.x):e}}}),define("interpolator",["require","lodash","bsearch"],function(e){var t=e("lodash"),n=e("bsearch");return function(e){var r=[];return t.each(t.sortBy(e,"0"),function(e){r.push({x:e[0],y:e[1]})}),function(e){if(0===r.length)return 1;var t=n.lastIndex(r,function(t){return e>=t.x});if(null==t)return r[0].y;var i=r[t];if(i.x===e)return r[t].y;var o=r[t+1];return o?i.y+(o.y-i.y)*(e-i.x)/(o.x-i.x):i.y}}}),define("gimmick",["require","guard_modification","integrator","interpolator"],function(e){var t=e("guard_modification"),n=e("integrator"),r=e("interpolator");return function(){var e,i,o={},a=[],s=[];return t(o,function(){return o.scroll=function(e,t){s.push([e,t])},o.zoom=function(e,t){a.push([e,t])},function(){e=new r(a),i=new n(s)}}),o.getZoom=function(t){return e(t)},o.beatToPosition=function(e){return i(e)},o.apply(function(){}),o}}),define("notechart",["require","lodash","timing_data","note_data","time_signatures","bms","bukkit","gimmick"],function(e){function t(e,t){return n.each(e.events,t)}var n=e("lodash"),r=e("timing_data"),i=e("note_data"),o=e("time_signatures"),a=e("bms"),s=e("bukkit"),u=e("gimmick");return function(e,l){function c(){var n=l.timing||new r;return n.apply(function(){n.add({type:"bpm",beat:0,bpm:+e.headers.bpm||60}),t(e,function(e){8==e.channel&&n.add({type:"bpm",beat:g(e),bpm:e.value})})}),n}function h(){var t=l.timeSignatures||new o;return t.apply(function(){for(var n in e.measureSizes)"number"==typeof e.measureSizes[n]&&t.set(+n,e.measureSizes[n])}),t}function f(){function n(e,t,n){for(var i=0;i<t.length;i++)if(!r[t[i]])return!1;for(i=0;i<n.length;i++)if(r[n[i]])return!1;return e}var r={};return t(e,function(e){if(a.isNote(e)&&e.channel<100){var t=e.channel;t>=50&&(t-=40),r[t]=(r[t]||0)+1}}),n([16,11,12,14,15,18],[16,11,12,14,15,18],[13,19])||n([11,12,13,15,18,19],[11,12,13,15,18,19],[16,14])||n([16,11,12,13,14,15],[16,11,12,13,14,15],[18,19])||n([11,12,13,14,15,18],[11,12,13,14,15,18],[16,19])||n([16,11,12,13,14,15,18],[16],[19])||n([11,12,13,14,15,18,19],[],[])}function d(){var t=[],n={},r={},o=f();v.columns=o.length,e.events.sort(function(e,t){return g(e)-g(t)});var s=p(e.events),u=e.headers.lnobj&&e.headers.lnobj.toLowerCase();return s.forEach(function(e){if(a.isNote(e)){var i=g(e);50<=e.channel&&e.channel<70?n[e.channel]?(n[e.channel].finish=i,delete n[e.channel]):t.push(n[e.channel]={column:m(e,o),beat:i,value:e.value}):u&&e.value.toLowerCase()==u?r[e.channel].finish=i:t.push(r[e.channel]={column:m(e,o),beat:i,value:e.value})}}),t.forEach(function(e){e.time=v.timing.beatToSecond(e.beat),e.finish&&(e.finishTime=v.timing.beatToSecond(e.finish))}),new i(t)}function p(t){var n={zoom:s(),scroll:s()};return v.gimmick.apply(function(){return t.filter(function(t){var r=e.keysounds[t.value];if(!r)return!0;var i=r.match(/^(\w+)(\W?=[\d\/\.]+)$/);if(!i)return!0;var o=g(t),a=i[1],s=i[2];return n[a]?(v.gimmick[a](o,n[a](s)),!1):!0})})}function g(e){var t=+e.measure+ +e.position;return v.timeSignatures.measureToBeat(t)}function m(e,t){var r=e.channel;return r>100?100-r:(r>=50&&(r-=40),n.indexOf(t,r))}l=l||{};var v={};return v.timeSignatures=h(),v.timing=c(),v.gimmick=l.gimmick||new u,v.notes=d(),v}}),define("zip",[],function(){return window.zip}),function(e){e("when/guard",["require","./when"],function(e){function t(e,t){return function(){var n,i;return n=this,i=arguments,r(e(),function(e){return r(t.apply(n,i)).ensure(e)})}}function n(e){var t,n;return t=0,n=[],function(){return r.promise(function(r){function i(){t=Math.max(t-1,0),n.length&&n.shift()(i)}e>t?r(i):n.push(r),t+=1})}}var r=e("./when");return t.n=n,t})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)}),define("core/zip_preloader",["require","when","zip","when/guard"],function(e){function t(e,t,n){e[t]=n(e[t])}var n=e("when"),r=e("zip"),i=e("when/guard");return function(){var e={};return e.load=function(e,o){return n.promise(function(t,n,r){r({stage:"zip file"});var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onprogress=function(e){e.lengthComputable&&r({progress:e.loaded/e.total})},i.onload=function(){200==i.status?t(i.response):n(new Error("HTTP "+i.statusCode))},i.onerror=function(e){n(e)},i.send(null)}).then(function(e){return n.promise(function(t,n){r.createReader(new r.BlobReader(e),t,n)})}).then(function(e){var t=i(i.n(1),function(e){return n.promise(function(t,n,i){i({progress:e._progress}),e.getData(new r.BlobWriter,function(e){t(e)})}).then(function(t){return{filename:e.filename,url:URL.createObjectURL(t)}})});return n.promise(function(t,n,r){r({stage:"zip contents"}),e.getEntries(t)}).then(function(e){return e.forEach(function(t,n){t._progress=n/e.length}),n.map(e,t)}).finally(function(){return n.promise(function(t){e.close(function(){t()})})})}).then(function(e){var t={};return e.forEach(function(e){var n=e.filename.split("/").map(encodeURIComponent).join("/");t[o+"/"+n]=e.url}),t}).then(function(e){var n=XMLHttpRequest.prototype;t(n,"open",function(t){return function(n,r,i){return r in e?t.call(this,n,e[r],i):t.apply(this,arguments)}})})},e}()}),define("core/pak_preloader",["require","when","when/guard"],function(e){function t(e,t,n){e[t]=n(e[t])}{var n=e("when");e("when/guard")}return function(){var e={};return e.load=function(e,r,i){function o(e,t,r){return n.promise(function(n,i,o){o({stage:t});var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType=r,a.onprogress=function(e){e.lengthComputable&&o({progress:e.loaded/e.total})},a.onload=function(){200==a.status?n(a.response):i(new Error("HTTP "+a.statusCode))},a.onerror=function(e){i(e)},a.send(null)})}return o(e,"metadata file","text").then(JSON.parse).then(function(t){var n=e.replace(/[^\/]*$/,"/")+t.pak;return o(n,t.pak,"blob").then(function(e){return t.files.map(function(t){var n=window.URL||window.webkitURL,r=e.slice(t.start,t.end,i),o=n.createObjectURL(r);return{filename:t.file,url:o}})})}).then(function(e){var t={};return e.forEach(function(e){if(e.url){var n=e.filename.split("/").map(encodeURIComponent).join("/");t[r+"/"+n]=e.url}}),t}).then(function(e){var n=XMLHttpRequest.prototype;t(n,"open",function(t){return function(n,r,i){return r in e?t.call(this,n,e[r],i):t.apply(this,arguments)}})})},e}()}),define("core/main",["require","./loading_stage","loader","when","notechart","lodash","createjs","pixi","./zip_preloader","./pak_preloader"],function(e){var t=e("./loading_stage"),n=e("loader"),r=e("when"),i=e("notechart"),o=e("lodash"),a=e("createjs"),s=(e("pixi"),e("./zip_preloader")),u=e("./pak_preloader");return function(e){function l(e){var t=document.createElement("audio");return!(!t.canPlayType||!t.canPlayType(e).replace(/no/,""))}function c(e,c){function h(n,r,i){var o=null;return n.load(e+"/"+r,e,i).then(null,null,function(n){n.stage?(o=new t(n.stage,r,e),f.replaceStage(o),f.render()):o&&"progress"in n&&(o.setProgress(n.progress),f.render())})}function g(){var e=l("audio/mpeg;"),t=l('audio/ogg; codecs="vorbis"');return e?{extension:"mp3",mime:"audio/mpeg"}:t?{extension:"ogg",mime:"audio/ogg"}:null}function m(){if(!window.URL)return!1;try{if(4!=new Blob(["test"]).size)return!1}catch(e){return!1}return!0}function v(){return n.bms(e+"/"+c)}function y(t){return r.promise(function(n){var r=new a.LoadQueue;r.installPlugin(a.Sound),a.Sound.alternateExtensions=["ogg"],r.addEventListener("complete",n),o.forOwn(b.keysounds,function(t,n){var i=t.replace(/\.(?:wav|mp3|ogg)$/i,".mp3").replace(/\\/g,"/").replace(/^\//,"").split("/").map(encodeURIComponent).join("/");r.loadFile({id:n,src:e+"/"+i})}),r.addEventListener("progress",function(e){t.setProgress(e.progress),f.render()})})}var b;r().then(function(){return f.replaceStage(new t("the notechart",c,e)),f.render(),v()}).tap(function(e){b=e}).tap(function(){var e=g();if(e&&m())return h(u,e.extension+"s.json",e.mime).catch(function(){return h(s,e.extension+"s.zip",e.mime)}).catch(function(e){console.error("Cannot preload samples",e)})}).tap(function(){var e=b.headers,n=new t("keysounds",e.title,e.artist);return f.replaceStage(n),f.render(),y(n)}).tap(function(){var e=new i(b),t=new p({notechart:e,tutorial:"ByMySide-TUTORIAL.bms"==c});t.start(),f.replaceStage(t.desire("game.stage")),d.currentGame=t}).done()}function h(){f.renderTo(document.body),c(sessionStorage["music.path"]||"music/default/sawasdee-new-year",sessionStorage["music.bms"]||"sawasdee-new-year-normal.bms")}var f=e("display"),d=e("game_manager"),p=e("Game");return{run:h}}}),define("mixin",["require"],function(){return function(e){return{mix:function(t){return e(t),t}}}}),define("core/stage_manager",["require","mixin"],function(e){var t=e("mixin");return t(function(e){function t(){e.currentStage=n[n.length-1]}var n=[];e.currentStage=null,e.pushStage=function(e){n.push(e),t()},e.popStage=function(){n.pop(),t()},e.replaceStage=function(e){0===n.length?n[0]=e:n[n.length-1]=e,t()},e.forward=function(t,n){var r=e.currentStage;return r&&r[t]&&r[t](n)}})}),define("core/display",["require","pixi","./stage_manager","lodash"],function(e){var t=e("pixi"),n=e("./stage_manager"),r=e("lodash"),i=r.partial;return function(){var e=document.createElement("div");e.className="stage";var r=t.autoDetectRenderer(800,600);e.appendChild(r.view);var o=n.mix({});return o.renderTo=function(t){t.appendChild(e),window.addEventListener("keydown",i(o.forward,"onkeydown"),!1),window.addEventListener("keypress",i(o.forward,"onkeypress"),!1),window.addEventListener("keyup",i(o.forward,"onkeyup"),!1)},o.render=function(){r.render(o.currentStage)},o}}),define("core/game_stage",["require","pixi"],function(e){var t=e("pixi");return function(){return new t.Stage}}),define("core/game_timer",["require"],function(){return function(e){function t(t){var i=r.time;if(t!=i){var o=e("game");r.time=t,n("game.time",{time:t,previous:i,game:o})}}var n=e("hook"),r={};return r.time=0,r.bindAudio=function(e){setInterval(function(){t(e.currentTime)},1e3/60)},r.bindTimer=function(){var e=(new Date).getTime();setInterval(function(){var n=((new Date).getTime()-e)/1e3;t(n)},1e3/60)},r.bind=function(){r.bindTimer()},r}}),define("core/game_state",["require"],function(){return function(e){var t=e("game.timer"),n=e("game.notechart"),r=e("game.hook"),i=(e("game.score"),e("game.speed")),o={},a=e("game.gimmick");return o.buttons={},o.press=function(e){o.buttons[e]||(o.buttons[e]=!0,r("game.column.down",{column:e}))},o.release=function(e){o.buttons[e]&&(o.buttons[e]=!1,r("game.column.up",{column:e}))},o.update=function(){o.time=t.time-2,o.time<0&&(o.time=(Math.exp(2*o.time)-1)/2),o.beat=n.timing.secondToBeat(o.time),o.position=a.beatToPosition(o.beat),i.update()},o.score=e("game.score"),o.handleJudgment=function(e){var n=o.judgment?o.judgment.combo:0;"number"==typeof e.result&&e.result<=1?n+=1:n=0,o.judgment={result:e.result,time:t.time,combo:n},o.score.add(e.result,n)},o}}),define("core/game_speed",["require"],function(){return function(){var e={current:1,target:3,lockCount:0,lock:function(){e.lockCount+=1},unlock:function(){e.lockCount-=1}};return e.update=function(){0===e.lockCount&&(e.current+=(e.target-e.current)/5)},e.increase=function(){e.set(e.target+.5)},e.decrease=function(){e.set(e.target-.5)},e.set=function(t){e.target=.5*Math.round(t/.5),e.target<.5&&(e.target=.5),e.target>8&&(e.target=8)},e}}),define("core/game_metrics",["require","bsearch"],function(e){e("bsearch");return function(e){function t(){return a.notes.bottom-a.notes.top}function n(){return o.current*a.notes.barHeight/4*r()}function r(){return s.getZoom(i.beat)}var i=e("game.state"),o=e("game.speed"),a=e("game.theme"),s=e("game.gimmick"),u={};return u.visibleRange=function(e){var r=i.position,o=t()/n(),a=r+o;return e(r,a)},u.noteY=function(e){var t=e-i.position;return a.notes.bottom-n()*t},u.beatToPosition=function(e){return s.beatToPosition(e)},u}}),define("core/game_renderer",["require"],function(){return function(e){var t={},n=e("game.hook"),r=e("display");return t.start=function(){function t(){e("game");n("game.frame"),r.render(),window.requestAnimationFrame(t)}window.requestAnimationFrame(t)},t}}),define("object_pool",["require"],function(){return function(e){function t(t){return t in a?a[t]:s.length>0?s.shift():new e}function n(n){var r=e.hashKey(n),i=t(r);return i.set(n),u[r]=i,i}function r(){for(var e in a)e in u||i(a[e])}function i(e){e.deactivate(),s.push(e)}var o={},a={},s=[],u=null;return o.begin=function(){u={}},o.commit=function(){r(),a=u,u=null},o.use=n,o.update=function(e){o.begin(),e(o.use),o.commit()},o}}),define("enums",["require","lodash"],function(e){var t=e("lodash"),n={};return Object.defineProperty(Array.prototype,"each",{value:function(e){return t.each(this,e)},configurable:!0,writable:!0}),n.make=function(e){return{each:e}},n.toArray=function(e){var t=[];return e.each(function(e){t[t.length]=e}),t},n.filter=function(e,t){return n.toArray(e).filter(t)},n.map=function(e,t){return n.toArray(e).map(t)},n}),define("changer",["require"],function(){return function(e,t){return e(t),function(n){n!=t&&(e(n,t),t=n)}}}),define("object_id",["require"],function(){var e=Object.prototype.hasOwnProperty,t=0;return function(n){return"object"==typeof n||"function"==typeof n?null==n?"$$null":(e.call(n,"$$id")||(n.$$id="$"+t++),n.$$id):":"+n}}),define("core/render/bar",["require","object_pool","enums","itself","changer","object_id"],function(e){{var t=e("object_pool"),n=e("enums");e("itself"),e("changer"),e("object_id")}return function(e){function r(){var e=s.bar.create(),t=!1;return{set:function(n){t||(c.addChild(e),t=!0),e.position.y=n.y},deactivate:function(){t&&(c.removeChild(e),t=!1)}}}function i(){h.begin(),o().each(function(e){var t=u.measureToBeat(e),n=l.beatToPosition(t),r=l.noteY(n,null);h.use({id:e,y:r})}),h.commit()}function o(){var e=Math.ceil(u.beatToMeasure(a.beat));return n.make(function(t){return l.visibleRange(function(n,r){for(var i=e;;i++){var o=u.measureToBeat(i),a=l.beatToPosition(o);if(a>r)return;if(t(i)===!1)return!1}})})}var a=e("game.state"),s=e("game.theme"),u=e("game.notechart").timeSignatures,l=e("game.metrics"),c=s.bars.container;r.hashKey=function(e){return e.id};var h=new t(r);return{render:i}}}),define("core/render/notes",["require","object_pool","enums","itself","changer","object_id"],function(e){var t=e("object_pool"),n=(e("enums"),e("itself")),r=e("changer"),i=e("object_id");return function(e){function o(){var e=a();c.each(n(".begin()")),e.each(function(e){var t=e.note.column,n=l.noteY(e.position,e),r=c[t];if(e.finish){var o=l.noteY(e.finish,e);r.use({id:i(e),y:n,height:n-o})}else r.use({id:i(e),y:n,height:0})}),c.each(n(".commit()"))}function a(){return l.visibleRange(function(e,t){return u.range(e,t)})}var s=(e("game.state"),e("game.theme")),u=e("game.entities"),l=e("game.metrics"),c=[],h=[0,1,2,3,4,5,6],f=s.notes.container;return h.forEach(function(e){function n(){var t=s.note.create(e),n=!1,o=new r(function(e){t.setHeight(e)},0);return{set:function(e){n||(f.addChild(t),n=!0),t.position.x=i,t.position.y=e.y,o(e.height)},deactivate:function(){n&&(f.removeChild(t),n=!1)}}}var i=s.note.left[e];n.hashKey=function(e){return e.id};var o=new t(n);c.push(o)}),{render:o}}}),define("core/game_theme_class",["require","itself","pixi","lodash"],function(e){var t=e("itself"),n=e("pixi"),r=e("lodash");return function(e){var i=e("game.stage");return function(){function e(t,r){t.layer=function(t,i){var o=new n.DisplayObjectContainer;return r.addChild(o),e(o,o),"function"==typeof i&&i(o),o}}var o={},a=[];return e(o,i),o.info=function(e){r.assign(o,e)},o.bind=function(e){a.push(e)},o.update=function(){a.forEach(t("()"))},o}}}),define("core/theme/combo",["require","pixi","changer"],function(e){var t=e("pixi"),n=e("changer");return function(){return function(e,r){function i(){l.forEach(function(t){e.removeChild(t)}),l.length=0}function o(){for(var e=r.digits||4,t=r.style||{font:"bold 96px Helvetica",fill:"#8b8685"},n=0;e>n;n++)s.push(a(t))}function a(e){return[0,1,2,3,4,5,6,7,8,9].map(function(n){return new t.Text(""+n,e)})}r=r||{};var s=[],u={},l=[];o();var c=n(function(t){if(""!==t){i();for(var n=2,r=0,o=0;o<t.length;o++){var a=s[o]&&s[o][t.charAt(o)];a&&(l.push(a),r+=a.width+2*n)}var u=Math.round(-r/2);for(o=0;o<l.length;o++)e.addChild(l[o]),l[o].position.x=u,u+=l[o].width+2*n}},"");return u.set=function(e){c(e+"")},u}}}),define("core/game_theme",["require","pixi","changer","./theme/combo"],function(e){var t=e("pixi"),n=e("changer");return function(r){function i(){var e=16764091,t=12307711,n=13434811;return[e,t,e,n,e,t,e]}var o=r("game.Theme"),a=r("game.state"),s=r("game.timer"),u=r("game.ready"),l=e("./theme/combo")(r),c=r("game.options"),h=new o,f=[],d=[32,32,32,36,32,32,32],p=i(),g=d.reduce(function(e,t){return e+t},0);d.reduce(function(e,t){return f.push(e),e+t},(800-g)/2),h.layer("Hit Highlight Background",function(e){var n=13395456,r=26316,i=6736896,o=[n,r,n,i,n,r,n];f.forEach(function(n,r){var i=d[r],s=new t.Graphics;s.beginFill(o[r]),s.drawRect(n,0,i,512),h.bind(function(){s.alpha=a.buttons[r]?.33:0}),e.addChild(s)})}),h.layer("Combo Info",function(e){e.position.x=f[3]+d[3]/2,e.position.y=160;var t=new l(e);h.bind(function(){if(a.judgment){var n=s.time-a.judgment.time,r=a.judgment?a.judgment.combo:0;e.visible=.75>n&&r>0,e.position.y=160-10*Math.exp(-10*n),e.visible&&t.set(r)}else e.visible=!1})});var m;h.layer("Time Signature Layer",function(e){m=e});var v;return h.layer("Notes Area",function(e){v=e}),h.layer("Panel",function(e){var n=new t.Graphics;n.beginFill(9143941),n.drawRect(0,512,800,88),n.drawRect(f[0]+g,0,12,512),n.drawRect(f[0]-12,0,12,512),e.addChild(n)}),h.layer("Score",function(e){var t={font:"bold 24px Helvetica",fill:"#e9e8e7"},n=new l(e,{style:t,digits:6});e.position.y=536,e.position.x=400,h.bind(function(){var t=a.score.get();n.set(t),e.visible=u.status})}),h.layer("Space to Start",function(e){var n={font:"bold 24px Helvetica",fill:"#e9e8e7"},r={font:"bold 24px Helvetica",fill:"#ffff00"},i=new t.Text("Press SPACE to Start",n),o=new t.Text("Press SPACE to Start",r);e.position.y=536,e.position.x=400,e.addChild(i),e.addChild(o),i.position.x-=Math.round(i.width/2),o.position.x=i.position.x,h.bind(function(){e.visible=!u.status,o.alpha=u.highlight()})}),c.tutorial&&h.layer("Tutorial",function(e){function n(n,r,i){function o(i){var o=n+.25*u+.01,l=new t.Text(i,{font:"15px Arial",fill:"white"});return l.position.x-=Math.round(l.width/2),l.position.y=s,s+=28,u+=1,l.visible=!1,e.addChild(l),h.bind(function(){var e=a.beat/4;e>=o&&r>e?(l.alpha=o+.25>=e?(e-o)/.25:e>=r-.25?(r-e)/.25:1,l.visible=!0):l.visible=!1}),l}var s=0,u=0;i(o)}e.position.x=f[3]+d[3]/2,e.position.y=150,n(0,3,function(e){e("Before we start the tutorial"),e("Let's see if you can figure"),e("it out by yourself!")}),n(19,23,function(e){e("BEATMUSICSEQUENCE"),e("is an online rhythm game."),e(""),e("You use your keyboard"),e("to play this game.")}),n(23,27,function(e){e("As you've seen,"),e("notes will fall down"),e("from the top of the screen."),e("You have to hit"),e("the corresponding key"),e("when it reaches the bottom.")}),n(27,33,function(e){e("The next set of notes is coming."),e("When it comes, here are the keys"),e("that you need to hit:"),e("S, S, D, D, F, F,"),e("Space, Space,"),e("J, J, K, K, L, L, Space")}),n(33,35,function(e){e("They're Coming!!"),e("..."),e("..."),e("GET READY!")}),n(43,47,function(e){e("Sometimes, more than one note"),e("may fall down at the same time."),e(""),e("That means you must hit"),e("multiple keys at the same time.")}),n(47,51,function(e){e("They're coming again!!"),e("Here are the keys to hit:"),e(""),e("FJ FJ FJ FJ DJ DJ FK FK")}),n(55,59,function(e){e("There are also long notes."),e("You need to press and hold"),e("the key until the note is"),e("finished...")}),n(67,75,function(e){e("That's all!"),e(""),e("Now you know"),e("everythingyou need to know"),e("to play this game!"),e(""),e("HAVE FUN!!")})}),h.layer("Judgment Info",function(e){function r(e,t){t&&(t.visible=!1),e&&(e.visible=!0)}function i(){return 0===a.judgment.result?l:1===a.judgment.result?c:2===a.judgment.result?p:"miss"==a.judgment.result?g:void 0}function o(n,r){var i=new t.Text(n,r);return i.position.x-=i.width/2,i.visible=!1,e.addChild(i),i}e.position.x=f[3]+d[3]/2,e.position.y=300;var u="50px Krungthep",l=o("",{font:u,fill:"#fff"}),c=o("",{font:u,fill:"#9cf"}),p=o("",{font:u,fill:"#c9c"}),g=o("",{font:u,fill:"#aaa"}),m=new n(r,null);h.bind(function(){if(a.judgment){var t=s.time-a.judgment.time;e.visible=.75>t,e.position.y=300-10*Math.exp(-10*t),m(i())}else m(null)})}),h.info({notes:{bottom:512,top:0,barHeight:384,container:v},note:{left:f,height:12,create:function(e){var n=new t.Graphics;return n.setHeight=function(t){n.clear(),n.beginFill(p[e]),n.drawRect(0,-t-h.note.height,d[e],h.note.height+t),n.beginFill(16777215),n.drawRect(0,-t-h.note.height,d[e],h.note.height/4)},n}},bars:{container:m},bar:{create:function(){var e=new t.Graphics;return e.beginFill(10196629),e.drawRect(f[0],-1,g,1),e.beginFill(9143941),e.drawRect(f[0],-2,g,1),e}}}),h}}),define("core/game_keyboard",["require","enums","lodash"],function(e){e("enums"),e("lodash");return function(e){function t(){function e(e,t){for(var n={},r=0;r<e.length;r++)n[e.charCodeAt(r)]=r%t;return n}return 6==a.columns?e("SDFJKLQWEUIO",6):7==a.columns?e("SDF JKLQWE UIO",7):void 0}function n(){{var e=t();a.columns}r.onkeypress=function(e){e.preventDefault()},r.onkeyup=function(t){t.preventDefault();var n=e[t.keyCode];null!=n&&i.release(n)},r.onkeydown=function(t){if(t.preventDefault(),38==t.keyCode)return o.increase();if(40==t.keyCode)return o.decrease();var n=e[t.keyCode];null!=n&&i.press(n)}}var r=e("game.stage"),i=e("game.state"),o=e("game.speed"),a=(e("game.hook"),e("game.notechart"));return{bind:n}}}),define("core/keysound_manager",["require","object_id","enums","lodash"],function(e){var t=e("object_id"),n=e("enums"),r=e("lodash");return function(e){var i={},o={};i.set=function(e,n){o[t(e)]=n},i.get=function(e){return o[t(e)]};var a=e("game.state"),s=e("game.notes.playable"),u=[],l={};return i.autoplay=function(){for(;u[0]&&a.beat>=u[0].beat;){var e=u.shift(),t=i.get(e);t&&t.play("auto")}},i.blank=function(e){var t,o=n.toArray(n.filter(s,function(t){return t.column==e})),u=r.min(o,function(e){return Math.pow(e.beat-a.beat,2)});u&&(t=i.get(u)),t&&t.play("blank")},i.hit=function(e){var n=i.get(e);if(n){var r=n.play("hit");e.finish&&(l[t(e)]=r)}},i.release=function(e){delete l[t(e)]},i.break=function(e){var n=l[t(e)];n&&n.stop()},i.addAutoplay=function(e){u.push(e)},i}}),define("core/keysound_loader",["require","createjs"],function(e){var t=e("createjs");return function(e){function n(){function e(e){return o[e]?o[e]:(o[e]=n(e),o[e])}function n(e){return{play:function(n){var r=t.Sound.play(e);return"auto"==n&&(r.volume=.8),r}}}var o={};r.notes.each(function(t){i.set(t,e(t.value)),t.column<0&&i.addAutoplay(t)})}var r=e("game.notechart"),i=e("game.keysound");return{load:n}}}),define("core/entities",["require","enums","bsearch","object_id"],function(e){var t=e("enums"),n=e("bsearch"),r=e("object_id");return function(e){function i(e,t,r){var i=n(c,function(t){return t.position>=e}),o=n.lastIndex(c,function(e){return e.position<t});if(null!=i)for(var a=i;o>=a;a++){var s=c[a];if(r(s)===!1)return!1}}function o(e,t,r){var i=n(h,function(t){return e<t.finish});if(null!=i)for(var o=i;o<h.length;o++){var a=h[o];if(!(a.position>t)&&r(a)===!1)return!1}}function a(e){var t={};return function(n){var i=r(n);return t[i]?void 0:(t[i]=!0,e(n))}}var s=e("game.notes"),u=e("game.metrics"),l={},c=[],h=[];return s.each(function(e){if(!(e.column<0)){var t=u.beatToPosition(e.beat),n={position:t,note:e};c.push(n),null!=e.finish&&(n.finish=u.beatToPosition(e.finish),h.push(n))}}),c.sort(function(e,t){return e.position-t.position}),h.sort(function(e,t){return e.finish-t.finish}),l.range=function(e,n){return t.make(function(t){var r=a(t);return!1===i(e,n,r)?!1:!1===o(e,n,r)?!1:void 0})},l}}),define("core/judges",["require"],function(){return function(e){for(var t=[],n=e("game.notechart").columns,r=e("game.Judge"),i=0;n>i;i++)t.push(new r(i));return t.update=function(){for(var e=0;e<t.length;e++)t[e].update()},t}}),define("core/judge",["require","enums"],function(e){var t=e("enums");return function(e){function n(e){function n(t){return t.column==e}var o={},a=0,s=o._items=t.toArray(t.filter(r,n)),u=null;return o.update=function(){for(;s[a]&&"miss"==i.judge(s[a]);)i.emit("miss"),a+=1
},o.down=function(){if(!s[a])return i.blank(e),void 0;var t=i.judge(s[a]);"number"==typeof t?(u=s[a],i.emit(t,s[a],"down"),a+=1):null==t&&i.blank(e)},o.up=function(){if(u){var e=u,t=i.judgeRelease(e);u=null,null!=t&&i.emit(t,e,"up")}},o}{var r=(e("game.notechart").timing,e("game.notes.playable")),i=e("game.judgment");e("game.hook")}return n}}),define("core/judgment",["require"],function(){return function(e){function t(e,t,n){for(var o=r.time,a=Math.abs(e-o),s=0;s<i.length;s++)if(a<i[s])return s;return e>o?t:n}var n={},r=e("game.state"),i=e("game.judgment.timing_window"),o=e("game.hook");return n.judge=function(e){return t(e.time,void 0,"miss")},n.judgeRelease=function(e){return e.finishTime?t(e.finishTime,"miss","miss"):void 0},n.blank=function(e){o("game.judgment.blank",{column:e})},n.emit=function(e,t,n){o("game.judgment",{note:t,result:e}),"number"==typeof e&&"down"==n?o("game.judgment.hit",{note:t,result:e}):"up"==n&&o("game.judgment.release",{note:t,result:e})},n}}),define("core/game_score",["require"],function(){return function(e){function t(){var e={};return e.judge=0,e.combo=0,e.add=function(t,n){var r=0;0===t?(e.judge+=3,r=3):1===t&&(e.judge+=2,r=1),e.combo+=Math.min(n*r,300)},e}function n(){var e=0;r.each(function(t){i.add(0,++e),t.finish&&i.add(0,++e)})}var r=e("game.notes.playable"),i=new t,o=new t;return n(),o.get=function(){var e=5e5,t=55555;return Math.floor(e*o.judge/i.judge)+Math.floor(t*o.combo/i.combo)},o}}),define("timesync/timesync",[],function(){return{convert:function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return{offset:(n-t+(r-i))/2,delay:i-t-(r-n)}},offset:function(e){e=e.slice(),e.sort(function(e,t){return e.offset-t.offset}),e=e.slice(1,e.length-1),e.sort(function(e,t){return e.delay-t.delay});for(var t=0,n=0,r=0;r<e.length&&!(e[r].delay>e[0].delay);r++)t+=e[r].offset,n+=1;return t/n}}}),define("timesync",["timesync/timesync"],function(e){return e}),"undefined"==typeof WebSocket)var WebSocket=require("ws");define("timesync/client",["require","./timesync"],function(e){function t(e,t){function r(){o.send(""+(new Date).getTime())}function i(e){var t=e.split(","),r=+t[0],i=+t[1],o=(new Date).getTime();o>=r&&a.push(n.convert([r,i,i,o]))}var o=new WebSocket(e),a=[];o.onmessage=function(e){"k"==e.data&&r(),e.data.indexOf(",")>=0&&(i(e.data),r())},o.onclose=function(){return a.length<1?t(new Error("no offset received")):t(null,n.offset(a))}}var n=e("./timesync");return{sync:t}}),define("core/time_synchronizer",["require","timesync","timesync/client"],function(e){var t=(e("timesync"),e("timesync/client"));return function(){function e(){return(new Date).getTime()+n}var n,r={},i=1e3;return t.sync("ws://vps.dt.in.th:1357/",function(e,t){n=t}),r.highlight=function(){if(null==n)return 0;var t=e(),r=t%i/i;return.5>r?0:2*(1-r)},r.start=function(){if(null==n)return null;var t=e(),r=t%i/i;return.2>r?null:r>.8?null:i-t%i},r}}),define("core/game_ready",["require","./time_synchronizer"],function(e){var t=e("./time_synchronizer");return function(e){function n(){var e=a.start();e?setTimeout(r,e):r()}function r(){i.status||(i.status=!0,o.bind())}var i={status:!1},o=(e("game.state"),e("game.timer")),a=new t;return i.highlight=function(){return a.highlight()},i.fire=n,i}}),define("core/game_notes",["require","enums"],function(e){function t(e){function t(t){return t.column<0==e}return function(e){var r=e("game.notes");return n.filter(r,t)}}var n=e("enums");return{"game.notes.autoplay":t(!0),"game.notes.playable":t(!1),"game.gimmick":function(e){return e("game.notechart").gimmick},"game.notes":function(e){return e("game.notechart").notes}}}),define("core/game",["require","desire","lodash","./game_stage","./game_timer","./game_state","./game_speed","./game_metrics","./game_renderer","./render/bar","./render/notes","./game_theme_class","./game_theme","./game_keyboard","./keysound_manager","./keysound_loader","./entities","./judges","./judge","./judgment","./game_score","./game_ready","./game_notes"],function(e){var t=e("desire"),n=e("lodash"),r={"game.stage":e("./game_stage"),"game.timer":e("./game_timer"),"game.state":e("./game_state"),"game.speed":e("./game_speed"),"game.metrics":e("./game_metrics"),"game.renderer":e("./game_renderer"),"game.render.bar":e("./render/bar"),"game.render.notes":e("./render/notes"),"game.Theme":e("./game_theme_class"),"game.theme":e("./game_theme"),"game.keyboard":e("./game_keyboard"),"game.keysound":e("./keysound_manager"),"game.load.keysound":e("./keysound_loader"),"game.entities":e("./entities"),"game.judges":e("./judges"),"game.Judge":e("./judge"),"game.judgment":e("./judgment"),"game.score":e("./game_score"),"game.ready":e("./game_ready"),"game.judgment.timing_window":t.value([.07,.12,.15])};return n.assign(r,e("./game_notes")),function(e){return function(n){{var i={},o=e("hook");e("display")}return i.desire=new t(e),i.desire.register(r),i.desire.register({game:t.value(i),"game.options":t.value(n),"game.notechart":t.value(n.notechart),"game.hook":t.value(o.derive(i))}),i.start=function(){i.desire("game.renderer").start(i),i.desire("game.load.keysound").load(),i.desire("game.keyboard").bind(),i.desire("game.hook")("game.start")},i}}}),define("core/game_manager",["require"],function(){return function(){return{}}}),define("core/index",["require","./main","./display","./game","./game_manager"],function(e){return{components:{main:e("./main"),display:e("./display"),Game:e("./game"),game_manager:e("./game_manager")},hooks:[{on:"main",order:1,"do":function(){this.desire("main").run()}},{on:"game.frame",order:0,"do":function(){this.desire("game.state").update()}},{on:"game.frame",order:10,"do":function(){this.desire("game.keysound").autoplay()}},{on:"game.frame",order:20,"do":function(){this.desire("game.judges").update()}},{on:"game.frame",order:100,"do":function(){this.desire("game.render.bar").render(),this.desire("game.render.notes").render()}},{on:"game.frame",order:110,"do":function(){this.desire("game.theme").update()}},{on:"game.column.down",order:10,"do":function(e){this.desire("game.judges")[e.column].down()}},{on:"game.column.down",order:10,"do":function(e){3==e.column&&this.desire("game.ready").fire()}},{on:"game.column.up",order:10,"do":function(e){this.desire("game.judges")[e.column].up()}},{on:"game.judgment.blank",order:20,"do":function(e){this.desire("game.keysound").blank(e.column)}},{on:"game.judgment.hit",order:20,"do":function(e){"miss"!=e.result&&this.desire("game.keysound").hit(e.note)}},{on:"game.judgment.release",order:20,"do":function(e){"miss"==e.result?this.desire("game.keysound").break(e.note):this.desire("game.keysound").release(e.note)}},{on:"game.judgment",order:20,"do":function(e){this.desire("game.state").handleJudgment(e)}}]}}),define("ipad/touch",["require"],function(){return function(e){function t(){function e(e){var n=t(e);if(null==a&&null!=n)i.lock();else if(null!=a&&null==n)i.unlock();else if(null!=a&&null!=n&&n>=64&&a>=64){var r=i.current*n/a;i.current=Math.max(.33,Math.min(8.16,r)),i.set(i.current)}a=n}function t(e){return 2!=e.length?null:Math.abs(e[0]-e[1])}var o=n.columns;window.ontouchstart=window.ontouchmove=window.ontouchend=function(t){var n,i=[],a=[];for(n=0;o>n;n++)i[n]=0;for(n=0;n<t.touches.length;n++)if(t.touches[n].clientY<512)a.push(t.touches[n].clientY);else{var s=Math.floor(t.touches[n].clientX/window.innerWidth*7);t.touches[n].clientY>=5*window.innerHeight/6&&(s=3),i[s]++}for(n=0;o>n;n++)i[n]>0?r.press(n):r.release(n);e(a),t.preventDefault()};var a=null}var n=e("game.notechart"),r=e("game.state"),i=e("game.speed");return{bind:t}}}),define("ipad/buttons",["require"],function(){return function(e){function t(){}function n(e,t){var n=document.createElement("div");n.className="touch-button touch-button-"+e;var r=document.createElement("div");n.appendChild(r);var o=Math.round(100*e/i),a=Math.round(100*(1+e)/i);return n.style.left=o+"%",n.style.width=a-o+"%",t.appendChild(n),r}var r=e("game.notechart"),i=(e("game.state"),r.columns),o=document.createElement("div");document.body.appendChild(o);for(var a=[],s=0;i>s;s++)a.push(n(s,o));return{update:t}}}),define("ipad/index",["require","./touch","./buttons"],function(e){return{components:{},hooks:[{on:"game.start",order:1e3,"do":function(){this.desire.register({"game.ipad.touch":e("./touch"),"game.ipad.buttons":e("./buttons")}),this.desire("game.ipad.touch").bind()}},{on:"game.frame",order:1e3,"do":function(){this.desire("game.ipad.buttons").update()}}]}}),function(){function require(e,t,n){var r=require.resolve(e);if(null==r){n=n||e,t=t||"root";var i=new Error('Failed to require "'+n+'" from "'+t+'"');throw i.path=n,i.parent=t,i.require=!0,i}var o=require.modules[r];if(!o._resolving&&!o.exports){var a={};a.exports={},a.client=a.component=!0,o._resolving=!0,o.call(this,a.exports,require.relative(r),a),delete o._resolving,o.exports=a.exports}return o.exports}require.modules={},require.aliases={},require.resolve=function(e){"/"===e.charAt(0)&&(e=e.slice(1));for(var t=[e,e+".js",e+".json",e+"/index.js",e+"/index.json"],n=0;n<t.length;n++){var e=t[n];if(require.modules.hasOwnProperty(e))return e;if(require.aliases.hasOwnProperty(e))return require.aliases[e]}},require.normalize=function(e,t){var n=[];if("."!=t.charAt(0))return t;e=e.split("/"),t=t.split("/");for(var r=0;r<t.length;++r)".."==t[r]?e.pop():"."!=t[r]&&""!=t[r]&&n.push(t[r]);return e.concat(n).join("/")},require.register=function(e,t){require.modules[e]=t},require.alias=function(e,t){if(!require.modules.hasOwnProperty(e))throw new Error('Failed to alias "'+e+'", it does not exist');require.aliases[t]=e},require.relative=function(e){function t(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}function n(t){var r=n.resolve(t);return require(r,e,t)}var r=require.normalize(e,"..");return n.resolve=function(n){var i=n.charAt(0);if("/"==i)return n.slice(1);if("."==i)return require.normalize(r,n);var o=e.split("/"),a=t(o,"deps")+1;return a||(a=0),n=o.slice(0,a+1).join("/")+"/deps/"+n},n.exists=function(e){return require.modules.hasOwnProperty(n.resolve(e))},n},require.register("chaijs-assertion-error/index.js",function(e,t,n){function r(){function e(e,n){Object.keys(n).forEach(function(r){~t.indexOf(r)||(e[r]=n[r])})}var t=[].slice.call(arguments);return function(){for(var t=[].slice.call(arguments),n=0,r={};n<t.length;n++)e(r,t[n]);return r}}function i(e,t,n){var i=r("name","message","stack","constructor","toJSON"),o=i(t||{});this.message=e||"Unspecified AssertionError",this.showDiff=!1;for(var a in o)this[a]=o[a];n=n||arguments.callee,n&&Error.captureStackTrace&&Error.captureStackTrace(this,n)}n.exports=i,i.prototype=Object.create(Error.prototype),i.prototype.name="AssertionError",i.prototype.constructor=i,i.prototype.toJSON=function(e){var t=r("constructor","toJSON","stack"),n=t({name:this.name},this);return!1!==e&&this.stack&&(n.stack=this.stack),n}}),require.register("chaijs-type-detect/lib/type.js",function(e,t,n){function r(e){var t=Object.prototype.toString.call(e);return o[t]?o[t]:null===e?"null":void 0===e?"undefined":e===Object(e)?"object":typeof e}function i(){this.tests={}}var e=n.exports=r,o={"[object Array]":"array","[object RegExp]":"regexp","[object Function]":"function","[object Arguments]":"arguments","[object Date]":"date"};e.Library=i,i.prototype.of=r,i.prototype.define=function(e,t){return 1===arguments.length?this.tests[e]:(this.tests[e]=t,this)},i.prototype.test=function(e,t){if(t===r(e))return!0;var n=this.tests[t];if(n&&"regexp"===r(n))return n.test(e);if(n&&"function"===r(n))return n(e);throw new ReferenceError('Type test "'+t+'" not defined or invalid.')}}),require.register("chaijs-deep-eql/lib/eql.js",function(e,t,n){function r(e,t,n){return i(e,t)?!0:"date"===g(e)?a(e,t):"regexp"===g(e)?s(e,t):p.isBuffer(e)?h(e,t):"arguments"===g(e)?u(e,t,n):o(e,t)?"object"!==g(e)&&"object"!==g(t)&&"array"!==g(e)&&"array"!==g(t)?i(e,t):d(e,t,n):!1}function i(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function o(e,t){return g(e)===g(t)}function a(e,t){return"date"!==g(t)?!1:i(e.getTime(),t.getTime())}function s(e,t){return"regexp"!==g(t)?!1:i(e.toString(),t.toString())}function u(e,t,n){return"arguments"!==g(t)?!1:(e=[].slice.call(e),t=[].slice.call(t),r(e,t,n))}function l(e){var t=[];for(var n in e)t.push(n);return t}function c(e,t){if(e.length!==t.length)return!1;for(var n=0,r=!0;n<e.length;n++)if(e[n]!==t[n]){r=!1;break}return r}function h(e,t){return p.isBuffer(t)?c(e,t):!1}function f(e){return null!==e&&void 0!==e}function d(e,t,n){if(!f(e)||!f(t))return!1;if(e.prototype!==t.prototype)return!1;var i;if(n){for(i=0;i<n.length;i++)if(n[i][0]===e&&n[i][1]===t||n[i][0]===t&&n[i][1]===e)return!0}else n=[];try{var o=l(e),a=l(t)}catch(s){return!1}if(o.sort(),a.sort(),!c(o,a))return!1;n.push([e,t]);var u;for(i=o.length-1;i>=0;i--)if(u=o[i],!r(e[u],t[u],n))return!1;return!0}var p,g=t("type-detect");try{p=t("buffer").Buffer}catch(m){p={},p.isBuffer=function(){return!1}}n.exports=r}),require.register("chai/index.js",function(e,t,n){n.exports=t("./lib/chai")}),require.register("chai/lib/chai.js",function(e,t,n){var r=[],e=n.exports={};e.version="1.8.1",e.AssertionError=t("assertion-error");var i=t("./chai/utils");e.use=function(e){return~r.indexOf(e)||(e(this,i),r.push(e)),this};var o=t("./chai/assertion");e.use(o);var a=t("./chai/core/assertions");e.use(a);var s=t("./chai/interface/expect");e.use(s);var u=t("./chai/interface/should");e.use(u);var l=t("./chai/interface/assert");e.use(l)}),require.register("chai/lib/chai/assertion.js",function(e,t,n){n.exports=function(e,t){function n(e,t,n){i(this,"ssfi",n||arguments.callee),i(this,"object",e),i(this,"message",t)}var r=e.AssertionError,i=t.flag;e.Assertion=n,n.includeStack=!1,n.showDiff=!0,n.addProperty=function(e,n){t.addProperty(this.prototype,e,n)},n.addMethod=function(e,n){t.addMethod(this.prototype,e,n)},n.addChainableMethod=function(e,n,r){t.addChainableMethod(this.prototype,e,n,r)},n.overwriteProperty=function(e,n){t.overwriteProperty(this.prototype,e,n)},n.overwriteMethod=function(e,n){t.overwriteMethod(this.prototype,e,n)},n.prototype.assert=function(e,o,a,s,u,l){var c=t.test(this,arguments);if(!0!==l&&(l=!1),!0!==n.showDiff&&(l=!1),!c){var o=t.getMessage(this,arguments),h=t.getActual(this,arguments);throw new r(o,{actual:h,expected:s,showDiff:l},n.includeStack?this.assert:i(this,"ssfi"))}},Object.defineProperty(n.prototype,"_obj",{get:function(){return i(this,"object")},set:function(e){i(this,"object",e)}})}}),require.register("chai/lib/chai/core/assertions.js",function(e,t,n){n.exports=function(e,t){function n(e,n){n&&_(this,"message",n),e=e.toLowerCase();var r=_(this,"object"),i=~["a","e","i","o","u"].indexOf(e.charAt(0))?"an ":"a ";this.assert(e===t.type(r),"expected #{this} to be "+i+e,"expected #{this} not to be "+i+e)}function r(){_(this,"contains",!0)}function i(e,n){n&&_(this,"message",n);var r=_(this,"object");this.assert(~r.indexOf(e),"expected #{this} to include "+t.inspect(e),"expected #{this} to not include "+t.inspect(e))}function o(){var e=_(this,"object"),t=Object.prototype.toString.call(e);this.assert("[object Arguments]"===t,"expected #{this} to be arguments but got "+t,"expected #{this} to not be arguments")}function a(e,t){t&&_(this,"message",t);var n=_(this,"object");return _(this,"deep")?this.eql(e):(this.assert(e===n,"expected #{this} to equal #{exp}","expected #{this} to not equal #{exp}",e,this._obj,!0),void 0)}function s(e,n){n&&_(this,"message",n),this.assert(t.eql(e,_(this,"object")),"expected #{this} to deeply equal #{exp}","expected #{this} to not deeply equal #{exp}",e,this._obj,!0)}function u(e,t){t&&_(this,"message",t);var n=_(this,"object");if(_(this,"doLength")){new b(n,t).to.have.property("length");var r=n.length;this.assert(r>e,"expected #{this} to have a length above #{exp} but got #{act}","expected #{this} to not have a length above #{exp}",e,r)}else this.assert(n>e,"expected #{this} to be above "+e,"expected #{this} to be at most "+e)}function l(e,t){t&&_(this,"message",t);var n=_(this,"object");if(_(this,"doLength")){new b(n,t).to.have.property("length");var r=n.length;this.assert(r>=e,"expected #{this} to have a length at least #{exp} but got #{act}","expected #{this} to have a length below #{exp}",e,r)}else this.assert(n>=e,"expected #{this} to be at least "+e,"expected #{this} to be below "+e)}function c(e,t){t&&_(this,"message",t);var n=_(this,"object");if(_(this,"doLength")){new b(n,t).to.have.property("length");var r=n.length;this.assert(e>r,"expected #{this} to have a length below #{exp} but got #{act}","expected #{this} to not have a length below #{exp}",e,r)}else this.assert(e>n,"expected #{this} to be below "+e,"expected #{this} to be at least "+e)}function h(e,t){t&&_(this,"message",t);var n=_(this,"object");if(_(this,"doLength")){new b(n,t).to.have.property("length");var r=n.length;this.assert(e>=r,"expected #{this} to have a length at most #{exp} but got #{act}","expected #{this} to have a length above #{exp}",e,r)}else this.assert(e>=n,"expected #{this} to be at most "+e,"expected #{this} to be above "+e)}function f(e,n){n&&_(this,"message",n);var r=t.getName(e);this.assert(_(this,"object")instanceof e,"expected #{this} to be an instance of "+r,"expected #{this} to not be an instance of "+r)}function d(e,n){n&&_(this,"message",n);var r=_(this,"object");this.assert(r.hasOwnProperty(e),"expected #{this} to have own property "+t.inspect(e),"expected #{this} to not have own property "+t.inspect(e))}function p(){_(this,"doLength",!0)}function g(e,t){t&&_(this,"message",t);var n=_(this,"object");new b(n,t).to.have.property("length");var r=n.length;this.assert(r==e,"expected #{this} to have a length of #{exp} but got #{act}","expected #{this} to not have a length of #{act}",e,r)}function m(e){var n,r=_(this,"object"),i=!0;if(e=e instanceof Array?e:Array.prototype.slice.call(arguments),!e.length)throw new Error("keys required");var o=Object.keys(r),a=e.length;if(i=e.every(function(e){return~o.indexOf(e)}),_(this,"negate")||_(this,"contains")||(i=i&&e.length==o.length),a>1){e=e.map(function(e){return t.inspect(e)});var s=e.pop();n=e.join(", ")+", and "+s}else n=t.inspect(e[0]);n=(a>1?"keys ":"key ")+n,n=(_(this,"contains")?"contain ":"have ")+n,this.assert(i,"expected #{this} to "+n,"expected #{this} to not "+n)}function v(e,n,r){r&&_(this,"message",r);var i=_(this,"object");new b(i,r).is.a("function");var o=!1,a=null,s=null,u=null;0===arguments.length?(n=null,e=null):e&&(e instanceof RegExp||"string"==typeof e)?(n=e,e=null):e&&e instanceof Error?(a=e,e=null,n=null):"function"==typeof e?s=(new e).name:e=null;try{i()}catch(l){if(a)return this.assert(l===a,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}",a,l),this;if(e&&(this.assert(l instanceof e,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp} but #{act} was thrown",s,l),!n))return this;var c="object"===t.type(l)&&"message"in l?l.message:""+l;if(null!=c&&n&&n instanceof RegExp)return this.assert(n.exec(c),"expected #{this} to throw error matching #{exp} but got #{act}","expected #{this} to throw error not matching #{exp}",n,c),this;if(null!=c&&n&&"string"==typeof n)return this.assert(~c.indexOf(n),"expected #{this} to throw error including #{exp} but got #{act}","expected #{this} to throw error not including #{act}",n,c),this;o=!0,u=l}var h="",f=null!==s?s:a?"#{exp}":"an error";o&&(h=" but #{act} was thrown"),this.assert(o===!0,"expected #{this} to throw "+f+h,"expected #{this} to not throw "+f+h,a,u)}function y(e,t){return e.every(function(e){return-1!==t.indexOf(e)})}var b=e.Assertion,_=(Object.prototype.toString,t.flag);["to","be","been","is","and","have","with","that","at","of","same"].forEach(function(e){b.addProperty(e,function(){return this})}),b.addProperty("not",function(){_(this,"negate",!0)}),b.addProperty("deep",function(){_(this,"deep",!0)}),b.addChainableMethod("an",n),b.addChainableMethod("a",n),b.addChainableMethod("include",i,r),b.addChainableMethod("contain",i,r),b.addProperty("ok",function(){this.assert(_(this,"object"),"expected #{this} to be truthy","expected #{this} to be falsy")}),b.addProperty("true",function(){this.assert(!0===_(this,"object"),"expected #{this} to be true","expected #{this} to be false",this.negate?!1:!0)}),b.addProperty("false",function(){this.assert(!1===_(this,"object"),"expected #{this} to be false","expected #{this} to be true",this.negate?!0:!1)}),b.addProperty("null",function(){this.assert(null===_(this,"object"),"expected #{this} to be null","expected #{this} not to be null")}),b.addProperty("undefined",function(){this.assert(void 0===_(this,"object"),"expected #{this} to be undefined","expected #{this} not to be undefined")}),b.addProperty("exist",function(){this.assert(null!=_(this,"object"),"expected #{this} to exist","expected #{this} to not exist")}),b.addProperty("empty",function(){var e=_(this,"object"),t=e;Array.isArray(e)||"string"==typeof object?t=e.length:"object"==typeof e&&(t=Object.keys(e).length),this.assert(!t,"expected #{this} to be empty","expected #{this} not to be empty")}),b.addProperty("arguments",o),b.addProperty("Arguments",o),b.addMethod("equal",a),b.addMethod("equals",a),b.addMethod("eq",a),b.addMethod("eql",s),b.addMethod("eqls",s),b.addMethod("above",u),b.addMethod("gt",u),b.addMethod("greaterThan",u),b.addMethod("least",l),b.addMethod("gte",l),b.addMethod("below",c),b.addMethod("lt",c),b.addMethod("lessThan",c),b.addMethod("most",h),b.addMethod("lte",h),b.addMethod("within",function(e,t,n){n&&_(this,"message",n);var r=_(this,"object"),i=e+".."+t;if(_(this,"doLength")){new b(r,n).to.have.property("length");var o=r.length;this.assert(o>=e&&t>=o,"expected #{this} to have a length within "+i,"expected #{this} to not have a length within "+i)}else this.assert(r>=e&&t>=r,"expected #{this} to be within "+i,"expected #{this} to not be within "+i)}),b.addMethod("instanceof",f),b.addMethod("instanceOf",f),b.addMethod("property",function(e,n,r){r&&_(this,"message",r);var i=_(this,"deep")?"deep property ":"property ",o=_(this,"negate"),a=_(this,"object"),s=_(this,"deep")?t.getPathValue(e,a):a[e];if(o&&void 0!==n){if(void 0===s)throw r=null!=r?r+": ":"",new Error(r+t.inspect(a)+" has no "+i+t.inspect(e))}else this.assert(void 0!==s,"expected #{this} to have a "+i+t.inspect(e),"expected #{this} to not have "+i+t.inspect(e));void 0!==n&&this.assert(n===s,"expected #{this} to have a "+i+t.inspect(e)+" of #{exp}, but got #{act}","expected #{this} to not have a "+i+t.inspect(e)+" of #{act}",n,s),_(this,"object",s)}),b.addMethod("ownProperty",d),b.addMethod("haveOwnProperty",d),b.addChainableMethod("length",g,p),b.addMethod("lengthOf",g,p),b.addMethod("match",function(e,t){t&&_(this,"message",t);var n=_(this,"object");this.assert(e.exec(n),"expected #{this} to match "+e,"expected #{this} not to match "+e)}),b.addMethod("string",function(e,n){n&&_(this,"message",n);var r=_(this,"object");new b(r,n).is.a("string"),this.assert(~r.indexOf(e),"expected #{this} to contain "+t.inspect(e),"expected #{this} to not contain "+t.inspect(e))}),b.addMethod("keys",m),b.addMethod("key",m),b.addMethod("throw",v),b.addMethod("throws",v),b.addMethod("Throw",v),b.addMethod("respondTo",function(e,n){n&&_(this,"message",n);var r=_(this,"object"),i=_(this,"itself"),o="function"!==t.type(r)||i?r[e]:r.prototype[e];this.assert("function"==typeof o,"expected #{this} to respond to "+t.inspect(e),"expected #{this} to not respond to "+t.inspect(e))}),b.addProperty("itself",function(){_(this,"itself",!0)}),b.addMethod("satisfy",function(e,n){n&&_(this,"message",n);var r=_(this,"object");this.assert(e(r),"expected #{this} to satisfy "+t.objDisplay(e),"expected #{this} to not satisfy"+t.objDisplay(e),this.negate?!1:!0,e(r))}),b.addMethod("closeTo",function(e,t,n){n&&_(this,"message",n);var r=_(this,"object");this.assert(Math.abs(r-e)<=t,"expected #{this} to be close to "+e+" +/- "+t,"expected #{this} not to be close to "+e+" +/- "+t)}),b.addMethod("members",function(e,t){t&&_(this,"message",t);var n=_(this,"object");return new b(n).to.be.an("array"),new b(e).to.be.an("array"),_(this,"contains")?this.assert(y(e,n),"expected #{this} to be a superset of #{act}","expected #{this} to not be a superset of #{act}",n,e):(this.assert(y(n,e)&&y(e,n),"expected #{this} to have the same members as #{act}","expected #{this} to not have the same members as #{act}",n,e),void 0)})}}),require.register("chai/lib/chai/interface/assert.js",function(exports,require,module){module.exports=function(chai,util){var Assertion=chai.Assertion,flag=util.flag,assert=chai.assert=function(e,t){var n=new Assertion(null);n.assert(e,t,"[ negation message unavailable ]")};assert.fail=function(e,t,n,r){throw new chai.AssertionError({actual:e,expected:t,message:n,operator:r,stackStartFunction:assert.fail})},assert.ok=function(e,t){new Assertion(e,t).is.ok},assert.notOk=function(e,t){new Assertion(e,t).is.not.ok},assert.equal=function(e,t,n){var r=new Assertion(e,n);r.assert(t==flag(r,"object"),"expected #{this} to equal #{exp}","expected #{this} to not equal #{act}",t,e)},assert.notEqual=function(e,t,n){var r=new Assertion(e,n);r.assert(t!=flag(r,"object"),"expected #{this} to not equal #{exp}","expected #{this} to equal #{act}",t,e)},assert.strictEqual=function(e,t,n){new Assertion(e,n).to.equal(t)},assert.notStrictEqual=function(e,t,n){new Assertion(e,n).to.not.equal(t)},assert.deepEqual=function(e,t,n){new Assertion(e,n).to.eql(t)},assert.notDeepEqual=function(e,t,n){new Assertion(e,n).to.not.eql(t)},assert.isTrue=function(e,t){new Assertion(e,t).is["true"]},assert.isFalse=function(e,t){new Assertion(e,t).is["false"]},assert.isNull=function(e,t){new Assertion(e,t).to.equal(null)},assert.isNotNull=function(e,t){new Assertion(e,t).to.not.equal(null)},assert.isUndefined=function(e,t){new Assertion(e,t).to.equal(void 0)},assert.isDefined=function(e,t){new Assertion(e,t).to.not.equal(void 0)},assert.isFunction=function(e,t){new Assertion(e,t).to.be.a("function")},assert.isNotFunction=function(e,t){new Assertion(e,t).to.not.be.a("function")},assert.isObject=function(e,t){new Assertion(e,t).to.be.a("object")},assert.isNotObject=function(e,t){new Assertion(e,t).to.not.be.a("object")},assert.isArray=function(e,t){new Assertion(e,t).to.be.an("array")},assert.isNotArray=function(e,t){new Assertion(e,t).to.not.be.an("array")},assert.isString=function(e,t){new Assertion(e,t).to.be.a("string")},assert.isNotString=function(e,t){new Assertion(e,t).to.not.be.a("string")},assert.isNumber=function(e,t){new Assertion(e,t).to.be.a("number")},assert.isNotNumber=function(e,t){new Assertion(e,t).to.not.be.a("number")},assert.isBoolean=function(e,t){new Assertion(e,t).to.be.a("boolean")},assert.isNotBoolean=function(e,t){new Assertion(e,t).to.not.be.a("boolean")},assert.typeOf=function(e,t,n){new Assertion(e,n).to.be.a(t)},assert.notTypeOf=function(e,t,n){new Assertion(e,n).to.not.be.a(t)},assert.instanceOf=function(e,t,n){new Assertion(e,n).to.be.instanceOf(t)},assert.notInstanceOf=function(e,t,n){new Assertion(e,n).to.not.be.instanceOf(t)},assert.include=function(e,t,n){var r=new Assertion(e,n);if(Array.isArray(e))r.to.include(t);else{if("string"!=typeof e)throw new chai.AssertionError("expected an array or string",null,assert.include);r.to.contain.string(t)}},assert.notInclude=function(e,t,n){var r=new Assertion(e,n);if(Array.isArray(e))r.to.not.include(t);else{if("string"!=typeof e)throw new chai.AssertionError("expected an array or string",null,assert.notInclude);r.to.not.contain.string(t)}},assert.match=function(e,t,n){new Assertion(e,n).to.match(t)},assert.notMatch=function(e,t,n){new Assertion(e,n).to.not.match(t)},assert.property=function(e,t,n){new Assertion(e,n).to.have.property(t)},assert.notProperty=function(e,t,n){new Assertion(e,n).to.not.have.property(t)},assert.deepProperty=function(e,t,n){new Assertion(e,n).to.have.deep.property(t)},assert.notDeepProperty=function(e,t,n){new Assertion(e,n).to.not.have.deep.property(t)},assert.propertyVal=function(e,t,n,r){new Assertion(e,r).to.have.property(t,n)},assert.propertyNotVal=function(e,t,n,r){new Assertion(e,r).to.not.have.property(t,n)},assert.deepPropertyVal=function(e,t,n,r){new Assertion(e,r).to.have.deep.property(t,n)},assert.deepPropertyNotVal=function(e,t,n,r){new Assertion(e,r).to.not.have.deep.property(t,n)},assert.lengthOf=function(e,t,n){new Assertion(e,n).to.have.length(t)},assert.Throw=function(e,t,n,r){("string"==typeof t||t instanceof RegExp)&&(n=t,t=null),new Assertion(e,r).to.Throw(t,n)},assert.doesNotThrow=function(e,t,n){"string"==typeof t&&(n=t,t=null),new Assertion(e,n).to.not.Throw(t)},assert.operator=function(val,operator,val2,msg){if(!~["==","===",">",">=","<","<=","!=","!=="].indexOf(operator))throw new Error('Invalid operator "'+operator+'"');var test=new Assertion(eval(val+operator+val2),msg);test.assert(!0===flag(test,"object"),"expected "+util.inspect(val)+" to be "+operator+" "+util.inspect(val2),"expected "+util.inspect(val)+" to not be "+operator+" "+util.inspect(val2))},assert.closeTo=function(e,t,n,r){new Assertion(e,r).to.be.closeTo(t,n)},assert.sameMembers=function(e,t,n){new Assertion(e,n).to.have.same.members(t)},assert.includeMembers=function(e,t,n){new Assertion(e,n).to.include.members(t)},assert.ifError=function(e,t){new Assertion(e,t).to.not.be.ok},function e(t,n){return assert[n]=assert[t],e}("Throw","throw")("Throw","throws")}}),require.register("chai/lib/chai/interface/expect.js",function(e,t,n){n.exports=function(e){e.expect=function(t,n){return new e.Assertion(t,n)}}}),require.register("chai/lib/chai/interface/should.js",function(e,t,n){n.exports=function(e){function t(){Object.defineProperty(Object.prototype,"should",{set:function(e){Object.defineProperty(this,"should",{value:e,enumerable:!0,configurable:!0,writable:!0})},get:function(){return this instanceof String||this instanceof Number?new n(this.constructor(this)):this instanceof Boolean?new n(1==this):new n(this)},configurable:!0});var e={};return e.equal=function(e,t,r){new n(e,r).to.equal(t)},e.Throw=function(e,t,r,i){new n(e,i).to.Throw(t,r)},e.exist=function(e,t){new n(e,t).to.exist},e.not={},e.not.equal=function(e,t,r){new n(e,r).to.not.equal(t)},e.not.Throw=function(e,t,r,i){new n(e,i).to.not.Throw(t,r)},e.not.exist=function(e,t){new n(e,t).to.not.exist},e["throw"]=e.Throw,e.not["throw"]=e.not.Throw,e}var n=e.Assertion;e.should=t,e.Should=t}}),require.register("chai/lib/chai/utils/addChainableMethod.js",function(e,t,n){var r=t("./transferFlags"),i="__proto__"in Object,o=/^(?:length|name|arguments|caller)$/,a=Function.prototype.call,s=Function.prototype.apply;n.exports=function(e,t,n,u){"function"!=typeof u&&(u=function(){}),Object.defineProperty(e,t,{get:function(){u.call(this);var t=function(){var e=n.apply(this,arguments);return void 0===e?this:e};if(i){var l=t.__proto__=Object.create(this);l.call=a,l.apply=s}else{var c=Object.getOwnPropertyNames(e);c.forEach(function(n){if(!o.test(n)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r)}})}return r(this,t),t},configurable:!0})}}),require.register("chai/lib/chai/utils/addMethod.js",function(e,t,n){n.exports=function(e,t,n){e[t]=function(){var e=n.apply(this,arguments);return void 0===e?this:e}}}),require.register("chai/lib/chai/utils/addProperty.js",function(e,t,n){n.exports=function(e,t,n){Object.defineProperty(e,t,{get:function(){var e=n.call(this);return void 0===e?this:e},configurable:!0})}}),require.register("chai/lib/chai/utils/flag.js",function(e,t,n){n.exports=function(e,t,n){var r=e.__flags||(e.__flags=Object.create(null));return 3!==arguments.length?r[t]:(r[t]=n,void 0)}}),require.register("chai/lib/chai/utils/getActual.js",function(e,t,n){n.exports=function(e,t){var n=t[4];return"undefined"!=typeof n?n:e._obj}}),require.register("chai/lib/chai/utils/getEnumerableProperties.js",function(e,t,n){n.exports=function(e){var t=[];for(var n in e)t.push(n);return t}}),require.register("chai/lib/chai/utils/getMessage.js",function(e,t,n){var r=t("./flag"),i=t("./getActual"),o=(t("./inspect"),t("./objDisplay"));
n.exports=function(e,t){var n=r(e,"negate"),a=r(e,"object"),s=t[3],u=i(e,t),l=n?t[2]:t[1],c=r(e,"message");return l=l||"",l=l.replace(/#{this}/g,o(a)).replace(/#{act}/g,o(u)).replace(/#{exp}/g,o(s)),c?c+": "+l:l}}),require.register("chai/lib/chai/utils/getName.js",function(e,t,n){n.exports=function(e){if(e.name)return e.name;var t=/^\s?function ([^(]*)\(/.exec(e);return t&&t[1]?t[1]:""}}),require.register("chai/lib/chai/utils/getPathValue.js",function(e,t,n){function r(e){var t=e.replace(/\[/g,".["),n=t.match(/(\\\.|[^.]+?)+/g);return n.map(function(e){var t=/\[(\d+)\]$/,n=t.exec(e);return n?{i:parseFloat(n[1])}:{p:e}})}function i(e,t){for(var n,r=t,i=0,o=e.length;o>i;i++){var a=e[i];r?("undefined"!=typeof a.p?r=r[a.p]:"undefined"!=typeof a.i&&(r=r[a.i]),i==o-1&&(n=r)):n=void 0}return n}n.exports=function(e,t){var n=r(e);return i(n,t)}}),require.register("chai/lib/chai/utils/getProperties.js",function(e,t,n){n.exports=function(){function e(e){-1===t.indexOf(e)&&t.push(e)}for(var t=Object.getOwnPropertyNames(subject),n=Object.getPrototypeOf(subject);null!==n;)Object.getOwnPropertyNames(n).forEach(e),n=Object.getPrototypeOf(n);return t}}),require.register("chai/lib/chai/utils/index.js",function(e,t,n){var e=n.exports={};e.test=t("./test"),e.type=t("./type"),e.getMessage=t("./getMessage"),e.getActual=t("./getActual"),e.inspect=t("./inspect"),e.objDisplay=t("./objDisplay"),e.flag=t("./flag"),e.transferFlags=t("./transferFlags"),e.eql=t("deep-eql"),e.getPathValue=t("./getPathValue"),e.getName=t("./getName"),e.addProperty=t("./addProperty"),e.addMethod=t("./addMethod"),e.overwriteProperty=t("./overwriteProperty"),e.overwriteMethod=t("./overwriteMethod"),e.addChainableMethod=t("./addChainableMethod")}),require.register("chai/lib/chai/utils/inspect.js",function(e,t,n){function r(e,t,n){var r={showHidden:t,seen:[],stylize:function(e){return e}};return i(r,e,"undefined"==typeof n?2:n)}function i(t,n,r){if(n&&"function"==typeof n.inspect&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var p=n.inspect(r);return"string"!=typeof p&&(p=i(t,p,r)),p}var _=o(t,n);if(_)return _;if(b(n))return y(n);var x=v(n),w=t.showHidden?m(n):x;if(0===w.length||d(n)&&(1===w.length&&"stack"===w[0]||2===w.length&&"description"===w[0]&&"stack"===w[1])){if("function"==typeof n){var T=g(n),A=T?": "+T:"";return t.stylize("[Function"+A+"]","special")}if(h(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(f(n))return t.stylize(Date.prototype.toUTCString.call(n),"date");if(d(n))return a(n)}var E="",S=!1,j=["{","}"];if(c(n)&&(S=!0,j=["[","]"]),"function"==typeof n){var T=g(n),A=T?": "+T:"";E=" [Function"+A+"]"}if(h(n)&&(E=" "+RegExp.prototype.toString.call(n)),f(n)&&(E=" "+Date.prototype.toUTCString.call(n)),d(n))return a(n);if(0===w.length&&(!S||0==n.length))return j[0]+E+j[1];if(0>r)return h(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special");t.seen.push(n);var C;return C=S?s(t,n,r,x,w):w.map(function(e){return u(t,n,r,x,e,S)}),t.seen.pop(),l(C,E,j)}function o(e,t){switch(typeof t){case"undefined":return e.stylize("undefined","undefined");case"string":var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string");case"number":return e.stylize(""+t,"number");case"boolean":return e.stylize(""+t,"boolean")}return null===t?e.stylize("null","null"):void 0}function a(e){return"["+Error.prototype.toString.call(e)+"]"}function s(e,t,n,r,i){for(var o=[],a=0,s=t.length;s>a;++a)Object.prototype.hasOwnProperty.call(t,String(a))?o.push(u(e,t,n,r,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(u(e,t,n,r,i,!0))}),o}function u(e,t,n,r,o,a){var s,u;if(t.__lookupGetter__&&(t.__lookupGetter__(o)?u=t.__lookupSetter__(o)?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.__lookupSetter__(o)&&(u=e.stylize("[Setter]","special"))),r.indexOf(o)<0&&(s="["+o+"]"),u||(e.seen.indexOf(t[o])<0?(u=null===n?i(e,t[o],null):i(e,t[o],n-1),u.indexOf("\n")>-1&&(u=a?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),"undefined"==typeof s){if(a&&o.match(/^\d+$/))return u;s=JSON.stringify(""+o),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function l(e,t,n){var r=0,i=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.length+1},0);return i>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function c(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===p(e)}function h(e){return"object"==typeof e&&"[object RegExp]"===p(e)}function f(e){return"object"==typeof e&&"[object Date]"===p(e)}function d(e){return"object"==typeof e&&"[object Error]"===p(e)}function p(e){return Object.prototype.toString.call(e)}var g=t("./getName"),m=t("./getProperties"),v=t("./getEnumerableProperties");n.exports=r;var y=function(e){if("outerHTML"in e)return e.outerHTML;var t,n="http://www.w3.org/1999/xhtml",r=document.createElementNS(n,"_"),i=((window.HTMLElement||window.Element).prototype,new XMLSerializer);return document.xmlVersion?i.serializeToString(e):(r.appendChild(e.cloneNode(!1)),t=r.innerHTML.replace("><",">"+e.innerHTML+"<"),r.innerHTML="",t)},b=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName}}),require.register("chai/lib/chai/utils/objDisplay.js",function(e,t,n){var r=t("./inspect");n.exports=function(e){var t=r(e),n=Object.prototype.toString.call(e);if(t.length>=40){if("[object Function]"===n)return e.name&&""!==e.name?"[Function: "+e.name+"]":"[Function]";if("[object Array]"===n)return"[ Array("+e.length+") ]";if("[object Object]"===n){var i=Object.keys(e),o=i.length>2?i.splice(0,2).join(", ")+", ...":i.join(", ");return"{ Object ("+o+") }"}return t}return t}}),require.register("chai/lib/chai/utils/overwriteMethod.js",function(e,t,n){n.exports=function(e,t,n){var r=e[t],i=function(){return this};r&&"function"==typeof r&&(i=r),e[t]=function(){var e=n(i).apply(this,arguments);return void 0===e?this:e}}}),require.register("chai/lib/chai/utils/overwriteProperty.js",function(e,t,n){n.exports=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t),i=function(){};r&&"function"==typeof r.get&&(i=r.get),Object.defineProperty(e,t,{get:function(){var e=n(i).call(this);return void 0===e?this:e},configurable:!0})}}),require.register("chai/lib/chai/utils/test.js",function(e,t,n){var r=t("./flag");n.exports=function(e,t){var n=r(e,"negate"),i=t[0];return n?!i:i}}),require.register("chai/lib/chai/utils/transferFlags.js",function(e,t,n){n.exports=function(e,t,n){var r=e.__flags||(e.__flags=Object.create(null));t.__flags||(t.__flags=Object.create(null)),n=3===arguments.length?n:!0;for(var i in r)(n||"object"!==i&&"ssfi"!==i&&"message"!=i)&&(t.__flags[i]=r[i])}}),require.register("chai/lib/chai/utils/type.js",function(e,t,n){var r={"[object Arguments]":"arguments","[object Array]":"array","[object Date]":"date","[object Function]":"function","[object Number]":"number","[object RegExp]":"regexp","[object String]":"string"};n.exports=function(e){var t=Object.prototype.toString.call(e);return r[t]?r[t]:null===e?"null":void 0===e?"undefined":e===Object(e)?"object":typeof e}}),require.alias("chaijs-assertion-error/index.js","chai/deps/assertion-error/index.js"),require.alias("chaijs-assertion-error/index.js","chai/deps/assertion-error/index.js"),require.alias("chaijs-assertion-error/index.js","assertion-error/index.js"),require.alias("chaijs-assertion-error/index.js","chaijs-assertion-error/index.js"),require.alias("chaijs-deep-eql/lib/eql.js","chai/deps/deep-eql/lib/eql.js"),require.alias("chaijs-deep-eql/lib/eql.js","chai/deps/deep-eql/index.js"),require.alias("chaijs-deep-eql/lib/eql.js","deep-eql/index.js"),require.alias("chaijs-type-detect/lib/type.js","chaijs-deep-eql/deps/type-detect/lib/type.js"),require.alias("chaijs-type-detect/lib/type.js","chaijs-deep-eql/deps/type-detect/index.js"),require.alias("chaijs-type-detect/lib/type.js","chaijs-type-detect/index.js"),require.alias("chaijs-deep-eql/lib/eql.js","chaijs-deep-eql/index.js"),require.alias("chai/index.js","chai/index.js"),"object"==typeof exports?module.exports=require("chai"):"function"==typeof define&&define.amd?define("chai",["chai"],function(){return require("chai")}):this.chai=require("chai")}(),define("test/mixin_spec",["require","mixin","chai"],function(e){var t=e("mixin"),n=e("chai").expect;return function(){describe("mixin",function(){var e=t(function(e){e.a=1});it("should return a mixer",function(){n(e.mix).not.to.be.undefined}),it("should mix an object",function(){var t={b:5};n(e.mix(t)).to.equal(t),n(t.a).to.equal(1)})})}}),this.sinon=function(){var buster=function(e,t){var n="function"==typeof require&&"object"==typeof module,r="undefined"!=typeof document&&document.createElement("div"),i=function(){},o={bind:function(e,t){var n="string"==typeof t?e[t]:t,r=Array.prototype.slice.call(arguments,2);return function(){var t=r.concat(Array.prototype.slice.call(arguments));return n.apply(e,t)}},partial:function(e){var t=[].slice.call(arguments,1);return function(){return e.apply(this,t.concat([].slice.call(arguments)))}},create:function(e){return i.prototype=e,new i},extend:function(e){if(e){for(var t,n=1,r=arguments.length;r>n;++n)for(t in arguments[n])e[t]=arguments[n][t];return e}},nextTick:function(t){return"undefined"!=typeof process&&process.nextTick?process.nextTick(t):(e(t,0),void 0)},functionName:function(e){if(!e)return"";if(e.displayName)return e.displayName;if(e.name)return e.name;var t=e.toString().match(/function\s+([^\(]+)/m);return t&&t[1]||""},isNode:function(e){if(!r)return!1;try{e.appendChild(r),e.removeChild(r)}catch(t){return!1}return!0},isElement:function(e){return e&&1===e.nodeType&&o.isNode(e)},isArray:function(e){return"[object Array]"==Object.prototype.toString.call(e)},flatten:function u(e){for(var t=[],e=e||[],n=0,r=e.length;r>n;++n)t=t.concat(o.isArray(e[n])?u(e[n]):e[n]);return t},each:function(e,t){for(var n=0,r=e.length;r>n;++n)t(e[n])},map:function(e,t){for(var n=[],r=0,i=e.length;i>r;++r)n.push(t(e[r]));return n},parallel:function(e,t){function n(e,n){"function"==typeof t&&(t(e,n),t=null)}function r(e){return function(t,r){return t?n(t):(o[e]=r,0==--i&&n(null,o),void 0)}}if(0==e.length)return n(null,[]);for(var i=e.length,o=[],a=0,s=e.length;s>a;++a)e[a](r(a))},series:function(e,t){function n(e,n){"function"==typeof t&&t(e,n)}function r(){if(0==a.length)return n(null,s);var e=a.shift()(i);e&&"function"==typeof e.then&&e.then(o.partial(i,null),i)}function i(e,t){return e?n(e):(s.push(t),r(),void 0)}var a=e.slice(),s=[];r()},countdown:function(e,t){return function(){0==--e&&t()}}};if("object"==typeof process&&"function"==typeof require&&"object"==typeof module){var a=require("crypto"),s=require("path");o.tmpFile=function(e){var t=a.createHash("sha1");t.update(e);var n=t.digest("hex");return"win32"==process.platform?s.join(process.env.TEMP,n):s.join("/tmp",n)}}return o.some=Array.prototype.some?function(e,t,n){return e.some(t,n)}:function(e,t,n){if(null==e)throw new TypeError;e=Object(e);var r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=0;r>i;i++)if(e.hasOwnProperty(i)&&t.call(n,e[i],i,e))return!0;return!1},o.filter=Array.prototype.filter?function(e,t,n){return e.filter(t,n)}:function(e,t){if(null==this)throw new TypeError;var n=Object(this),r=n.length>>>0;if("function"!=typeof e)throw new TypeError;for(var i=[],o=0;r>o;o++)if(o in n){var a=n[o];e.call(t,a,o,n)&&i.push(a)}return i},n&&(module.exports=o,o.eventEmitter=require("./buster-event-emitter"),Object.defineProperty(o,"defineVersionGetter",{get:function(){return require("./define-version-getter")}})),o.extend(t||{},o)}(setTimeout,buster);if("undefined"==typeof buster)var buster={};"object"==typeof module&&"function"==typeof require&&(buster=require("buster-core")),buster.format=buster.format||{},buster.format.excludeConstructors=["Object",/^.$/],buster.format.quoteStrings=!0,buster.format.ascii=function(){function e(e){var t=Object.keys&&Object.keys(e)||[];if(0==t.length)for(var n in e)r.call(e,n)&&t.push(n);return t.sort()}function t(e,t){if("object"!=typeof e)return!1;for(var n=0,r=t.length;r>n;++n)if(t[n]===e)return!0;return!1}function n(e,r,o){if("string"==typeof e){var a="boolean"!=typeof this.quoteStrings||this.quoteStrings;return r||a?'"'+e+'"':e}if("function"==typeof e&&!(e instanceof RegExp))return n.func(e);if(r=r||[],t(e,r))return"[Circular]";if("[object Array]"==Object.prototype.toString.call(e))return n.array.call(this,e,r);if(!e)return""+e;if(buster.isElement(e))return n.element(e);if("function"==typeof e.toString&&e.toString!==Object.prototype.toString)return e.toString();for(var s=0,u=i.length;u>s;s++)if(e===i[s].obj)return i[s].value;return n.object.call(this,e,r,o)}var r=Object.prototype.hasOwnProperty,i=[];return"undefined"!=typeof global&&i.push({obj:global,value:"[object global]"}),"undefined"!=typeof document&&i.push({obj:document,value:"[object HTMLDocument]"}),"undefined"!=typeof window&&i.push({obj:window,value:"[object Window]"}),n.func=function(e){return"function "+buster.functionName(e)+"() {}"},n.array=function(e,t){t=t||[],t.push(e);for(var r=[],i=0,o=e.length;o>i;++i)r.push(n.call(this,e[i],t));return"["+r.join(", ")+"]"},n.object=function(r,i,o){i=i||[],i.push(r),o=o||0;for(var a,s,u,l=[],c=e(r),h="",f=3,d=0,p=o;p>d;++d)h+=" ";for(d=0,p=c.length;p>d;++d)a=c[d],u=r[a],s=t(u,i)?"[Circular]":n.call(this,u,i,o+2),s=(/\s/.test(a)?'"'+a+'"':a)+": "+s,f+=s.length,l.push(s);var g=n.constructorName.call(this,r),m=g?"["+g+"] ":"";return f+o>80?m+"{\n  "+h+l.join(",\n  "+h)+"\n"+h+"}":m+"{ "+l.join(", ")+" }"},n.element=function(e){for(var t,n,r=e.tagName.toLowerCase(),i=e.attributes,o=[],a=0,s=i.length;s>a;++a)t=i.item(a),n=t.nodeName.toLowerCase().replace("html:",""),("contenteditable"!=n||"inherit"!=t.nodeValue)&&t.nodeValue&&o.push(n+'="'+t.nodeValue+'"');var u="<"+r+(o.length>0?" ":""),l=e.innerHTML;l.length>20&&(l=l.substr(0,20)+"[...]");var c=u+o.join(" ")+">"+l+"</"+r+">";return c.replace(/ contentEditable="inherit"/,"")},n.constructorName=function(e){for(var t=buster.functionName(e&&e.constructor),n=this.excludeConstructors||buster.format.excludeConstructors||[],r=0,i=n.length;i>r;++r){if("string"==typeof n[r]&&n[r]==t)return"";if(n[r].test&&n[r].test(t))return""}return t},n}(),"undefined"!=typeof module&&(module.exports=buster.format);var sinon=function(e){function t(e){var t=!1;try{e.appendChild(a),t=a.parentNode==e}catch(n){return!1}finally{try{e.removeChild(a)}catch(n){}}return t}function n(e){return a&&e&&1===e.nodeType&&t(e)}function r(e){return"function"==typeof e||!!(e&&e.constructor&&e.call&&e.apply)}function i(e,t){for(var n in t)s.call(e,n)||(e[n]=t[n])}function o(e){return"function"==typeof e&&"function"==typeof e.restore&&e.restore.sinon}var a="undefined"!=typeof document&&document.createElement("div"),s=Object.prototype.hasOwnProperty,u={wrapMethod:function(e,t,n){if(!e)throw new TypeError("Should wrap property of object");if("function"!=typeof n)throw new TypeError("Method wrapper should be function");var o=e[t];if(!r(o))throw new TypeError("Attempted to wrap "+typeof o+" property "+t+" as function");if(o.restore&&o.restore.sinon)throw new TypeError("Attempted to wrap "+t+" which is already wrapped");if(o.calledBefore){var a=o.returns?"stubbed":"spied on";throw new TypeError("Attempted to wrap "+t+" which is already "+a)}var u=s.call(e,t);return e[t]=n,n.displayName=t,n.restore=function(){u||delete e[t],e[t]===n&&(e[t]=o)},n.restore.sinon=!0,i(n,o),n},extend:function(e){for(var t=1,n=arguments.length;n>t;t+=1)for(var r in arguments[t])arguments[t].hasOwnProperty(r)&&(e[r]=arguments[t][r]),arguments[t].hasOwnProperty("toString")&&arguments[t].toString!=e.toString&&(e.toString=arguments[t].toString);return e},create:function(e){var t=function(){};return t.prototype=e,new t},deepEqual:function d(e,t){if(u.match&&u.match.isMatcher(e))return e.test(t);if("object"!=typeof e||"object"!=typeof t)return e===t;if(n(e)||n(t))return e===t;if(e===t)return!0;if(null===e&&null!==t||null!==e&&null===t)return!1;var r=Object.prototype.toString.call(e);if(r!=Object.prototype.toString.call(t))return!1;if("[object Array]"==r){if(e.length!==t.length)return!1;for(var i=0,o=e.length;o>i;i+=1)if(!d(e[i],t[i]))return!1;return!0}if("[object Date]"==r)return e.valueOf()===t.valueOf();var a,s=0,l=0;for(a in e)if(s+=1,!d(e[a],t[a]))return!1;for(a in t)l+=1;return s==l},functionName:function(e){var t=e.displayName||e.name;if(!t){var n=e.toString().match(/function ([^\s\(]+)/);t=n&&n[1]}return t},functionToString:function(){if(this.getCall&&this.callCount)for(var e,t,n=this.callCount;n--;){e=this.getCall(n).thisValue;for(t in e)if(e[t]===this)return t}return this.displayName||"sinon fake"},getConfig:function(e){var t={};e=e||{};var n=u.defaultConfig;for(var r in n)n.hasOwnProperty(r)&&(t[r]=e.hasOwnProperty(r)?e[r]:n[r]);return t},format:function(e){return""+e},defaultConfig:{injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},timesInWords:function(e){return 1==e&&"once"||2==e&&"twice"||3==e&&"thrice"||(e||0)+" times"},calledInOrder:function(e){for(var t=1,n=e.length;n>t;t++)if(!e[t-1].calledBefore(e[t])||!e[t].called)return!1;return!0},orderByFirstCall:function(e){return e.sort(function(e,t){var n=e.getCall(0),r=t.getCall(0),i=n&&n.callId||-1,o=r&&r.callId||-1;return o>i?-1:1})},log:function(){},logError:function(e,t){var n=e+" threw exception: ";u.log(n+"["+t.name+"] "+t.message),t.stack&&u.log(t.stack),setTimeout(function(){throw t.message=n+t.message,t},0)},typeOf:function(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()},createStubInstance:function(e){if("function"!=typeof e)throw new TypeError("The constructor should be a function.");return u.stub(u.create(e.prototype))},restore:function(e){if(null!==e&&"object"==typeof e)for(var t in e)o(e[t])&&e[t].restore();else o(e)&&e.restore()}},l="object"==typeof module&&"function"==typeof require;if(l){try{e={format:require("buster-format")}}catch(c){}module.exports=u,module.exports.spy=require("./sinon/spy"),module.exports.stub=require("./sinon/stub"),module.exports.mock=require("./sinon/mock"),module.exports.collection=require("./sinon/collection"),module.exports.assert=require("./sinon/assert"),module.exports.sandbox=require("./sinon/sandbox"),module.exports.test=require("./sinon/test"),module.exports.testCase=require("./sinon/test_case"),module.exports.assert=require("./sinon/assert"),module.exports.match=require("./sinon/match")}if(e){var h=u.create(e.format);h.quoteStrings=!1,u.format=function(){return h.ascii.apply(h,arguments)}}else if(l)try{var f=require("util");u.format=function(e){return"object"==typeof e&&e.toString===Object.prototype.toString?f.inspect(e):e}}catch(c){}return u}("object"==typeof buster&&buster);!function(e){function t(t,n,r){var i=e.typeOf(t);if(i!==n)throw new TypeError("Expected type of "+r+" to be "+n+", but was "+i)}function n(e){return a.isPrototypeOf(e)}function r(t,n){if(null===n||void 0===n)return!1;for(var i in t)if(t.hasOwnProperty(i)){var o=t[i],a=n[i];if(s.isMatcher(o)){if(!o.test(a))return!1}else if("object"===e.typeOf(o)){if(!r(o,a))return!1}else if(!e.deepEqual(o,a))return!1}return!0}function i(n,r){return function(i,o){t(i,"string","property");var a=1===arguments.length,u=r+'("'+i+'"';return a||(u+=", "+o),u+=")",s(function(t){return void 0!==t&&null!==t&&n(t,i)?a||e.deepEqual(o,t[i]):!1},u)}}var o="object"==typeof module&&"function"==typeof require;if(!e&&o&&(e=require("../sinon")),e){var a={toString:function(){return this.message}};a.or=function(t){if(!n(t))throw new TypeError("Matcher expected");var r=this,i=e.create(a);return i.test=function(e){return r.test(e)||t.test(e)},i.message=r.message+".or("+t.message+")",i},a.and=function(t){if(!n(t))throw new TypeError("Matcher expected");var r=this,i=e.create(a);return i.test=function(e){return r.test(e)&&t.test(e)},i.message=r.message+".and("+t.message+")",i};var s=function(t,n){var i=e.create(a),o=e.typeOf(t);switch(o){case"object":if("function"==typeof t.test)return i.test=function(e){return t.test(e)===!0},i.message="match("+e.functionName(t.test)+")",i;var s=[];for(var u in t)t.hasOwnProperty(u)&&s.push(u+": "+t[u]);i.test=function(e){return r(t,e)},i.message="match("+s.join(", ")+")";break;case"number":i.test=function(e){return t==e};break;case"string":i.test=function(e){return"string"!=typeof e?!1:-1!==e.indexOf(t)},i.message='match("'+t+'")';break;case"regexp":i.test=function(e){return"string"!=typeof e?!1:t.test(e)};break;case"function":i.test=t,i.message=n?n:"match("+e.functionName(t)+")";break;default:i.test=function(n){return e.deepEqual(t,n)}}return i.message||(i.message="match("+t+")"),i};s.isMatcher=n,s.any=s(function(){return!0},"any"),s.defined=s(function(e){return null!==e&&void 0!==e},"defined"),s.truthy=s(function(e){return!!e},"truthy"),s.falsy=s(function(e){return!e},"falsy"),s.same=function(e){return s(function(t){return e===t},"same("+e+")")},s.typeOf=function(n){return t(n,"string","type"),s(function(t){return e.typeOf(t)===n},'typeOf("'+n+'")')},s.instanceOf=function(n){return t(n,"function","type"),s(function(e){return e instanceof n},"instanceOf("+e.functionName(n)+")")},s.has=i(function(e,t){return"object"==typeof e?t in e:void 0!==e[t]},"has"),s.hasOwn=i(function(e,t){return e.hasOwnProperty(t)},"hasOwn"),s.bool=s.typeOf("boolean"),s.number=s.typeOf("number"),s.string=s.typeOf("string"),s.object=s.typeOf("object"),s.func=s.typeOf("function"),s.array=s.typeOf("array"),s.regexp=s.typeOf("regexp"),s.date=s.typeOf("date"),o?module.exports=s:e.match=s}}("object"==typeof sinon&&sinon||null);var commonJSModule="object"==typeof module&&"function"==typeof require;if(!this.sinon&&commonJSModule)var sinon=require("../sinon");if(function(e){function t(t,n,i){var o=e.functionName(t)+n;throw i.length&&(o+=" Received ["+r.call(i).join(", ")+"]"),new Error(o)}function n(t,n,r,o,a,s){if("number"!=typeof s)throw new TypeError("Call id is not a number");var u=e.create(i);return u.proxy=t,u.thisValue=n,u.args=r,u.returnValue=o,u.exception=a,u.callId=s,u}var r=Array.prototype.slice,i={calledOn:function(t){return e.match&&e.match.isMatcher(t)?t.test(this.thisValue):this.thisValue===t},calledWith:function(){for(var t=0,n=arguments.length;n>t;t+=1)if(!e.deepEqual(arguments[t],this.args[t]))return!1;return!0},calledWithMatch:function(){for(var t=0,n=arguments.length;n>t;t+=1){var r=this.args[t],i=arguments[t];if(!e.match||!e.match(i).test(r))return!1}return!0},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function(){return!this.calledWithMatch.apply(this,arguments)},returned:function(t){return e.deepEqual(t,this.returnValue)},threw:function(e){return"undefined"!=typeof e&&this.exception?this.exception===e||this.exception.name===e:!!this.exception},calledWithNew:function(){return this.thisValue instanceof this.proxy},calledBefore:function(e){return this.callId<e.callId},calledAfter:function(e){return this.callId>e.callId},callArg:function(e){this.args[e]()},callArgOn:function(e,t){this.args[e].apply(t)},callArgWith:function(e){this.callArgOnWith.apply(this,[e,null].concat(r.call(arguments,1)))},callArgOnWith:function(e,t){var n=r.call(arguments,2);this.args[e].apply(t,n)},yield:function(){this.yieldOn.apply(this,[null].concat(r.call(arguments,0)))},yieldOn:function(e){for(var n=this.args,i=0,o=n.length;o>i;++i)if("function"==typeof n[i])return n[i].apply(e,r.call(arguments,1)),void 0;t(this.proxy," cannot yield since no callback was passed.",n)},yieldTo:function(e){this.yieldToOn.apply(this,[e,null].concat(r.call(arguments,1)))},yieldToOn:function(e,n){for(var i=this.args,o=0,a=i.length;a>o;++o)if(i[o]&&"function"==typeof i[o][e])return i[o][e].apply(n,r.call(arguments,2)),void 0;t(this.proxy," cannot yield to '"+e+"' since no callback was passed.",i)},toString:function(){for(var t=this.proxy.toString()+"(",n=[],r=0,i=this.args.length;i>r;++r)n.push(e.format(this.args[r]));return t=t+n.join(", ")+")","undefined"!=typeof this.returnValue&&(t+=" => "+e.format(this.returnValue)),this.exception&&(t+=" !"+this.exception.name,this.exception.message&&(t+="("+this.exception.message+")")),t}};i.invokeCallback=i.yield,n.toString=i.toString,e.spyCall=n}("object"==typeof sinon&&sinon||null),function(sinon){function spy(e,t){if(!t&&"function"==typeof e)return spy.create(e);if(!e&&!t)return spy.create(function(){});var n=e[t];return sinon.wrapMethod(e,t,spy.create(n))}function matchingFake(e,t,n){if(e)for(var r=(t.length,0),i=e.length;i>r;r++)if(e[r].matches(t,n))return e[r]}function incrementCallCount(){this.called=!0,this.callCount+=1,this.notCalled=!1,this.calledOnce=1==this.callCount,this.calledTwice=2==this.callCount,this.calledThrice=3==this.callCount}function createCallProperties(){this.firstCall=this.getCall(0),this.secondCall=this.getCall(1),this.thirdCall=this.getCall(2),this.lastCall=this.getCall(this.callCount-1)}function createProxy(func){var p;return func.length?eval("p = (function proxy("+vars.substring(0,2*func.length-1)+") { return p.invoke(func, this, slice.call(arguments)); });"):p=function(){return p.invoke(func,this,slice.call(arguments))},p}function delegateToCalls(e,t,n,r){spyApi[e]=function(){if(!this.called)return r?r.apply(this,arguments):!1;for(var i,o=0,a=0,s=this.callCount;s>a;a+=1)if(i=this.getCall(a),i[n||e].apply(i,arguments)&&(o+=1,t))return!0;return o===this.callCount}}var commonJSModule="object"==typeof module&&"function"==typeof require,push=Array.prototype.push,slice=Array.prototype.slice,callId=0,vars="a,b,c,d,e,f,g,h,i,j,k,l",uuid=0,spyApi={reset:function(){if(this.called=!1,this.notCalled=!0,this.calledOnce=!1,this.calledTwice=!1,this.calledThrice=!1,this.callCount=0,this.firstCall=null,this.secondCall=null,this.thirdCall=null,this.lastCall=null,this.args=[],this.returnValues=[],this.thisValues=[],this.exceptions=[],this.callIds=[],this.fakes)for(var e=0;e<this.fakes.length;e++)this.fakes[e].reset()},create:function(e){var t;"function"!=typeof e?e=function(){}:t=sinon.functionName(e);var n=createProxy(e);return sinon.extend(n,spy),delete n.create,sinon.extend(n,e),n.reset(),n.prototype=e.prototype,n.displayName=t||"spy",n.toString=sinon.functionToString,n._create=sinon.spy.create,n.id="spy#"+uuid++,n},invoke:function(e,t,n){var r,i,o=matchingFake(this.fakes,n);incrementCallCount.call(this),push.call(this.thisValues,t),push.call(this.args,n),push.call(this.callIds,callId++);try{i=o?o.invoke(e,t,n):(this.func||e).apply(t,n)}catch(a){throw push.call(this.returnValues,void 0),r=a,a}finally{push.call(this.exceptions,r)}return push.call(this.returnValues,i),createCallProperties.call(this),i},getCall:function(e){return 0>e||e>=this.callCount?null:sinon.spyCall(this,this.thisValues[e],this.args[e],this.returnValues[e],this.exceptions[e],this.callIds[e])},calledBefore:function(e){return this.called?e.called?this.callIds[0]<e.callIds[e.callIds.length-1]:!0:!1},calledAfter:function(e){return this.called&&e.called?this.callIds[this.callCount-1]>e.callIds[e.callCount-1]:!1},withArgs:function(){var e=slice.call(arguments);if(this.fakes){var t=matchingFake(this.fakes,e,!0);if(t)return t}else this.fakes=[];var n=this,r=this._create();r.matchingAguments=e,push.call(this.fakes,r),r.withArgs=function(){return n.withArgs.apply(n,arguments)};for(var i=0;i<this.args.length;i++)r.matches(this.args[i])&&(incrementCallCount.call(r),push.call(r.thisValues,this.thisValues[i]),push.call(r.args,this.args[i]),push.call(r.returnValues,this.returnValues[i]),push.call(r.exceptions,this.exceptions[i]),push.call(r.callIds,this.callIds[i]));return createCallProperties.call(r),r},matches:function(e,t){var n=this.matchingAguments;return n.length<=e.length&&sinon.deepEqual(n,e.slice(0,n.length))?!t||n.length==e.length:void 0},printf:function(e){var t,n=this,r=slice.call(arguments,1);return(e||"").replace(/%(.)/g,function(e,i){return t=spyApi.formatters[i],"function"==typeof t?t.call(null,n,r):isNaN(parseInt(i),10)?"%"+i:sinon.format(r[i-1])})}};delegateToCalls("calledOn",!0),delegateToCalls("alwaysCalledOn",!1,"calledOn"),delegateToCalls("calledWith",!0),delegateToCalls("calledWithMatch",!0),delegateToCalls("alwaysCalledWith",!1,"calledWith"),delegateToCalls("alwaysCalledWithMatch",!1,"calledWithMatch"),delegateToCalls("calledWithExactly",!0),delegateToCalls("alwaysCalledWithExactly",!1,"calledWithExactly"),delegateToCalls("neverCalledWith",!1,"notCalledWith",function(){return!0}),delegateToCalls("neverCalledWithMatch",!1,"notCalledWithMatch",function(){return!0}),delegateToCalls("threw",!0),delegateToCalls("alwaysThrew",!1,"threw"),delegateToCalls("returned",!0),delegateToCalls("alwaysReturned",!1,"returned"),delegateToCalls("calledWithNew",!0),delegateToCalls("alwaysCalledWithNew",!1,"calledWithNew"),delegateToCalls("callArg",!1,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),spyApi.callArgWith=spyApi.callArg,delegateToCalls("callArgOn",!1,"callArgOnWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),spyApi.callArgOnWith=spyApi.callArgOn,delegateToCalls("yield",!1,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),spyApi.invokeCallback=spyApi.yield,delegateToCalls("yieldOn",!1,"yieldOn",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),delegateToCalls("yieldTo",!1,"yieldTo",function(e){throw new Error(this.toString()+" cannot yield to '"+e+"' since it was not yet invoked.")}),delegateToCalls("yieldToOn",!1,"yieldToOn",function(e){throw new Error(this.toString()+" cannot yield to '"+e+"' since it was not yet invoked.")}),spyApi.formatters={c:function(e){return sinon.timesInWords(e.callCount)},n:function(e){return e.toString()},C:function(e){for(var t=[],n=0,r=e.callCount;r>n;++n){var i="    "+e.getCall(n).toString();/\n/.test(t[n-1])&&(i="\n"+i),push.call(t,i)}return t.length>0?"\n"+t.join("\n"):""},t:function(e){for(var t=[],n=0,r=e.callCount;r>n;++n)push.call(t,sinon.format(e.thisValues[n]));return t.join(", ")},"*":function(e,t){for(var n=[],r=0,i=t.length;i>r;++r)push.call(n,sinon.format(t[r]));return n.join(", ")}},sinon.extend(spy,spyApi),spy.spyCall=sinon.spyCall,commonJSModule?module.exports=spy:sinon.spy=spy}("object"==typeof sinon&&sinon||null),function(e){function t(n,r,i){if(i&&"function"!=typeof i)throw new TypeError("Custom stub should be function");var o;if(o=i?e.spy&&e.spy.create?e.spy.create(i):i:t.create(),!n&&!r)return e.stub.create();if(!r&&n&&"object"==typeof n){for(var a in n)"function"==typeof n[a]&&t(n,a);return n}return e.wrapMethod(n,r,o)}function n(e,t){var n=e.callCount-1,r=e[t],i=n in r?r[n]:r[r.length-1];return e[t+"Last"]=i,i}function r(e,t){var r=n(e,"callArgAts");if(0>r){for(var i=n(e,"callArgProps"),o=0,a=t.length;a>o;++o){if(!i&&"function"==typeof t[o])return t[o];if(i&&t[o]&&"function"==typeof t[o][i])return t[o][i]}return null}return t[r]}function i(t,n,r){if(t.callArgAtsLast<0){var i;return i=t.callArgPropsLast?e.functionName(t)+" expected to yield to '"+t.callArgPropsLast+"', but no object with such a property was passed.":e.functionName(t)+" expected to yield, but no callback was passed.",r.length>0&&(i+=" Received ["+s.call(r,", ")+"]"),i}return"argument at index "+t.callArgAtsLast+" is not a function: "+n}function o(e,t){if(e.callArgAts.length>0){var o=r(e,t);
if("function"!=typeof o)throw new TypeError(i(e,o,t));var a=n(e,"callbackArguments"),s=n(e,"callbackContexts");e.callbackAsync?u(function(){o.apply(s,a)}):o.apply(s,a)}}var a="object"==typeof module&&"function"==typeof require;if(!e&&a&&(e=require("../sinon")),e){var s=Array.prototype.join,u=function(){return"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(e){setTimeout(e,0)}}(),l=0;e.extend(t,function(){function n(e,t){return"string"==typeof e?(this.exception=new Error(t||""),this.exception.name=e):this.exception=e?e:new Error("Error"),this}var r,i=Array.prototype.slice;r={create:function(){var n=function(){if(o(n,arguments),n.exception)throw n.exception;return"number"==typeof n.returnArgAt?arguments[n.returnArgAt]:n.returnThis?this:n.returnValue};n.id="stub#"+l++;var r=n;return n=e.spy.create(n),n.func=r,n.callArgAts=[],n.callbackArguments=[],n.callbackContexts=[],n.callArgProps=[],e.extend(n,t),n._create=e.stub.create,n.displayName="stub",n.toString=e.functionToString,n},resetBehavior:function(){var e;if(this.callArgAts=[],this.callbackArguments=[],this.callbackContexts=[],this.callArgProps=[],delete this.returnValue,delete this.returnArgAt,this.returnThis=!1,this.fakes)for(e=0;e<this.fakes.length;e++)this.fakes[e].resetBehavior()},returns:function(e){return this.returnValue=e,this},returnsArg:function(e){if("number"!=typeof e)throw new TypeError("argument index is not number");return this.returnArgAt=e,this},returnsThis:function(){return this.returnThis=!0,this},"throws":n,throwsException:n,callsArg:function(e){if("number"!=typeof e)throw new TypeError("argument index is not number");return this.callArgAts.push(e),this.callbackArguments.push([]),this.callbackContexts.push(void 0),this.callArgProps.push(void 0),this},callsArgOn:function(e,t){if("number"!=typeof e)throw new TypeError("argument index is not number");if("object"!=typeof t)throw new TypeError("argument context is not an object");return this.callArgAts.push(e),this.callbackArguments.push([]),this.callbackContexts.push(t),this.callArgProps.push(void 0),this},callsArgWith:function(e){if("number"!=typeof e)throw new TypeError("argument index is not number");return this.callArgAts.push(e),this.callbackArguments.push(i.call(arguments,1)),this.callbackContexts.push(void 0),this.callArgProps.push(void 0),this},callsArgOnWith:function(e,t){if("number"!=typeof e)throw new TypeError("argument index is not number");if("object"!=typeof t)throw new TypeError("argument context is not an object");return this.callArgAts.push(e),this.callbackArguments.push(i.call(arguments,2)),this.callbackContexts.push(t),this.callArgProps.push(void 0),this},yields:function(){return this.callArgAts.push(-1),this.callbackArguments.push(i.call(arguments,0)),this.callbackContexts.push(void 0),this.callArgProps.push(void 0),this},yieldsOn:function(e){if("object"!=typeof e)throw new TypeError("argument context is not an object");return this.callArgAts.push(-1),this.callbackArguments.push(i.call(arguments,1)),this.callbackContexts.push(e),this.callArgProps.push(void 0),this},yieldsTo:function(e){return this.callArgAts.push(-1),this.callbackArguments.push(i.call(arguments,1)),this.callbackContexts.push(void 0),this.callArgProps.push(e),this},yieldsToOn:function(e,t){if("object"!=typeof t)throw new TypeError("argument context is not an object");return this.callArgAts.push(-1),this.callbackArguments.push(i.call(arguments,2)),this.callbackContexts.push(t),this.callArgProps.push(e),this}};for(var a in r)r.hasOwnProperty(a)&&a.match(/^(callsArg|yields|thenYields$)/)&&!a.match(/Async/)&&(r[a+"Async"]=function(e){return function(){return this.callbackAsync=!0,this[e].apply(this,arguments)}}(a));return r}()),a?module.exports=t:e.stub=t}}("object"==typeof sinon&&sinon||null),function(e){function t(n){return n?t.create(n):e.expectation.create("Anonymous mock")}var n="object"==typeof module&&"function"==typeof require,r=[].push;if(!e&&n&&(e=require("../sinon")),e){e.mock=t,e.extend(t,function(){function n(e,t){if(e)for(var n=0,r=e.length;r>n;n+=1)t(e[n])}return{create:function(n){if(!n)throw new TypeError("object is null");var r=e.extend({},t);return r.object=n,delete r.create,r},expects:function(t){if(!t)throw new TypeError("method is falsy");if(this.expectations||(this.expectations={},this.proxies=[]),!this.expectations[t]){this.expectations[t]=[];var n=this;e.wrapMethod(this.object,t,function(){return n.invokeMethod(t,this,arguments)}),r.call(this.proxies,t)}var i=e.expectation.create(t);return r.call(this.expectations[t],i),i},restore:function(){var e=this.object;n(this.proxies,function(t){"function"==typeof e[t].restore&&e[t].restore()})},verify:function(){var t=this.expectations||{},i=[],o=[];return n(this.proxies,function(e){n(t[e],function(e){e.met()?r.call(o,e.toString()):r.call(i,e.toString())})}),this.restore(),i.length>0?e.expectation.fail(i.concat(o).join("\n")):e.expectation.pass(i.concat(o).join("\n")),!0},invokeMethod:function(t,n,i){var o,a=this.expectations&&this.expectations[t],s=a&&a.length||0;for(o=0;s>o;o+=1)if(!a[o].met()&&a[o].allowsCall(n,i))return a[o].apply(n,i);var u,l=[],c=0;for(o=0;s>o;o+=1)a[o].allowsCall(n,i)?u=u||a[o]:c+=1,r.call(l,"    "+a[o].toString());return 0===c?u.apply(n,i):(l.unshift("Unexpected call: "+e.spyCall.toString.call({proxy:t,args:i})),e.expectation.fail(l.join("\n")),void 0)}}}());var i=e.timesInWords;e.expectation=function(){function t(e){return 0==e?"never called":"called "+i(e)}function n(e){var t=e.minCalls,n=e.maxCalls;if("number"==typeof t&&"number"==typeof n){var r=i(t);return t!=n&&(r="at least "+r+" and at most "+i(n)),r}return"number"==typeof t?"at least "+i(t):"at most "+i(n)}function o(e){var t="number"==typeof e.minCalls;return!t||e.callCount>=e.minCalls}function a(e){return"number"!=typeof e.maxCalls?!1:e.callCount==e.maxCalls}var s=Array.prototype.slice,u=e.spy.invoke;return{minCalls:1,maxCalls:1,create:function(t){var n=e.extend(e.stub.create(),e.expectation);return delete n.create,n.method=t,n},invoke:function(e,t,n){return this.verifyCallAllowed(t,n),u.apply(this,arguments)},atLeast:function(e){if("number"!=typeof e)throw new TypeError("'"+e+"' is not number");return this.limitsSet||(this.maxCalls=null,this.limitsSet=!0),this.minCalls=e,this},atMost:function(e){if("number"!=typeof e)throw new TypeError("'"+e+"' is not number");return this.limitsSet||(this.minCalls=null,this.limitsSet=!0),this.maxCalls=e,this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(e){if("number"!=typeof e)throw new TypeError("'"+e+"' is not a number");return this.atLeast(e),this.atMost(e)},met:function(){return!this.failed&&o(this)},verifyCallAllowed:function(t,n){if(a(this)&&(this.failed=!0,e.expectation.fail(this.method+" already called "+i(this.maxCalls))),"expectedThis"in this&&this.expectedThis!==t&&e.expectation.fail(this.method+" called with "+t+" as thisValue, expected "+this.expectedThis),"expectedArguments"in this){n||e.expectation.fail(this.method+" received no arguments, expected "+e.format(this.expectedArguments)),n.length<this.expectedArguments.length&&e.expectation.fail(this.method+" received too few arguments ("+e.format(n)+"), expected "+e.format(this.expectedArguments)),this.expectsExactArgCount&&n.length!=this.expectedArguments.length&&e.expectation.fail(this.method+" received too many arguments ("+e.format(n)+"), expected "+e.format(this.expectedArguments));for(var r=0,o=this.expectedArguments.length;o>r;r+=1)e.deepEqual(this.expectedArguments[r],n[r])||e.expectation.fail(this.method+" received wrong arguments "+e.format(n)+", expected "+e.format(this.expectedArguments))}},allowsCall:function(t,n){if(this.met()&&a(this))return!1;if("expectedThis"in this&&this.expectedThis!==t)return!1;if(!("expectedArguments"in this))return!0;if(n=n||[],n.length<this.expectedArguments.length)return!1;if(this.expectsExactArgCount&&n.length!=this.expectedArguments.length)return!1;for(var r=0,i=this.expectedArguments.length;i>r;r+=1)if(!e.deepEqual(this.expectedArguments[r],n[r]))return!1;return!0},withArgs:function(){return this.expectedArguments=s.call(arguments),this},withExactArgs:function(){return this.withArgs.apply(this,arguments),this.expectsExactArgCount=!0,this},on:function(e){return this.expectedThis=e,this},toString:function(){var i=(this.expectedArguments||[]).slice();this.expectsExactArgCount||r.call(i,"[...]");var o=e.spyCall.toString.call({proxy:this.method||"anonymous mock expectation",args:i}),a=o.replace(", [...","[, ...")+" "+n(this);return this.met()?"Expectation met: "+a:"Expected "+a+" ("+t(this.callCount)+")"},verify:function(){return this.met()?e.expectation.pass(this.toString()):e.expectation.fail(this.toString()),!0},pass:function(t){e.assert.pass(t)},fail:function(e){var t=new Error(e);throw t.name="ExpectationError",t}}}(),n?module.exports=t:e.mock=t}}("object"==typeof sinon&&sinon||null),function(e){function t(e){return e.fakes||(e.fakes=[]),e.fakes}function n(e,n){for(var r=t(e),i=0,o=r.length;o>i;i+=1)"function"==typeof r[i][n]&&r[i][n]()}function r(e){for(var n=t(e),r=0;r<n.length;)n.splice(r,1)}var i="object"==typeof module&&"function"==typeof require,o=[].push,a=Object.prototype.hasOwnProperty;if(!e&&i&&(e=require("../sinon")),e){var s={verify:function(){n(this,"verify")},restore:function(){n(this,"restore"),r(this)},verifyAndRestore:function(){var e;try{this.verify()}catch(t){e=t}if(this.restore(),e)throw e},add:function(e){return o.call(t(this),e),e},spy:function(){return this.add(e.spy.apply(e,arguments))},stub:function(t,n,r){if(n){var i=t[n];if("function"!=typeof i){if(!a.call(t,n))throw new TypeError("Cannot stub non-existent own property "+n);return t[n]=r,this.add({restore:function(){t[n]=i}})}}if(!n&&t&&"object"==typeof t){var o=e.stub.apply(e,arguments);for(var s in o)"function"==typeof o[s]&&this.add(o[s]);return o}return this.add(e.stub.apply(e,arguments))},mock:function(){return this.add(e.mock.apply(e,arguments))},inject:function(e){var t=this;return e.spy=function(){return t.spy.apply(t,arguments)},e.stub=function(){return t.stub.apply(t,arguments)},e.mock=function(){return t.mock.apply(t,arguments)},e}};i?module.exports=s:e.collection=s}}("object"==typeof sinon&&sinon||null),"undefined"==typeof sinon)var sinon={};if(function(global){function addTimer(e,t){if(0===e.length)throw new Error("Function requires at least 1 parameter");var n=id++,r=e[1]||0;return this.timeouts||(this.timeouts={}),this.timeouts[n]={id:n,func:e[0],callAt:this.now+r,invokeArgs:Array.prototype.slice.call(e,2)},t===!0&&(this.timeouts[n].interval=r),n}function parseTime(e){if(!e)return 0;var t,n=e.split(":"),r=n.length,i=r,o=0;if(r>3||!/^(\d\d:){0,2}\d\d?$/.test(e))throw new Error("tick only understands numbers and 'h:m:s'");for(;i--;){if(t=parseInt(n[i],10),t>=60)throw new Error("Invalid time "+e);o+=t*Math.pow(60,r-i-1)}return 1e3*o}function createObject(e){var t;if(Object.create)t=Object.create(e);else{var n=function(){};n.prototype=e,t=new n}return t.Date.clock=t,t}function mirrorDateProperties(e,t){return t.now?e.now=function(){return e.clock.now}:delete e.now,t.toSource?e.toSource=function(){return t.toSource()}:delete e.toSource,e.toString=function(){return t.toString()},e.prototype=t.prototype,e.parse=t.parse,e.UTC=t.UTC,e.prototype.toUTCString=t.prototype.toUTCString,e}function restore(){for(var e,t=0,n=this.methods.length;n>t;t++)e=this.methods[t],global[e].hadOwnProperty?global[e]=this["_"+e]:delete global[e];this.methods=[]}function stubGlobal(e,t){if(t[e].hadOwnProperty=Object.prototype.hasOwnProperty.call(global,e),t["_"+e]=global[e],"Date"==e){var n=mirrorDateProperties(t[e],global[e]);global[e]=n}else{global[e]=function(){return t[e].apply(t,arguments)};for(var r in t[e])t[e].hasOwnProperty(r)&&(global[e][r]=t[e][r])}global[e].clock=t}var id=1;sinon.clock={now:0,create:function(e){var t=createObject(this);if("number"==typeof e&&(t.now=e),e&&"object"==typeof e)throw new TypeError("now should be milliseconds since UNIX epoch");return t},setTimeout:function(){return addTimer.call(this,arguments,!1)},clearTimeout:function(e){this.timeouts||(this.timeouts=[]),e in this.timeouts&&delete this.timeouts[e]},setInterval:function(){return addTimer.call(this,arguments,!0)},clearInterval:function(e){this.clearTimeout(e)},tick:function(e){e="number"==typeof e?e:parseTime(e);for(var t,n=this.now,r=this.now+e,i=this.now,o=this.firstTimerInRange(n,r);o&&r>=n;){if(this.timeouts[o.id]){n=this.now=o.callAt;try{this.callTimer(o)}catch(a){t=t||a}}o=this.firstTimerInRange(i,r),i=n}if(this.now=r,t)throw t;return this.now},firstTimerInRange:function(e,t){var n,r,i;for(var o in this.timeouts)if(this.timeouts.hasOwnProperty(o)){if(this.timeouts[o].callAt<e||this.timeouts[o].callAt>t)continue;(!r||this.timeouts[o].callAt<r)&&(i=this.timeouts[o],r=this.timeouts[o].callAt,n={func:this.timeouts[o].func,callAt:this.timeouts[o].callAt,interval:this.timeouts[o].interval,id:this.timeouts[o].id,invokeArgs:this.timeouts[o].invokeArgs})}return n||null},callTimer:function(timer){"number"==typeof timer.interval?this.timeouts[timer.id].callAt+=timer.interval:delete this.timeouts[timer.id];try{"function"==typeof timer.func?timer.func.apply(null,timer.invokeArgs):eval(timer.func)}catch(e){var exception=e}if(this.timeouts[timer.id]){if(exception)throw exception}else if(exception)throw exception},reset:function(){this.timeouts={}},Date:function(){function e(n,r,i,o,a,s,u){switch(arguments.length){case 0:return new t(e.clock.now);case 1:return new t(n);case 2:return new t(n,r);case 3:return new t(n,r,i);case 4:return new t(n,r,i,o);case 5:return new t(n,r,i,o,a);case 6:return new t(n,r,i,o,a,s);default:return new t(n,r,i,o,a,s,u)}}var t=Date;return mirrorDateProperties(e,t)}()};var methods=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];sinon.useFakeTimers=function(e){var t=sinon.clock.create(e);t.restore=restore,t.methods=Array.prototype.slice.call(arguments,"number"==typeof e?1:0),0===t.methods.length&&(t.methods=methods);for(var n=0,r=t.methods.length;r>n;n++)stubGlobal(t.methods[n],t);return t}}("undefined"!=typeof global&&"function"!=typeof global?global:this),sinon.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date},"object"==typeof module&&"function"==typeof require&&(module.exports=sinon),"undefined"==typeof sinon&&(this.sinon={}),function(){var e=[].push;sinon.Event=function(e,t,n,r){this.initEvent(e,t,n,r)},sinon.Event.prototype={initEvent:function(e,t,n,r){this.type=e,this.bubbles=t,this.cancelable=n,this.target=r},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=!0}},sinon.EventTarget={addEventListener:function(t,n){this.eventListeners=this.eventListeners||{},this.eventListeners[t]=this.eventListeners[t]||[],e.call(this.eventListeners[t],n)},removeEventListener:function(e,t){for(var n=this.eventListeners&&this.eventListeners[e]||[],r=0,i=n.length;i>r;++r)if(n[r]==t)return n.splice(r,1)},dispatchEvent:function(e){for(var t=e.type,n=this.eventListeners&&this.eventListeners[t]||[],r=0;r<n.length;r++)"function"==typeof n[r]?n[r].call(this,e):n[r].handleEvent(e);return!!e.defaultPrevented}}}(),"undefined"==typeof sinon&&(this.sinon={}),sinon.xhr={XMLHttpRequest:this.XMLHttpRequest},function(e){function t(){function e(e){n.addEventListener(e,function(t){var r=n["on"+e];r&&"function"==typeof r&&r(t)})}this.readyState=t.UNSENT,this.requestHeaders={},this.requestBody=null,this.status=0,this.statusText="";for(var n=this,r=["loadstart","load","abort","loadend"],i=r.length-1;i>=0;i--)e(r[i]);"function"==typeof t.onCreate&&t.onCreate(this)}function n(e){if(e.readyState!==t.OPENED)throw new Error("INVALID_STATE_ERR");if(e.sendFlag)throw new Error("INVALID_STATE_ERR")}function r(e,t){if(e)for(var n=0,r=e.length;r>n;n+=1)t(e[n])}function i(e,t){for(var n=0;n<e.length;n++)if(t(e[n])===!0)return!0;return!1}function o(e){if(e.readyState==t.DONE)throw new Error("Request done")}function a(e){if(e.async&&e.readyState!=t.HEADERS_RECEIVED)throw new Error("No headers received")}function s(e){if("string"!=typeof e){var t=new Error("Attempted to respond to fake XMLHttpRequest with "+e+", which is not a string.");throw t.name="InvalidBodyException",t}}var u=sinon.xhr;u.GlobalXMLHttpRequest=e.XMLHttpRequest,u.GlobalActiveXObject=e.ActiveXObject,u.supportsActiveX="undefined"!=typeof u.GlobalActiveXObject,u.supportsXHR="undefined"!=typeof u.GlobalXMLHttpRequest,u.workingXHR=u.supportsXHR?u.GlobalXMLHttpRequest:u.supportsActiveX?function(){return new u.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:!1;var l={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0},c=function(e,t,n){switch(n.length){case 0:return e[t]();case 1:return e[t](n[0]);case 2:return e[t](n[0],n[1]);case 3:return e[t](n[0],n[1],n[2]);case 4:return e[t](n[0],n[1],n[2],n[3]);case 5:return e[t](n[0],n[1],n[2],n[3],n[4])}};t.filters=[],t.addFilter=function(e){this.filters.push(e)};var h=/MSIE 6/;t.defake=function(e,n){var i=new sinon.xhr.workingXHR;r(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(t){e[t]=function(){return c(i,t,arguments)}});var o=function(t){r(t,function(t){try{e[t]=i[t]}catch(n){if(!h.test(navigator.userAgent))throw n}})},a=function(){e.readyState=i.readyState,i.readyState>=t.HEADERS_RECEIVED&&o(["status","statusText"]),i.readyState>=t.LOADING&&o(["responseText"]),i.readyState===t.DONE&&o(["responseXML"]),e.onreadystatechange&&e.onreadystatechange.call(e)};if(i.addEventListener){for(var s in e.eventListeners)e.eventListeners.hasOwnProperty(s)&&r(e.eventListeners[s],function(e){i.addEventListener(s,e)});i.addEventListener("readystatechange",a)}else i.onreadystatechange=a;c(i,"open",n)},t.useFilters=!1,sinon.extend(t.prototype,sinon.EventTarget,{async:!0,open:function(e,n,r,o,a){if(this.method=e,this.url=n,this.async="boolean"==typeof r?r:!0,this.username=o,this.password=a,this.responseText=null,this.responseXML=null,this.requestHeaders={},this.sendFlag=!1,sinon.FakeXMLHttpRequest.useFilters===!0){var s=arguments,u=i(t.filters,function(e){return e.apply(this,s)});if(u)return sinon.FakeXMLHttpRequest.defake(this,arguments)}this.readyStateChange(t.OPENED)},readyStateChange:function(e){if(this.readyState=e,"function"==typeof this.onreadystatechange)try{this.onreadystatechange()}catch(n){sinon.logError("Fake XHR onreadystatechange handler",n)}switch(this.dispatchEvent(new sinon.Event("readystatechange")),this.readyState){case t.DONE:this.dispatchEvent(new sinon.Event("load",!1,!1,this)),this.dispatchEvent(new sinon.Event("loadend",!1,!1,this))}},setRequestHeader:function(e,t){if(n(this),l[e]||/^(Sec-|Proxy-)/.test(e))throw new Error('Refused to set unsafe header "'+e+'"');this.requestHeaders[e]?this.requestHeaders[e]+=","+t:this.requestHeaders[e]=t},setResponseHeaders:function(e){this.responseHeaders={};for(var n in e)e.hasOwnProperty(n)&&(this.responseHeaders[n]=e[n]);this.async?this.readyStateChange(t.HEADERS_RECEIVED):this.readyState=t.HEADERS_RECEIVED},send:function(e){if(n(this),!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var r=this.requestHeaders["Content-Type"].split(";");this.requestHeaders["Content-Type"]=r[0]+";charset=utf-8"}else this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.requestBody=e}this.errorFlag=!1,this.sendFlag=this.async,this.readyStateChange(t.OPENED),"function"==typeof this.onSend&&this.onSend(this),this.dispatchEvent(new sinon.Event("loadstart",!1,!1,this))},abort:function(){this.aborted=!0,this.responseText=null,this.errorFlag=!0,this.requestHeaders={},this.readyState>sinon.FakeXMLHttpRequest.UNSENT&&this.sendFlag&&(this.readyStateChange(sinon.FakeXMLHttpRequest.DONE),this.sendFlag=!1),this.readyState=sinon.FakeXMLHttpRequest.UNSENT,this.dispatchEvent(new sinon.Event("abort",!1,!1,this)),"function"==typeof this.onerror&&this.onerror()},getResponseHeader:function(e){if(this.readyState<t.HEADERS_RECEIVED)return null;if(/^Set-Cookie2?$/i.test(e))return null;e=e.toLowerCase();for(var n in this.responseHeaders)if(n.toLowerCase()==e)return this.responseHeaders[n];return null},getAllResponseHeaders:function(){if(this.readyState<t.HEADERS_RECEIVED)return"";var e="";for(var n in this.responseHeaders)this.responseHeaders.hasOwnProperty(n)&&!/^Set-Cookie2?$/i.test(n)&&(e+=n+": "+this.responseHeaders[n]+"\r\n");return e},setResponseBody:function(e){o(this),a(this),s(e);var n=this.chunkSize||10,r=0;this.responseText="";do this.async&&this.readyStateChange(t.LOADING),this.responseText+=e.substring(r,r+n),r+=n;while(r<e.length);var i=this.getResponseHeader("Content-Type");if(this.responseText&&(!i||/(text\/xml)|(application\/xml)|(\+xml)/.test(i)))try{this.responseXML=t.parseXML(this.responseText)}catch(u){}this.async?this.readyStateChange(t.DONE):this.readyState=t.DONE},respond:function(e,n,r){this.setResponseHeaders(n||{}),this.status="number"==typeof e?e:200,this.statusText=t.statusCodes[this.status],this.setResponseBody(r||""),"function"==typeof this.onload&&this.onload()}}),sinon.extend(t,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}),t.parseXML=function(e){var t;if("undefined"!=typeof DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},t.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"},sinon.useFakeXMLHttpRequest=function(){return sinon.FakeXMLHttpRequest.restore=function(t){u.supportsXHR&&(e.XMLHttpRequest=u.GlobalXMLHttpRequest),u.supportsActiveX&&(e.ActiveXObject=u.GlobalActiveXObject),delete sinon.FakeXMLHttpRequest.restore,t!==!0&&delete sinon.FakeXMLHttpRequest.onCreate},u.supportsXHR&&(e.XMLHttpRequest=sinon.FakeXMLHttpRequest),u.supportsActiveX&&(e.ActiveXObject=function(e){return"Microsoft.XMLHTTP"==e||/^Msxml2\.XMLHTTP/i.test(e)?new sinon.FakeXMLHttpRequest:new u.GlobalActiveXObject(e)}),sinon.FakeXMLHttpRequest},sinon.FakeXMLHttpRequest=t}(this),"object"==typeof module&&"function"==typeof require&&(module.exports=sinon),"undefined"==typeof sinon)var sinon={};if(sinon.fakeServer=function(){function e(){}function t(t){return e.prototype=t,new e}function n(e){var t=e;if("[object Array]"!=Object.prototype.toString.call(e)&&(t=[200,{},e]),"string"!=typeof t[2])throw new TypeError("Fake server response body should be string, but was "+typeof t[2]);return t}function r(e,t,n){var r=e.method,i=!r||r.toLowerCase()==t.toLowerCase(),o=e.url,a=!o||o==n||"function"==typeof o.test&&o.test(n);return i&&a}function i(e,t){var n=(this.getHTTPMethod(t),t.url);if((!/^https?:\/\//.test(n)||u.test(n))&&(n=n.replace(u,"")),r(e,this.getHTTPMethod(t),n)){if("function"==typeof e.response){var i=e.url,o=[t].concat(i?n.match(i).slice(1):[]);return e.response.apply(e,o)}return!0}return!1}function o(e,t){var n;n="Request:\n"+sinon.format(t)+"\n\n",n+="Response:\n"+sinon.format(e)+"\n\n",sinon.log(n)}var a=[].push,s="undefined"!=typeof window?window.location:{},u=new RegExp("^"+s.protocol+"//"+s.host);return{create:function(){var e=t(this);return this.xhr=sinon.useFakeXMLHttpRequest(),e.requests=[],this.xhr.onCreate=function(t){e.addRequest(t)},e},addRequest:function(e){var t=this;a.call(this.requests,e),e.onSend=function(){t.handleRequest(this)},this.autoRespond&&!this.responding&&(setTimeout(function(){t.responding=!1,t.respond()},this.autoRespondAfter||10),this.responding=!0)},getHTTPMethod:function(e){if(this.fakeHTTPMethods&&/post/i.test(e.method)){var t=(e.requestBody||"").match(/_method=([^\b;]+)/);return t?t[1]:e.method}return e.method},handleRequest:function(e){e.async?(this.queue||(this.queue=[]),a.call(this.queue,e)):this.processRequest(e)},respondWith:function(e,t,r){return 1==arguments.length&&"function"!=typeof e?(this.response=n(e),void 0):(this.responses||(this.responses=[]),1==arguments.length&&(r=e,t=e=null),2==arguments.length&&(r=t,t=e,e=null),a.call(this.responses,{method:e,url:t,response:"function"==typeof r?r:n(r)}),void 0)},respond:function(){arguments.length>0&&this.respondWith.apply(this,arguments);for(var e,t=this.queue||[];e=t.shift();)this.processRequest(e)},processRequest:function(e){try{if(e.aborted)return;var t=this.response||[404,{},""];if(this.responses)for(var n=0,r=this.responses.length;r>n;n++)if(i.call(this,this.responses[n],e)){t=this.responses[n].response;break}4!=e.readyState&&(o(t,e),e.respond(t[0],t[1],t[2]))}catch(a){sinon.logError("Fake server request processing",a)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}(),"object"==typeof module&&"function"==typeof require&&(module.exports=sinon),function(){function e(){}e.prototype=sinon.fakeServer,sinon.fakeServerWithClock=new e,sinon.fakeServerWithClock.addRequest=function(e){if(e.async&&("object"==typeof setTimeout.clock?this.clock=setTimeout.clock:(this.clock=sinon.useFakeTimers(),this.resetClock=!0),!this.longestTimeout)){var t=this.clock.setTimeout,n=this.clock.setInterval,r=this;this.clock.setTimeout=function(e,n){return r.longestTimeout=Math.max(n,r.longestTimeout||0),t.apply(this,arguments)},this.clock.setInterval=function(e,t){return r.longestTimeout=Math.max(t,r.longestTimeout||0),n.apply(this,arguments)}}return sinon.fakeServer.addRequest.call(this,e)},sinon.fakeServerWithClock.respond=function(){var e=sinon.fakeServer.respond.apply(this,arguments);return this.clock&&(this.clock.tick(this.longestTimeout||0),this.longestTimeout=0,this.resetClock&&(this.clock.restore(),this.resetClock=!1)),e},sinon.fakeServerWithClock.restore=function(){return this.clock&&this.clock.restore(),sinon.fakeServer.restore.apply(this,arguments)}}(),"object"==typeof module&&"function"==typeof require){var sinon=require("../sinon");sinon.extend(sinon,require("./util/fake_timers"))}return function(){function e(e,t,r,i){i&&(t.injectInto?t.injectInto[r]=i:n.call(e.args,i))}function t(e){var t=sinon.create(sinon.sandbox);return e.useFakeServer&&("object"==typeof e.useFakeServer&&(t.serverPrototype=e.useFakeServer),t.useFakeServer()),e.useFakeTimers&&("object"==typeof e.useFakeTimers?t.useFakeTimers.apply(t,e.useFakeTimers):t.useFakeTimers()),t}var n=[].push;sinon.sandbox=sinon.extend(sinon.create(sinon.collection),{useFakeTimers:function(){return this.clock=sinon.useFakeTimers.apply(sinon,arguments),this.add(this.clock)},serverPrototype:sinon.fakeServer,useFakeServer:function(){var e=this.serverPrototype||sinon.fakeServer;return e&&e.create?(this.server=e.create(),this.add(this.server)):null},inject:function(e){return sinon.collection.inject.call(this,e),this.clock&&(e.clock=this.clock),this.server&&(e.server=this.server,e.requests=this.server.requests),e},create:function(n){if(!n)return sinon.create(sinon.sandbox);var r=t(n);r.args=r.args||[];var i,o,a=r.inject({});if(n.properties)for(var s=0,u=n.properties.length;u>s;s++)i=n.properties[s],o=a[i]||"sandbox"==i&&r,e(r,n,i,o);else e(r,n,"sandbox",o);return r}}),sinon.sandbox.useFakeXMLHttpRequest=sinon.sandbox.useFakeServer,"object"==typeof module&&"function"==typeof require&&(module.exports=sinon.sandbox)}(),function(e){function t(t){var n=typeof t;if("function"!=n)throw new TypeError("sinon.test needs to wrap a test function, got "+n);return function(){var n=e.getConfig(e.config);n.injectInto=n.injectIntoThis&&this||n.injectInto;var r,i,o=e.sandbox.create(n),a=Array.prototype.slice.call(arguments).concat(o.args);try{i=t.apply(this,a)}catch(s){r=s}if("undefined"!=typeof r)throw o.restore(),r;return o.verifyAndRestore(),i}}var n="object"==typeof module&&"function"==typeof require;!e&&n&&(e=require("../sinon")),e&&(t.config={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},n?module.exports=t:e.test=t)}("object"==typeof sinon&&sinon||null),function(e){function t(e,t,n){return function(){t&&t.apply(this,arguments);var r,i;try{i=e.apply(this,arguments)}catch(o){r=o}if(n&&n.apply(this,arguments),r)throw r;return i}}function n(n,r){if(!n||"object"!=typeof n)throw new TypeError("sinon.testCase needs an object with test functions");r=r||"test";var i,o,a,s=new RegExp("^"+r),u={},l=n.setUp,c=n.tearDown;for(i in n)if(n.hasOwnProperty(i)){if(o=n[i],/^(setUp|tearDown)$/.test(i))continue;"function"==typeof o&&s.test(i)?(a=o,(l||c)&&(a=t(o,l,c)),u[i]=e.test(a)):u[i]=n[i]}return u}var r="object"==typeof module&&"function"==typeof require;!e&&r&&(e=require("../sinon")),e&&Object.prototype.hasOwnProperty&&(r?module.exports=n:e.testCase=n)}("object"==typeof sinon&&sinon||null),function(e,t){function n(){for(var e,t=0,n=arguments.length;n>t;++t)e=arguments[t],e||a.fail("fake is not a spy"),"function"!=typeof e&&a.fail(e+" is not a function"),"function"!=typeof e.getCall&&a.fail(e+" is not stubbed")}function r(e,n){e=e||t;var r=e.fail||a.fail;r.call(e,n)}function i(e,t,i){2==arguments.length&&(i=t,t=e),a[e]=function(o){n(o);var s=u.call(arguments,1),l=!1;l="function"==typeof t?!t(o):"function"==typeof o[t]?!o[t].apply(o,s):!o[t],l?r(this,o.printf.apply(o,[i].concat(s))):a.pass(e)}}function o(e,t){return!e||/^fail/.test(t)?t:e+t.slice(0,1).toUpperCase()+t.slice(1)}var a,s="object"==typeof module&&"function"==typeof require,u=Array.prototype.slice;!e&&s&&(e=require("../sinon")),e&&(a={failException:"AssertError",fail:function(e){var t=new Error(e);throw t.name=this.failException||a.failException,t},pass:function(){},callOrder:function(){n.apply(null,arguments);var t="",i="";if(e.calledInOrder(arguments))a.pass("callOrder");else{try{t=[].join.call(arguments,", ");for(var o=u.call(arguments),s=o.length;s;)o[--s].called||o.splice(s,1);i=e.orderByFirstCall(o).join(", ")}catch(l){}r(this,"expected "+t+" to be called in order but were called as "+i)}},callCount:function(t,i){if(n(t),t.callCount!=i){var o="expected %n to be called "+e.timesInWords(i)+" but was called %c%C";r(this,t.printf(o))}else a.pass("callCount")},expose:function(e,t){if(!e)throw new TypeError("target is null or undefined");var n=t||{},r="undefined"==typeof n.prefix&&"assert"||n.prefix,i="undefined"==typeof n.includeFail||!!n.includeFail;for(var a in this)"export"==a||!i&&/^(fail)/.test(a)||(e[o(r,a)]=this[a]);return e}},i("called","expected %n to have been called at least once but was never called"),i("notCalled",function(e){return!e.called},"expected %n to not have been called but was called %c%C"),i("calledOnce","expected %n to be called once but was called %c%C"),i("calledTwice","expected %n to be called twice but was called %c%C"),i("calledThrice","expected %n to be called thrice but was called %c%C"),i("calledOn","expected %n to be called with %1 as this but was called with %t"),i("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t"),i("calledWithNew","expected %n to be called with new"),i("alwaysCalledWithNew","expected %n to always be called with new"),i("calledWith","expected %n to be called with arguments %*%C"),i("calledWithMatch","expected %n to be called with match %*%C"),i("alwaysCalledWith","expected %n to always be called with arguments %*%C"),i("alwaysCalledWithMatch","expected %n to always be called with match %*%C"),i("calledWithExactly","expected %n to be called with exact arguments %*%C"),i("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C"),i("neverCalledWith","expected %n to never be called with arguments %*%C"),i("neverCalledWithMatch","expected %n to never be called with match %*%C"),i("threw","%n did not throw exception%C"),i("alwaysThrew","%n did not always throw exception%C"),s?module.exports=a:e.assert=a)
}("object"==typeof sinon&&sinon||null,"undefined"!=typeof window?window:"undefined"!=typeof self?self:global),sinon}.call("undefined"!=typeof window&&window||{}),define("sinon",function(e){return function(){var t;return t||e.sinon}}(this)),define("test/hooks_spec",["require","chai","sinon","hooks"],function(e){var t=(e("chai").expect,e("sinon")),n=e("hooks");return function(){describe("Hooks",function(){describe("with 4 hooks",function(){var e,r,i,o,a,s={};beforeEach(function(){e=new n,r=t.spy(),i=t.spy(),o=t.spy(),a=t.spy(),e.register({on:"testing",order:3,"do":r}),e.register({on:"trolol",order:2,"do":i}),e.register({on:"testing",order:1,"do":o}),e.register({on:"testing",order:4,"do":a})}),it("should call registered hooks",function(){e.run("testing","init",s),t.assert.callOrder(o,r,a),t.assert.calledWith(r,"init"),t.assert.calledWith(o,"init"),t.assert.calledWith(a,"init"),t.assert.calledOn(r,s),t.assert.calledOn(o,s),t.assert.calledOn(a,s),t.assert.notCalled(i)})})})}}),define("test/enums_spec",["require","enums","chai","itself"],function(e){var t=e("enums"),n=e("chai").expect,r=e("itself");return function(){describe("enums",function(){var e={each:function(e){for(var t=["doe","a","deer","a","female","deer"],n=0;n<t.length;n++)if(!1===e(t[n]))return!1}};describe("::toArray",function(){it("should turn the enumerable into an array",function(){var i=(r('.charAt(0) == "d"'),t.toArray(e));n(i).to.deep.equal(["doe","a","deer","a","female","deer"])})}),describe("::filter",function(){it("should filter the enumerable",function(){var i=r('.charAt(0) == "d"'),o=t.filter(e,i);n(o).to.deep.equal(["doe","deer","deer"])})}),describe("Array",function(){it("should be augmented to become an enumerable",function(){var e=t.toArray([1,2,3]);n(e).to.deep.equal([1,2,3])})})})}}),define("test/changer_spec",["require","changer","sinon","chai"],function(e){var t=e("changer"),n=e("sinon"),r=e("chai").expect;return function(){describe("changer",function(){it("must call only when it is changed",function(){var e=n.spy(),i=new t(e,10);i(10),i(20),i(20),i(30),i(10),r(e.getCall(0).args[0]).equal(10),r(e.getCall(1).args[0]).equal(20),r(e.getCall(2).args[0]).equal(30),r(e.getCall(3).args[0]).equal(10)})})}}),define("test_helper/bms",["require","bms"],function(e){var t=e("bms");return function(){var e=t.parse([].slice.call(arguments).join("\n"));return e}}),define("test/notechart_spec",["require","notechart","test_helper/bms","timing_data","time_signatures","chai","sinon"],function(e){var t=e("notechart"),n=e("test_helper/bms"),r=e("timing_data"),i=e("time_signatures"),o=e("chai").expect,a=e("sinon");return function(){describe("notechart",function(){it("should add time signatures and BPM changes",function(){{var e=new r,o=new i,s=a.spy(e,"add"),u=a.spy(o,"set");new t(n("#BPM 60","#BPM01 600","#00003:0000C0","#00108:00010000","#00002:0.75"),{timing:e,timeSignatures:o})}a.assert.calledWith(u,0,.75),a.assert.calledWith(s,a.match({type:"bpm",beat:0,bpm:60})),a.assert.calledWith(s,a.match({type:"bpm",beat:2,bpm:192})),a.assert.calledWith(s,a.match({type:"bpm",beat:4,bpm:600}))}),it("should list the notes",function(){var e=new t(n("#BPM 120","#00016:10","#00011:0001","#00012:00020003","#00058:0001","#00001:120012","#00001:thunders","#00158:01010001","#00155:00xx0001"));o(e.notes.length).to.equal(13);var r=a.spy();e.notes.each(r),a.assert.calledWith(r,a.match({column:0,beat:0,value:"10"})),a.assert.calledWith(r,a.match({column:-1,beat:0,value:"12"})),a.assert.calledWith(r,a.match({column:-1,beat:8/3,value:"12"})),a.assert.calledWith(r,a.match({column:-2,beat:0,value:"TH"})),a.assert.calledWith(r,a.match({column:-2,beat:1,value:"UN"})),a.assert.calledWith(r,a.match({column:-2,beat:2,value:"DE"})),a.assert.calledWith(r,a.match({column:-2,beat:3,value:"RS"})),a.assert.calledWith(r,a.match({column:1,beat:2,value:"01"})),a.assert.calledWith(r,a.match({column:2,beat:1,value:"02"})),a.assert.calledWith(r,a.match({column:2,beat:3,value:"03"})),a.assert.calledWith(r,a.match({column:6,beat:2,value:"01",finish:4})),a.assert.calledWith(r,a.match({column:6,beat:5,value:"01",finish:7})),a.assert.calledWith(r,a.match({column:5,beat:5,value:"XX",finish:7}))}),it("should support lnobj",function(){var e=new t(n("#LNOBJ XX","#00011:01XX0002XX"));o(e.notes.length).to.equal(2);var r=a.spy();e.notes.each(r),a.assert.calledWith(r,a.match({column:0,beat:0,value:"01",finish:.8})),a.assert.calledWith(r,a.match({column:0,beat:2.4,value:"02",finish:3.2}))}),it("notes should have time",function(){var e=new t(n("#BPM 120","#00016:10111213")),r=a.spy();e.notes.each(r),a.assert.calledWith(r,a.match({time:0})),a.assert.calledWith(r,a.match({time:.5})),a.assert.calledWith(r,a.match({time:1})),a.assert.calledWith(r,a.match({time:1.5}))}),it("notes should have finishTime",function(){var e=new t(n("#BPM 120","#00016:10000000","#00056:00100010")),r=a.spy();e.notes.each(r),a.assert.calledWith(r,a.match({finishTime:void 0})),a.assert.calledWith(r,a.match({finishTime:1.5}))}),it("should add gimmicks",function(){{var e=(new r,new i,a.spy()),o=a.spy(),s={zoom:e,scroll:o,apply:function(e){return e()}};new t(n("#WAV01 zoom=1","#WAV02 zoom=2","#WAV03 zoom*=3","#WAV04 zoom/=4","#WAV11 scroll=1","#WAV22 scroll+=3","#WAV33 scroll*=2","#WAV44 scroll/=4","#00101:01020304","#00101:11223344"),{gimmick:s})}a.assert.calledWith(e,4,1),a.assert.calledWith(e,5,2),a.assert.calledWith(e,6,6),a.assert.calledWith(e,7,1.5),a.assert.calledWith(o,4,1),a.assert.calledWith(o,5,4),a.assert.calledWith(o,6,8),a.assert.calledWith(o,7,2)})})}}),define("test/bsearch_spec",["require","chai","bsearch"],function(e){var t=e("chai").expect,n=e("bsearch");return function(){describe("bsearch",function(){describe("()",function(){var e=[1,4,9,16,25,49];it("must return the index of first item that return true",function(){t(n(e,function(e){return e>=16})).to.equal(3),t(n(e,function(e){return e>=1})).to.equal(0),t(n(e,function(e){return e>=12})).to.equal(3),t(n(e,function(e){return e>=49})).to.equal(5),t(n(e,function(e){return e>=100})).to.equal(null)})}),describe(".first",function(){var e=[1,4,9,16,25,49];it("must return the first item that return true",function(){t(n.first(e,function(e){return e>=16})).to.equal(16),t(n.first(e,function(e){return e>=1})).to.equal(1),t(n.first(e,function(e){return e>=12})).to.equal(16),t(n.first(e,function(e){return e>=40})).to.equal(49),t(n.first(e,function(e){return e>=0})).to.equal(1),t(n.first(e,function(e){return e>=100})).to.equal(null)})}),describe(".lastIndex",function(){var e=[1,4,9,16,25,49];it("must return the last index that return true",function(){t(n.lastIndex(e,function(e){return 16>e})).to.equal(2),t(n.lastIndex(e,function(e){return 1>e})).to.equal(null),t(n.lastIndex(e,function(e){return 12>e})).to.equal(2),t(n.lastIndex(e,function(e){return 40>e})).to.equal(4),t(n.lastIndex(e,function(e){return 0>e})).to.equal(null),t(n.lastIndex(e,function(e){return 100>e})).to.equal(5)})}),describe(".last",function(){var e=[1,4,9,16,25,49];it("must return the last item that return true",function(){t(n.last(e,function(e){return 16>e})).to.equal(9),t(n.last(e,function(e){return 1>e})).to.equal(null),t(n.last(e,function(e){return 12>e})).to.equal(9),t(n.last(e,function(e){return 40>e})).to.equal(25),t(n.last(e,function(e){return 0>e})).to.equal(null),t(n.last(e,function(e){return 100>e})).to.equal(49)})})})}}),define("test/guard_modification_spec",["require","chai","guard_modification"],function(e){var t=e("chai").expect,n=e("guard_modification");return function(){describe("guardModification",function(){describe("when applied on object",function(){var e;beforeEach(function(){e={a:1},n(e,function(t){return e.x=t(function(){return e.y=2,"lol"}),function(){e.z=3}})}),it("should not allow a guarded function to run",function(){t(function(){e.x()}).to.throw("apply"),t(e.y).to.equal(void 0),t(e.z).to.equal(void 0)}),it("should let a guarded function run when using apply",function(){e.apply(function(){t(e.x()).to.equal("lol")}),t(e.y).to.equal(2)}),it("should call the after function after running apply",function(){e.apply(function(){e.x()}),t(e.z).to.equal(3)}),it("should not allow nested calls to modify",function(){t(function(){e.apply(function(){e.apply(function(){})})}).to.throw("nested")})})})}}),define("test/timing_data_spec",["require","chai","timing_data"],function(e){var t=e("chai").expect,n=1e-4,r=e("timing_data");return function(){describe("TimingData",function(){var e;beforeEach(function(){e=new r}),it("should not allow modification when not applying",function(){t(function(){e.add({type:"bpm",beat:0,bpm:60})}).to.throw("apply")}),it("should not allow nested apply",function(){t(function(){e.apply(function(){e.apply(function(){})})}).to.throw("nested")}),it("should be able to calculate beat from time",function(){e.apply(function(){e.add({type:"bpm",beat:0,bpm:60}),e.add({type:"bpm",beat:2,bpm:192}),e.add({type:"bpm",beat:4,bpm:600})}),t(e.beatToSecond(0)).to.be.closeTo(0,n),t(e.beatToSecond(1)).to.be.closeTo(1,n),t(e.beatToSecond(2)).to.be.closeTo(2,n),t(e.beatToSecond(3)).to.be.closeTo(2.3125,n),t(e.beatToSecond(4)).to.be.closeTo(2.625,n),t(e.beatToSecond(5)).to.be.closeTo(2.725,n)}),it("should be able to calculate seconds back to beat",function(){e.apply(function(){e.add({type:"bpm",beat:0,bpm:60}),e.add({type:"bpm",beat:2,bpm:120}),e.add({type:"bpm",beat:3,bpm:30})}),t(e.secondToBeat(0)).to.be.closeTo(0,n),t(e.secondToBeat(1)).to.be.closeTo(1,n),t(e.secondToBeat(2)).to.be.closeTo(2,n),t(e.secondToBeat(3)).to.be.closeTo(3.25,n),t(e.secondToBeat(4)).to.be.closeTo(3.75,n),t(e.secondToBeat(10)).to.be.closeTo(6.75,n)})})}}),define("test/time_signatures_spec",["require","chai","sinon","time_signatures"],function(e){var t=e("chai").expect,n=e("sinon"),r=e("time_signatures"),i=1e-4;return function(){describe("TimeSignatures",function(){describe("a blank one",function(){var e;beforeEach(function(){e=new r}),it("should use 4 beats per measure",function(){t(e.measureToBeat(0)).to.be.closeTo(0,i),t(e.measureToBeat(1)).to.be.closeTo(4,i),t(e.measureToBeat(1e3)).to.be.closeTo(4e3,i),t(e.beatToMeasure(0)).to.be.closeTo(0,i),t(e.beatToMeasure(1)).to.be.closeTo(.25,i),t(e.beatToMeasure(1e3)).to.be.closeTo(250,i)})}),describe("with some time signatures",function(){var e;beforeEach(function(){e=new r,e.apply(function(){e.set(1,.75),e.set(2,7/8),e.set(4,5/4)})}),it("should convert correctly measure to beat",function(){t(e.measureToBeat(0)).to.be.closeTo(0,i),t(e.measureToBeat(.5)).to.be.closeTo(2,i),t(e.measureToBeat(1)).to.be.closeTo(4,i),t(e.measureToBeat(1.5)).to.be.closeTo(5.5,i),t(e.measureToBeat(2)).to.be.closeTo(7,i),t(e.measureToBeat(2.5)).to.be.closeTo(8.75,i),t(e.measureToBeat(3)).to.be.closeTo(10.5,i),t(e.measureToBeat(3.5)).to.be.closeTo(12.5,i),t(e.measureToBeat(4)).to.be.closeTo(14.5,i),t(e.measureToBeat(4.5)).to.be.closeTo(17,i),t(e.measureToBeat(5)).to.be.closeTo(19.5,i),t(e.measureToBeat(100)).to.be.closeTo(399.5,i)}),it("should convert correctly beat to measure",function(){t(e.beatToMeasure(0)).to.be.closeTo(0,i),t(e.beatToMeasure(2)).to.be.closeTo(.5,i),t(e.beatToMeasure(4)).to.be.closeTo(1,i),t(e.beatToMeasure(5.5)).to.be.closeTo(1.5,i),t(e.beatToMeasure(7)).to.be.closeTo(2,i),t(e.beatToMeasure(8.75)).to.be.closeTo(2.5,i),t(e.beatToMeasure(399.5)).to.be.closeTo(100,i)}),it("#range should loop time signatures from beat to beat",function(){var t=n.spy();e.range(-1,11).each(t),n.assert.callCount(t,4),n.assert.calledWith(t,0),n.assert.calledWith(t,1),n.assert.calledWith(t,2),n.assert.calledWith(t,3)})})})}}),define("test/note_data_spec",["require","chai","sinon","note_data"],function(e){var t=(e("chai").expect,e("sinon")),n=e("note_data");return function(){describe("NoteData",function(){it("#each should loop each note",function(){var e=t.spy(),r=new n([{beat:0,value:"AA",column:1},{beat:0,value:"BB",column:2},{beat:2,value:"CC",column:2}]);r.each(e),t.assert.calledWith(e,t.match({value:"AA"})),t.assert.calledWith(e,t.match({value:"BB"})),t.assert.calledWith(e,t.match({value:"CC"}))})})}}),define("test/object_id_spec",["require","chai","object_id"],function(e){var t=e("chai").expect,n=e("object_id");return function(){describe("$id",function(){it("should return same value for same object",function(){var e={};t(n(e)).to.equal(n(e)),t(n(1)).to.equal(n(1)),t(n("abc")).to.equal(n("abc"))}),it("should return different value for different object",function(){var e={},r={};t(n(r)).not.to.equal(n(e)),t(n(1)).not.to.equal(n(2)),t(n("abc")).not.to.equal(n("def"))})})}}),define("test/object_pool_spec",["require","object_pool","chai"],function(e){var t=e("object_pool"),n=e("chai").expect;return function(){describe("ObjectPool",function(){var e,r;beforeEach(function(){function n(){this.set=function(e){this.data=e,this.inactive=!1},this.deactivate=function(){this.inactive=!0},this.get=function(){return this.data},r.push(this)}r=[],n.hashKey=function(e){return e.key},e=new t(n)}),it("should create a new object when asked",function(){e.begin();var t=e.use({key:"a"}),i=e.use({key:"b"});n(t.get().key).to.equal("a"),n(i.get().key).to.equal("b"),e.commit(),n(r[0].get().key).to.equal("a"),n(r[1].get().key).to.equal("b")}),it("should deactivate old object when unused",function(){e.update(function(e){e({key:"a"})}),e.update(function(){}),n(r[0].inactive).to.equal(!0)}),it("should return same instance for old key",function(){var t;e.update(function(e){t=e({key:"a",lol:1})}),n(t.get().lol).to.equal(1),e.update(function(e){e({key:"a",lol:3})}),n(r.length).to.equal(1),n(t.get().lol).to.equal(3)}),it("should reuse instances",function(){e.update(function(e){e({key:"a"})}),e.update(function(){}),e.update(function(e){e({key:"b"})}),n(r.length).to.equal(1),n(r[0].inactive).to.equal(!1),n(r[0].get().key).to.equal("b")})})}}),define("test/integrator_spec",["require","chai","integrator"],function(e){var t=e("chai").expect,n=e("integrator");return function(){describe("Integrator",function(){it("should be identity when blank",function(){var e=new n([]),r=[[0,0],[.5,.5],[1,1],[1.5,1.5],[2,2],[2.5,2.5],[3,3],[4,4],[1e3,1e3],[-1e3,-1e3]];r.forEach(function(n){t(e(n[0])).to.equal(n[1])})}),it("should integrate distance over time",function(){var e=new n([[0,1],[1,0],[2,2],[3,1]]),r=[[0,0],[.5,.5],[1,1],[1.5,1],[2,1],[2.5,2],[3,3],[4,4],[1e3,1e3],[-1e3,-1e3]];r.forEach(function(n){t(e(n[0])).to.equal(n[1])})})})}}),define("test/interpolator_spec",["require","chai","interpolator"],function(e){var t=e("chai").expect,n=e("interpolator");return function(){describe("Interpolator",function(){it("should return just 1 when blank",function(){var e=new n([]),r=[[0,1],[.5,1],[1,1],[1.5,1],[2,1],[2.5,1],[3,1],[4,1],[1e3,1],[-1e3,1]];r.forEach(function(n){t(e(n[0])).to.equal(n[1])})}),it("should interpolate points",function(){var e=new n([[0,1],[1,0],[2,2],[3,4]]),r=[[0,1],[.5,.5],[1,0],[1.5,1],[2,2],[2.5,3],[3,4],[4,4],[1e3,4],[-1e3,1]];r.forEach(function(n){t(e(n[0])).to.equal(n[1])})})})}}),define("test/bukkit_spec",["require","chai","bukkit"],function(e){var t=e("chai").expect,n=e("bukkit");return function(){describe("Bukkit",function(){it("should change and return new value",function(){var e=new n,r=[["=2",2],[123,123],[2,2],["+=1",3],["+=1/2",3.5],["*=2",7]];r.forEach(function(n){t(e(n[0])).to.equal(n[1])})})})}}),define("core/test/entities_spec",["require","chai","sinon","desire","note_data","../entities"],function(e){var t=(e("chai").expect,e("sinon")),n=e("desire"),r=e("note_data"),i=e("../entities");return function(){var e={beatToPosition:function(e){return e}};describe("Entities",function(){function o(e,n){t.assert.calledWith(e,t.match({note:t.match({value:n})}))}it("#range should loop in a range",function(){var a=t.spy(),s=new r([{beat:0,value:"AA",column:1},{beat:1,value:"CC",column:1},{beat:1.5,value:"DD",column:1},{beat:2,value:"EE",column:1},{beat:2.5,value:"FF",column:1}]),u=new i(new n({"game.notes":n.value(s),"game.metrics":n.value(e)}));u.range(1,2).each(a),t.assert.callCount(a,2),o(a,"CC"),o(a,"DD")}),it("#range should loop in a range with long notes",function(){var a=t.spy(),s=new r([{beat:0,value:"AA",column:1},{beat:.5,value:"BB",column:1,finish:3},{beat:1,value:"CC",column:1},{beat:1.5,value:"DD",column:1},{beat:2,value:"EE",column:1},{beat:2.5,value:"FF",column:1}]),u=new i(new n({"game.notes":n.value(s),"game.metrics":n.value(e)}));u.range(1,2).each(a),t.assert.callCount(a,3),o(a,"BB"),o(a,"CC"),o(a,"DD")})})}}),define("core/test/game_metrics_spec",["require","desire","../game_metrics","chai","gimmick"],function(e){var t=e("desire"),n=e("../game_metrics"),r=e("chai").expect,i=1e-4,o=e("gimmick");return function(){describe("GameMetrics",function(){var e,a;beforeEach(function(){e=n(a=new t({"game.theme":t.value({notes:{bottom:700,top:100,barHeight:200}}),"game.state":t.value({position:1}),"game.speed":t.value({current:2}),"game.gimmick":t.value(new o)}))}),it("#visibleRange should return the positions for notes area",function(){var t=a("game.state"),n=a("game.speed");r(e.visibleRange(function(e,t){return r(e).to.be.closeTo(1,i),r(t).to.be.closeTo(7,i),"lol"})).to.equal("lol"),t.position=2,e.visibleRange(function(e,t){r(e).to.be.closeTo(2,i),r(t).to.be.closeTo(8,i)}),n.current=1,e.visibleRange(function(e,t){r(e).to.be.closeTo(2,i),r(t).to.be.closeTo(14,i)})}),it("#noteY should return the Y position for a note position",function(){r(e.noteY(1,{position:1})).to.equal(700),r(e.noteY(2,{position:2})).to.equal(600),r(e.noteY(3,{position:3,finish:5})).to.equal(500),r(e.noteY(5,{position:3,finish:5})).to.equal(300)})})}}),define("core/test/stage_manager_spec",["require","../stage_manager","chai","sinon"],function(e){var t=e("../stage_manager"),n=e("chai").expect,r=e("sinon");return function(){describe("StageManager",function(){var e;beforeEach(function(){e=t.mix({})}),it("should have no current stage at first",function(){n(e.currentStage).to.be.null}),describe("#push",function(){it("should set the current stage to the latest pushed stage",function(){var t={},r={};e.pushStage(t),n(e.currentStage).to.equal(t),e.pushStage(r),n(e.currentStage).to.equal(r)})}),describe("#pop",function(){it("should reverse the push",function(){var t={},r={};e.pushStage(t),e.pushStage(r),e.popStage(),n(e.currentStage).to.equal(t)})}),describe("#replace",function(){it("should replace the stage",function(){var t={},r={},i={};e.pushStage(t),e.pushStage(r),e.replaceStage(i),n(e.currentStage).to.equal(i),e.popStage(),n(e.currentStage).to.equal(t)})}),describe("#forward",function(){it("should forward a message to the stage",function(){var t={},n={lol:r.spy(),cat:r.spy()},i={cat:r.spy()};e.pushStage(t),e.pushStage(n),e.pushStage(i),e.forward("cat",123),e.forward("cat",456),e.forward("lol",789),e.popStage(),e.forward("cat",321),e.forward("lol",654),e.popStage(),e.forward("keypress","wat"),e.popStage(),e.forward("keypress","wat"),r.assert.calledTwice(i.cat),r.assert.calledWith(i.cat,123),r.assert.calledWith(i.cat,456),r.assert.calledOnce(n.lol),r.assert.calledOnce(n.cat),r.assert.calledOn(n.lol,n)})})})}}),define("core/test/judge_spec",["require","chai","sinon","notechart","desire","test_helper/bms","lodash","../judge","../game_notes","../game_notes"],function(e){var t=e("chai").expect,n=e("sinon"),r=e("notechart"),i=e("desire"),o=e("test_helper/bms"),a=e("lodash"),s=e("../judge"),u={"game.Judge":s};return a.assign(u,e("../game_notes")),function(){describe("Judge",function(){var s=new r(o("#BPM 120","#00116:AABBCCDD","#00111:FFGGHHIIJJ","#00256:00EE0000","#00356:0000EE00"));u["game.hook"]=i.value(function(){}),u["game.notechart"]=i.value(s),u["game.judgment"]=function(){return{emit:n.spy()}},a.assign(u,e("../game_notes"));var l,c,h,f,d,p=new i(u);beforeEach(function(){l=p.clone(),c=l("game.Judge"),d=l("game.judgment"),h=new c(0),f=h._items}),describe("(private)",function(){it("_items should have the notes in that column",function(){t(f.length).to.equal(5)}),it("_items should be sorted by beat",function(){t(f[0].value).to.equal("AA"),t(f[1].value).to.equal("BB"),t(f[2].value).to.equal("CC"),t(f[3].value).to.equal("DD"),t(f[4].value).to.equal("EE")})}),describe("update should call miss when judgment is miss",function(){beforeEach(function(){d.judge=n.stub()}),it("1 note case",function(){d.judge.withArgs(f[0]).returns("miss"),d.judge.withArgs(f[1]).returns(void 0),h.update(),n.assert.callCount(d.emit,1),n.assert.calledWith(d.emit,"miss")}),it("zero note case",function(){d.judge.withArgs(f[0]).returns(1),d.judge.withArgs(f[1]).returns("miss"),h.update(),n.assert.callCount(d.emit,0)}),it("multiple misses",function(){d.judge.withArgs(f[0]).returns("miss"),d.judge.withArgs(f[1]).returns("miss"),d.judge.withArgs(f[2]).returns(1),d.judge.withArgs(f[3]).returns(void 0),h.update(),n.assert.callCount(d.emit,2),d.judge.withArgs(f[2]).returns("miss"),h.update(),n.assert.callCount(d.emit,3)})}),describe("down",function(){beforeEach(function(){d.judge=n.stub(),d.blank=n.stub()}),it("should emit the judgment value when judgment is number",function(){d.judge.withArgs(f[0]).returns(1),d.judge.withArgs(f[1]).returns(2),d.judge.withArgs(f[2]).returns(1),d.judge.withArgs(f[3]).returns(void 0),h.down(),n.assert.calledWith(d.emit,1),d.emit.reset(),h.down(),n.assert.calledWith(d.emit,2),d.emit.reset(),h.down(),n.assert.calledWith(d.emit,1),d.emit.reset(),h.down(),n.assert.notCalled(d.emit),n.assert.calledOnce(d.blank)})}),describe("up",function(){beforeEach(function(){d.judge=n.stub().returns(1),d.blank=n.stub(),d.judgeRelease=n.stub()}),it("should emit the judgment value when it is not undefined",function(){d.judgeRelease.withArgs(f[0]).returns(1),d.judgeRelease.withArgs(f[1]).returns(2),d.judgeRelease.withArgs(f[2]).returns("miss"),d.judgeRelease.withArgs(f[3]).returns(void 0),h.down(),d.emit.reset(),h.up(),n.assert.calledWith(d.emit,1),h.down(),d.emit.reset(),h.up(),n.assert.calledWith(d.emit,2),h.down(),d.emit.reset(),h.up(),n.assert.calledWith(d.emit,"miss"),h.down(),d.emit.reset(),h.up(),n.assert.notCalled(d.emit)}),it("should not judge when down returns undefined",function(){d.judge.withArgs(f[0]).returns(void 0),d.judgeRelease.withArgs(f[0]).returns(1),h.down(),h.up(),n.assert.notCalled(d.emit,1)})})})}}),define("core/test/judgment_spec",["require","chai","sinon","notechart","desire","test_helper/bms","lodash","../judgment","enums","../game_notes"],function(e){{var t=e("chai").expect,n=(e("sinon"),e("notechart"),e("desire")),r=(e("test_helper/bms"),e("lodash")),i=e("../judgment"),o={"game.judgment":i};e("enums")}return function(){describe("Judgment",function(){o["game.hook"]=n.value(function(){}),o["game.judgment.timing_window"]=n.value([.1,.2,.4]),o["game.state"]=function(){return{time:100}},r.assign(o,e("../game_notes"));var i,a,s=new n(o);beforeEach(function(){i=s.clone(),a=i("game.judgment")}),describe("judge",function(){it("should return correct judgment",function(){t(a.judge({time:100})).to.equal(0),t(a.judge({time:100.05})).to.equal(0),t(a.judge({time:99.95})).to.equal(0),t(a.judge({time:100.15})).to.equal(1),t(a.judge({time:99.85})).to.equal(1),t(a.judge({time:100.3})).to.equal(2),t(a.judge({time:99.7})).to.equal(2),t(a.judge({time:120})).to.equal(void 0),t(a.judge({time:60})).to.equal("miss")})}),describe("judgeRelease",function(){it("should return correct judgment",function(){t(a.judgeRelease({finishTime:void 0})).to.equal(void 0),t(a.judgeRelease({finishTime:100})).to.equal(0),t(a.judgeRelease({finishTime:100.05})).to.equal(0),t(a.judgeRelease({finishTime:99.95})).to.equal(0),t(a.judgeRelease({finishTime:100.15})).to.equal(1),t(a.judgeRelease({finishTime:99.85})).to.equal(1),t(a.judgeRelease({finishTime:100.3})).to.equal(2),t(a.judgeRelease({finishTime:99.7})).to.equal(2),t(a.judgeRelease({finishTime:120})).to.equal("miss"),t(a.judgeRelease({finishTime:60})).to.equal("miss")})})})}}),define("core/test/zip_preloader_spec",["require","../zip_preloader","when","chai"],function(e){var t=e("../zip_preloader"),n=e("when"),r=e("chai").expect;return function(){describe("ZipPreloader",function(){it("should preload a pak file ready to be used by xhr",function(e){function i(e,t){return function(){return n.promise(function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){t(n.responseText)},n.send(null)}).then(function(e){r(e.trim()).to.equal(t)})}}t.load("test/txts.zip","lol","text/plain").then(i("lol/a.txt","hello world")).then(i("lol/b.txt","blah blah blah")).then(i("lol/c.txt","do you want to build a snowman")).then(function(){e()},e)}),it("should return failure in case of failure",function(e){t.load("test/wtf.zip","lol").then(function(){e(new Error("should fail"))},function(){e()})})})}}),define("core/test/index",["require","./entities_spec","./game_metrics_spec","./stage_manager_spec","./judge_spec","./judgment_spec","./zip_preloader_spec"],function(e){return function(){e("./entities_spec")(),e("./game_metrics_spec")(),e("./stage_manager_spec")(),e("./judge_spec")(),e("./judgment_spec")(),e("./zip_preloader_spec")()}}),define("test/index",["require","./mixin_spec","./hooks_spec","./enums_spec","./changer_spec","./notechart_spec","./bsearch_spec","./guard_modification_spec","./timing_data_spec","./time_signatures_spec","./note_data_spec","./object_id_spec","./object_pool_spec","./integrator_spec","./interpolator_spec","./bukkit_spec","../core/test/index"],function(e){return function(){e("./mixin_spec")(),e("./hooks_spec")(),e("./enums_spec")(),e("./changer_spec")(),e("./notechart_spec")(),e("./bsearch_spec")(),e("./guard_modification_spec")(),e("./timing_data_spec")(),e("./time_signatures_spec")(),e("./note_data_spec")(),e("./object_id_spec")(),e("./object_pool_spec")(),e("./integrator_spec")(),e("./interpolator_spec")(),e("./bukkit_spec")(),e("../core/test/index")()}}),define("main",["require","app","./core/index","./ipad/index","./test/index"],function(e){var t=e("app"),n=new t;n.plug(e("./core/index")),n.plug(e("./ipad/index")),document.getElementById("test-app")?(e("./test/index")(),mocha.run()):n.hook("main")}),require("main");